import{d as t,e,g as a,o as n,c as i,j as s,k as o,w as l,X as g,F as r,aa as d,Z as c,x as f,y as u,_ as p}from"./index-4bfb878d.js";import{d as _}from"./dhtmlxgantt-859de0ac.js";const h={class:"flex",style:{"margin-bottom":"20px"}},m={style:{width:"200px"}},x={class:"flex"},w=(t=>(f("data-v-20b59a56"),t=t(),u(),t))((()=>s("div",{style:{width:"80px","line-height":"30px","font-size":"15px"}},"任务名",-1))),v=p(t({__name:"gantt-view",props:{ganttDataList:Object},emits:["handleGanttView","handleGanttAdd"],setup(t,{expose:f,emit:u}){const p=t,v=e(),y=e(),k=e(),b=()=>{_.gantt.refreshData()},D=(t,e)=>(e=e||!1,_.gantt.eachTask((function(t){D(t)&&(e=!0)}),t.id),t.text.toLowerCase().indexOf(k.value.toLowerCase())>-1&&(e=!0),e);_.gantt.attachEvent("onBeforeTaskDisplay",((t,e)=>!k.value||D(e)));const M=()=>{_.gantt.config.show_grid?_.gantt.config.show_grid=!1:_.gantt.config.show_grid=!0,_.gantt.init(v.value)},C=()=>{_.gantt.ext.fullscreen.toggle()};_.gantt.attachEvent("onTaskClick",(function(t,e){var a=e.target.closest("[data-action]");if(a){switch(a.getAttribute("data-action")){case"view":u("handleGanttView",t);break;case"add":u("handleGanttAdd",t)}return!1}return console.log(t,12121),!0}));const j=()=>{var t=_.gantt.date.date_to_str(_.gantt.config.task_date),e=new Date;_.gantt.addMarker({start_date:e,css:"today",text:"今天",title:"今天: "+t(e)})};return f({reload:()=>{_.gantt.clearAll(),j(),_.gantt.init(v.value),_.gantt.parse(p.ganttDataList),_.gantt.render()}}),a((()=>{_.gantt.config.xml_date="%Y-%m-%d %H:%i:%s",_.gantt.i18n.setLocale("cn"),_.gantt.config.readonly=!1,_.gantt.config.show_links=!1,_.gantt.config.duration_unit="hour",_.gantt.config.duration_step=8,_.gantt.config.grid_width=550,_.gantt.config.columns=[{name:"text",label:"任务名",tree:!0,width:"300"},{name:"taskCode",label:"任务编号",tree:!0,width:"350"},{name:"workstation",label:"工作站",align:"center",width:"*"},{name:"start_date",label:"开始时间",align:"center",width:"*"},{name:"end_date",label:"结束时间",align:"center",width:"*"},{name:"operate",label:"操作",template:function(t){return'<i class="fa fa-file-text-o" data-action="view"></i><i class="fa fa-pencil" data-action="add"></i>'},align:"center",min_width:150}],_.gantt.config.open_tree_initially=!0,_.gantt.templates.task_text=(t,e,a)=>"project"==a.type?"<b style='text-align:left;'>生产工单:</b> "+a.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*a.progress)+"% </span>":"<b style='text-align:left;'>生产任务:</b> "+a.process+" "+a.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*a.progress)+"% </span>",_.gantt.config.show_task_cells=!0,_.gantt.config.scales=[{unit:"week",step:1,format:t=>{var e=_.gantt.date.date_to_str("%Y年%M%d日"),a=_.gantt.date.add(_.gantt.date.add(t,1,"week"),-1,"day");return e(t)+" - "+e(a)}},{unit:"day",step:1,format:t=>{var e=_.gantt.date.date_to_str("%M %d");return _.gantt.date.date_to_str("%D"),e(t)},css:t=>0===t.getDay()||6===t.getDay()?"weekend":""},{unit:"hour",step:8,format:"%H:%i"}],_.gantt.config.auto_types=!1,_.gantt.config.drag_progress=!1,_.gantt.config.drag_move=!0,_.gantt.config.drag_links=!1,_.gantt.config.drag_resize=!0,_.gantt.config.details_on_create=!0,_.gantt.config.details_on_dblclick=!0,_.gantt.config.fit_tasks=!0,_.gantt.config.sort=!0,_.gantt.config.row_height=40,_.gantt.config.scale_height=70,_.gantt.config.lightbox=!1,_.gantt.plugins({fullscreen:!0,undo:!0,tooltip:!0,marker:!0,auto_scheduling:!0,critical_path:!0,quick_info:!1}),_.gantt.ext.fullscreen.getFullscreenElement=function(){return document.getElementById("myCover")},_.gantt.templates.tooltip_text=(t,e,a)=>"project"==a.type?"<b style='text-align:left;'>生产工单:</b> "+a.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*a.progress)+"% </span>":"<b style='text-align:left;'>生产任务:</b> "+a.process+" "+a.text+"    <span style='text-align:left;'> 完成比例："+Math.round(100*a.progress)+"% </span>",_.gantt.attachEvent("onAfterTaskUpdate",(function(t,e){console.log(t,"_ididid")})),j(),_.gantt.init(v.value),_.gantt.parse(p.ganttDataList)})),(t,e)=>{const a=d,f=c;return n(),i(r,null,[s("div",h,[s("div",m,[s("div",x,[w,o(a,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:"任务名",ref_key:"ganttInputRef",ref:y,onInput:b},null,8,["modelValue"])])]),o(f,{onClick:M},{default:l((()=>[g("隐藏左侧表格")])),_:1}),o(f,{onClick:C},{default:l((()=>[g("全屏")])),_:1})]),s("div",{id:"myCover",ref_key:"ganttRef",ref:v,style:{"min-height":"300px",overflow:"hidden"}},null,512)],64)}}}),[["__scopeId","data-v-20b59a56"],["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/prodMgmt/productionScheduling/components/gantt-view.vue"]]);export{v as default};
