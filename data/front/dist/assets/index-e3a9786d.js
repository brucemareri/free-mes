import{r as e,q as a,f as t,D as l,d as s,K as i,e as o,C as m,o as n,c as r,k as d,w as u,a as c,I as p,G as f,J as y,z as v,F as h,n as b,L as g,M as C,N as k,H as S,aJ as T,a1 as _,a0 as V,aa as w,ab as P,ae as I,_ as x}from"./index-4bfb878d.js";import{b as M}from"./index-be7841d8.js";import{r as U}from"./formRules-eb36c657.js";import{u as E}from"./useVxeCrudSchemas-092b8963.js";import{u as j}from"./useXTable-309dffed.js";const R=a=>e.get({url:"/admin-api/system/sms-template/page",params:a}),q=a=>e.get({url:"/admin-api/system/sms-template/get?id="+a}),A=a=>e.delete({url:"/admin-api/system/sms-template/delete?id="+a}),{t:D}=a(),F=[];(async()=>{const e=await M();console.log(e,"resresres"),e.forEach((e=>{F.push({key:e.id,value:e.id,label:e.signature})}))})();const L=t({type:[U],status:[U],code:[U],name:[U],content:[U],apiTemplateId:[U],channelId:[U]}),z=t({primaryKey:"id",primaryType:"id",primaryTitle:"模板编号",action:!0,actionWidth:"280",columns:[{title:"短信渠道编码",field:"channelId",isSearch:!1,isForm:!0,isTable:!1,form:{component:"Select",componentProps:{options:F}}},{title:"模板编码",field:"code",isSearch:!0},{title:"模板名称",field:"name",isSearch:!0},{title:"模板内容",field:"content"},{title:"短信 API 的模板编号",field:"apiTemplateId",isSearch:!0},{title:"短信类型",field:"type",dictType:l.SYSTEM_SMS_TEMPLATE_TYPE,dictClass:"number",isSearch:!0,table:{width:80}},{title:D("common.status"),field:"status",dictType:l.COMMON_STATUS,dictClass:"number",isSearch:!0,table:{width:80}},{title:D("form.remark"),field:"remark",isTable:!1},{title:D("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:J}=E(z),K=s({name:"SmsTemplate"}),N=x(s({...K,setup(t){const{t:l}=a(),s=i(),[x,{reload:M,deleteData:U}]=j({allSchemas:J,getListApi:R,deleteApi:A}),E=o(!1),D=o("edit"),F=o(""),z=o(!1),K=o(),N=o(),O=e=>{D.value=l("action."+e),F.value=e,E.value=!0},W=async()=>{var a;const t=null==(a=c(K))?void 0:a.getElFormRef();t&&t.validate((async a=>{var t;if(a){z.value=!0;try{const a=null==(t=c(K))?void 0:t.formModel;"create"===F.value?(await(a=>e.post({url:"/admin-api/system/sms-template/create",data:a}))(a),s.success(l("common.createSuccess"))):(await(a=>e.put({url:"/admin-api/system/sms-template/update",data:a}))(a),s.success(l("common.updateSuccess"))),E.value=!1}finally{z.value=!1,await M()}}}))},X=o({content:"",params:{},mobile:"",templateCode:"",templateParams:{}}),Y=o({mobile:[{required:!0,message:"手机不能为空",trigger:"blur"}],templateCode:[{required:!0,message:"模版编号不能为空",trigger:"blur"}],templateParams:{}}),G=o(!1),H=async()=>{const a={mobile:X.value.mobile,templateCode:X.value.templateCode,templateParams:X.value.templateParams},t=await(a=>e.post({url:"/admin-api/system/sms-template/send-sms",data:a}))(a);t&&s.success("提交发送成功！发送结果，见发送日志编号："+t),G.value=!1};return(e,a)=>{const t=g,s=C,i=k,o=S,M=T,j=_,R=V,A=w,Q=P,B=I,Z=m("hasPermi");return n(),r(h,null,[d(o,null,{default:u((()=>[d(i,{onRegister:c(x)},{toolbar_buttons:u((()=>[p(d(t,{type:"primary",preIcon:"ep:zoom-in",title:c(l)("action.add"),onClick:a[0]||(a[0]=e=>{O("create")})},null,8,["title"]),[[Z,["system:sms-channel:create"]]])])),actionbtns_default:u((({row:e})=>[p(d(s,{preIcon:"ep:cpu",title:c(l)("action.test"),onClick:a=>(e=>{X.value.content=e.content,X.value.params=e.params,X.value.templateCode=e.code,X.value.templateParams=e.params.reduce((function(e,a){return e[a]=void 0,e}),{}),Y.value.templateParams=e.params.reduce((function(e,a){return e[a]={required:!0,message:"参数 "+a+" 不能为空",trigger:"change"},e}),{}),G.value=!0})(e)},null,8,["title","onClick"]),[[Z,["system:sms-template:send-sms"]]]),p(d(s,{preIcon:"ep:edit",title:c(l)("action.edit"),onClick:a=>(async e=>{var a;O("update");const t=await q(e);null==(a=c(K))||a.setValues(t)})(e.id)},null,8,["title","onClick"]),[[Z,["system:sms-template:update"]]]),p(d(s,{preIcon:"ep:view",title:c(l)("action.detail"),onClick:a=>(async e=>{O("detail");const a=await q(e);N.value=a})(e.id)},null,8,["title","onClick"]),[[Z,["system:sms-template:query"]]]),p(d(s,{preIcon:"ep:delete",title:c(l)("action.del"),onClick:a=>c(U)(e.id)},null,8,["title","onClick"]),[[Z,["system:sms-template:delete"]]])])),_:1},8,["onRegister"])])),_:1}),d(R,{id:"smsTemplate",modelValue:c(E),"onUpdate:modelValue":a[3]||(a[3]=e=>v(E)?E.value=e:null),title:c(D)},{footer:u((()=>[["create","update"].includes(c(F))?(n(),f(t,{key:0,type:"primary",title:c(l)("action.save"),loading:c(z),onClick:a[1]||(a[1]=e=>W())},null,8,["title","loading"])):y("",!0),d(t,{loading:c(z),title:c(l)("dialog.close"),onClick:a[2]||(a[2]=e=>E.value=!1)},null,8,["loading","title"])])),default:u((()=>[["create","update"].includes(c(F))?(n(),f(M,{key:0,schema:c(J).formSchema,rules:c(L),ref_key:"formRef",ref:K},null,8,["schema","rules"])):y("",!0),"detail"===c(F)?(n(),f(j,{key:1,schema:c(J).detailSchema,data:c(N)},null,8,["schema","data"])):y("",!0)])),_:1},8,["modelValue","title"]),d(R,{id:"sendTest",modelValue:c(G),"onUpdate:modelValue":a[8]||(a[8]=e=>v(G)?G.value=e:null),title:"测试"},{footer:u((()=>[d(t,{type:"primary",title:c(l)("action.test"),loading:c(z),onClick:a[6]||(a[6]=e=>H())},null,8,["title","loading"]),d(t,{title:c(l)("dialog.close"),onClick:a[7]||(a[7]=e=>G.value=!1)},null,8,["title"])])),default:u((()=>[d(B,{model:c(X),rules:c(Y),"label-width":"200px","label-position":"top"},{default:u((()=>[d(Q,{label:"模板内容",prop:"content"},{default:u((()=>[d(A,{modelValue:c(X).content,"onUpdate:modelValue":a[4]||(a[4]=e=>c(X).content=e),type:"textarea",placeholder:"请输入模板内容",readonly:""},null,8,["modelValue"])])),_:1}),d(Q,{label:"手机号",prop:"mobile"},{default:u((()=>[d(A,{modelValue:c(X).mobile,"onUpdate:modelValue":a[5]||(a[5]=e=>c(X).mobile=e),placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),(n(!0),r(h,null,b(c(X).params,(e=>(n(),f(Q,{key:e,label:"参数 {"+e+"}",prop:"templateParams."+e},{default:u((()=>[d(A,{modelValue:c(X).templateParams[e],"onUpdate:modelValue":a=>c(X).templateParams[e]=a,placeholder:"请输入 "+e+" 参数"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/system/sms/smsTemplate/index.vue"]]);export{N as default};
