import{d as e,e as a,f as l,aM as t,g as o,o as s,c as i,k as r,w as n,X as u,j as d,F as m,n as c,G as p,t as f,a as v,I as y,cu as g,cf as k,ce as _,aK as h,aR as b,aa as C,ab as F,Z as w,ae as x,aq as j,a0 as S,aC as P,aQ as V,bG as D,aI as T,_ as I}from"./index-4bfb878d.js";import{c as M}from"./index-6c8a85ac.js";import{B as U,c as q}from"./ItemBom-b69b4a32.js";import O from"./productForm-667a2d8e.js";import{b as N,c as A,e as B,f as G,h as R,i as Y,j as z}from"./index-f736ac6b.js";import{P as K,a as E}from"./const-f443e30b.js";import"./index-6ebcd94a.js";import"./treeMaterial-9b585804.js";import"./materialData-d3bde0f1.js";import"./data-6c43379c.js";import"./pmOrder-563fbf59.js";const J={style:{"margin-bottom":"16px"}},Q=d("div",{class:"el-upload__text"},[u("将文件拖到此处，或"),d("em",null,"点击上传")],-1),X={class:"el-upload__tip text-center"},Z=I(e({__name:"materialData",props:{queryParams:{type:Object,default:()=>{}},tableData:{type:Array,default:()=>Array},paginationData:{type:Object,default:()=>{}},loadingTable:{type:Boolean,default:!1},treeMaterialForm:{type:Object,default:()=>{}}},emits:["searchParams","handlePagination","resetSearch"],setup(e,{emit:I}){const Z=e,H=a(null),L=a(null),W=a(),$=a([]),ee=a(!1),ae=a(""),le=a(""),te=a([]);let oe=a({itemCode:"",autoGenFlag:!1,itemName:"",specification:"",unitOfMeasure:"",unitTo:"",itemTypeId:"",enableFlag:"Y",safeStockFlag:"N",minStock:"",maxStock:"",remark:"",id:""});const se=l({open:!1,title:"物料/产品导入",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer ",Tenantid:1,accessToken:t()},url:"http://server-api:48080/mes/md/item/import"}),ie=()=>{I("searchParams")},re=async()=>{await H.value.resetFields(),Z.queryParams.itemTypeId="",I("resetSearch")},ne=()=>{ee.value=!ee.value,ae.value="新增物料/产品",le.value="addView"},ue=()=>{ye()},de=e=>{W.value.clearFiles();const a=e[0];a.uid=k(),W.value.handleStart(a)},me=async()=>{const e=await N();_.excel(e,"物料产品模版.xls")},ce=()=>{se.open=!se.open},pe=async()=>{const e=await A();_.excel(e,"物料产品管理.xls")},fe=e=>{ve(e).then((e=>{ee.value=!ee.value,ae.value="修改物料/产品",le.value="editView"}))},ve=e=>{const a=(null==e?void 0:e.id)||$.value;return new Promise(((e,l)=>{B(a).then((a=>{oe.value=a,e(a)}))}))},ye=e=>{const a=(null==e?void 0:e.id)||$.value,l=Array.isArray(a)?a:[a];h.confirm("是否删除当前行数据?").then((()=>{G(l).then((e=>{e&&(b.success("删除成功"),I("resetSearch"))}))}))},ge=e=>{$.value=e.map((e=>e.id)),U[1].disabled=!$.value.length||$.value.length>=2,U[2].disabled=!$.value.length},ke=e=>{I("handlePagination",e)},_e=()=>{L.value.handleCancel(),oe.value={itemCode:"",autoGenFlag:!1,itemName:"",specification:"",unitOfMeasure:"",unitTo:"",itemTypeId:"",enableFlag:"Y",safeStockFlag:"N",minStock:"",maxStock:"",remark:"",id:""},ee.value=!1,re()},he=async()=>{var e;if("View"===le.value)return ee.value=!ee.value;if(!(await L.value.handleSubmitForm()))return;const a={...oe.value,itemTypeId:"number"==typeof oe.value.itemTypeId?oe.value.itemTypeId:null==(e=oe.value.itemTypeId)?void 0:e.slice(-1).toString()};oe.value.id?R(a).then((e=>{e&&(b.success("修改成功"),_e())})):Y(a).then((e=>{b.success("新增成功"),_e()}))},be=(e,a,l)=>{se.isUploading=!0},Ce=()=>{se.open=!1,se.isUploading=!1,I("searchParams")},Fe=()=>{W.value.submit()},we=()=>{se.open=!se.open,W.value.clearFiles()},xe=()=>{z().then((e=>{te.value=e}))};return o((()=>{xe()})),(a,l)=>{const t=C,o=F,k=w,_=x,h=j,b=S,I=P,N=V,A=D,B=T;return s(),i(m,null,[r(_,{model:e.queryParams,inline:!0,ref_key:"ruleFormRef",ref:H},{default:n((()=>[r(o,{label:"物料编码",prop:"itemCode"},{default:n((()=>[r(t,{modelValue:e.queryParams.itemCode,"onUpdate:modelValue":l[0]||(l[0]=a=>e.queryParams.itemCode=a),placeholder:"请输入物料编码"},null,8,["modelValue"])])),_:1}),r(o,{label:"物料名称",prop:"itemName"},{default:n((()=>[r(t,{modelValue:e.queryParams.itemName,"onUpdate:modelValue":l[1]||(l[1]=a=>e.queryParams.itemName=a),placeholder:"请输入物料名称"},null,8,["modelValue"])])),_:1}),r(o,null,{default:n((()=>[r(k,{type:"primary",onClick:ie,plain:""},{default:n((()=>[u("搜索")])),_:1}),r(k,{onClick:re,plain:""},{default:n((()=>[u("重置")])),_:1})])),_:1})])),_:1},8,["model"]),d("div",J,[(s(!0),i(m,null,c(v(U),((e,a)=>(s(),p(k,{plain:"",onClick:a=>(e=>{switch(e){case"add":return ne();case"edit":return fe();case"remove":return ue();case"import":return ce();case"export":return pe()}})(e.state),key:a,type:e.type,disabled:e.disabled},{default:n((()=>[u(f(e.label),1)])),_:2},1032,["onClick","type","disabled"])))),128))]),y((s(),p(M,{pagination:e.paginationData,"is-selection":!0,tableData:e.tableData,columns:v(q),onPaginationChange:ke,onSelectionChange:ge},{itemOrProduct:n((({scope:e})=>[u(f(v(K)[e.row.itemOrProduct]),1)])),itemCode:n((({scope:e})=>[r(k,{link:"",type:"primary",onClick:a=>{return l=e.row,void ve(l).then((e=>{ee.value=!ee.value,ae.value="查看物料/产品",le.value="View"}));var l}},{default:n((()=>[u(f(e.row.itemCode),1)])),_:2},1032,["onClick"])])),enableFlag:n((({scope:e})=>[r(h,{class:"ml-2",type:"Y"===e.row.enableFlag?"success":"danger"},{default:n((()=>[u(f(v(E)[e.row.enableFlag]),1)])),_:2},1032,["type"])])),safeStockFlag:n((({scope:e})=>[r(h,{class:"ml-2",type:"Y"===e.row.safeStockFlag?"success":"danger"},{default:n((()=>[u(f(v(E)[e.row.safeStockFlag]),1)])),_:2},1032,["type"])])),operation:n((({scope:e})=>[r(k,{style:{"font-size":"17px"},link:"",type:"primary",onClick:a=>fe(e.row)},{default:n((()=>[u("修改")])),_:2},1032,["onClick"]),r(k,{style:{"font-size":"17px"},link:"",type:"danger",onClick:a=>{return l=e.row,void ye(l);var l}},{default:n((()=>[u("删除")])),_:2},1032,["onClick"])])),_:1},8,["pagination","tableData","columns"])),[[B,e.loadingTable]]),(s(),p(b,{key:Math.random(),modelValue:ee.value,"onUpdate:modelValue":l[2]||(l[2]=e=>ee.value=e),title:ae.value,width:"800px",onClose:_e},{footer:n((()=>[r(k,{type:"primary",onClick:he},{default:n((()=>[u(f("View"===le.value?"返回":"提交"),1)])),_:1}),r(k,{onClick:_e},{default:n((()=>[u("关闭")])),_:1})])),default:n((()=>[r(O,{"measure-options":te.value,treeMaterialForm:e.treeMaterialForm,productFormData:v(oe),"dialog-state":le.value,ref_key:"productFormRef",ref:L},null,8,["measure-options","treeMaterialForm","productFormData","dialog-state"])])),_:1},8,["modelValue","title"])),r(b,{title:v(se).title,modelValue:v(se).open,"onUpdate:modelValue":l[3]||(l[3]=e=>v(se).open=e),onBeforeClose:we},{footer:n((()=>[r(k,{type:"primary",onClick:Fe},{default:n((()=>[u("确 定")])),_:1}),r(k,{onClick:we},{default:n((()=>[u("取 消")])),_:1})])),default:n((()=>[r(N,{ref_key:"uploadRef",ref:W,class:"upload-demo",drag:"",action:v(se).url,limit:1,accept:".xlsx, .xls",headers:v(se).headers,disabled:v(se).isUploading,"auto-upload":!1,"on-progress":be,"on-exceed":de,"on-success":Ce},{default:n((()=>[r(I,{class:"el-icon--upload"},{default:n((()=>[r(v(g))])),_:1}),Q])),_:1},8,["action","headers","disabled"]),d("div",X,[r(A,{type:"primary",underline:!1,style:{"vertical-align":"baseline"},onClick:me},{default:n((()=>[u("下载模板")])),_:1})])])),_:1},8,["title","modelValue"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/masterData/materialManage/components/materialData.vue"]]);export{Z as default};
