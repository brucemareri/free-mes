import{f as e,D as a,r as l,d as t,q as i,K as s,e as o,g as n,C as d,o as m,c as u,k as r,w as c,a as p,G as v,F as f,n as y,I as g,j as h,t as k,J as _,z as b,at as w,au as C,L as V,M as I,N as S,H as P,aJ as T,a1 as U,a0 as x,cS as j,ab as M,aa as R,ae as q,_ as D}from"./index-4bfb878d.js";import{r as A}from"./formRules-eb36c657.js";import{u as E}from"./useVxeCrudSchemas-092b8963.js";import{b as F}from"./index-083d1298.js";import{u as z}from"./useXTable-309dffed.js";const H=e({name:[A],code:[A],accountId:[A],title:[A],content:[A],params:[A],status:[A]}),J=e({primaryKey:"id",primaryTitle:"编号",primaryType:null,action:!0,actionWidth:"260",columns:[{title:"模板编码",field:"code",isSearch:!0},{title:"模板名称",field:"name",isSearch:!0},{title:"模板标题",field:"title"},{title:"模板内容",field:"content",form:{component:"Editor",colProps:{span:24},componentProps:{valueHtml:""}}},{title:"邮箱账号",field:"accountId",isSearch:!0,table:{width:200,slots:{default:"accountId_default"}},search:{slots:{default:"accountId_search"}}},{title:"发送人名称",field:"nickname"},{title:"开启状态",field:"status",isSearch:!0,dictType:a.COMMON_STATUS,dictClass:"number"},{title:"备注",field:"remark",isTable:!1},{title:"创建时间",field:"createTime",isForm:!1,formatter:"formatDate",table:{width:180},search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:K}=E(J),L=async e=>await l.get({url:"/admin-api/system/mail-template/page",params:e}),N=async e=>await l.get({url:"/admin-api/system/mail-template/get?id="+e}),O=async e=>await l.delete({url:"/admin-api/system/mail-template/delete?id="+e}),W=t({name:"MailTemplate"}),X=D(t({...W,setup(a){const{t:t}=i(),D=s(),A=e({accountId:null}),[E,{reload:J,deleteData:W}]=z({allSchemas:K,params:A,getListApi:L,deleteApi:O}),X=o([]),G=o(!1),Q=o("edit"),B=o(!1),Y=o(""),Z=o(!1),$=o(),ee=o(),ae=e=>{B.value=!0,Q.value=t("action."+e),Y.value=e,G.value=!0},le=async()=>{var e;const a=null==(e=p($))?void 0:e.getElFormRef();a&&a.validate((async e=>{var a;if(e){Z.value=!0;try{const e=null==(a=p($))?void 0:a.formModel;"create"===Y.value?(await(async e=>await l.post({url:"/admin-api/system/mail-template/create",data:e}))(e),D.success(t("common.createSuccess"))):(await(async e=>await l.put({url:"/admin-api/system/mail-template/update",data:e}))(e),D.success(t("common.updateSuccess"))),G.value=!1}finally{Z.value=!1,await J()}}}))},te=o({content:"",params:{},mail:"",templateCode:"",templateParams:{}}),ie=o({mail:[{required:!0,message:"邮箱不能为空",trigger:"blur"}],templateCode:[{required:!0,message:"模版编号不能为空",trigger:"blur"}],templateParams:{}}),se=o(!1),oe=async()=>{const e={mail:te.value.mail,templateCode:te.value.templateCode,templateParams:te.value.templateParams},a=await(e=>l.post({url:"/admin-api/system/mail-template/send-mail",data:e}))(e);a&&D.success("提交发送成功！发送结果，见发送日志编号："+a),se.value=!1};return n((()=>{F().then((e=>{X.value=e}))})),(e,a)=>{const l=w,i=C,s=V,o=I,n=S,D=P,F=T,z=U,J=x,L=j,O=M,ne=R,de=q,me=d("hasPermi");return m(),u(f,null,[r(D,null,{default:c((()=>[r(n,{onRegister:p(E)},{accountId_search:c((()=>[r(i,{modelValue:p(A).accountId,"onUpdate:modelValue":a[0]||(a[0]=e=>p(A).accountId=e)},{default:c((()=>[(m(),v(l,{key:void 0,label:"全部",value:void 0})),(m(!0),u(f,null,y(p(X),(e=>(m(),v(l,{key:e.id,label:e.mail,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),toolbar_buttons:c((()=>[g(r(s,{type:"primary",preIcon:"ep:zoom-in",title:p(t)("action.add"),onClick:a[1]||(a[1]=e=>(ae("create"),void(B.value=!1)))},null,8,["title"]),[[me,["system:mail-template:create"]]])])),accountId_default:c((({row:e})=>{var a;return[h("span",null,k(null==(a=p(X).find((a=>a.id===e.accountId)))?void 0:a.mail),1)]})),actionbtns_default:c((({row:e})=>[g(r(o,{preIcon:"ep:cpu",title:p(t)("action.test"),onClick:a=>(e=>{te.value.content=e.content,te.value.params=e.params,te.value.templateCode=e.code,te.value.templateParams=e.params.reduce((function(e,a){return e[a]=void 0,e}),{}),ie.value.templateParams=e.params.reduce((function(e,a){return e[a]={required:!0,message:"参数 "+a+" 不能为空",trigger:"change"},e}),{}),se.value=!0})(e)},null,8,["title","onClick"]),[[me,["system:mail-template:send-mail"]]]),g(r(o,{preIcon:"ep:edit",title:p(t)("action.edit"),onClick:a=>(async e=>{var a;ae("update");const l=await N(e);null==(a=p($))||a.setValues(l),B.value=!1})(e.id)},null,8,["title","onClick"]),[[me,["system:mail-template:update"]]]),g(r(o,{preIcon:"ep:view",title:p(t)("action.detail"),onClick:a=>(async e=>{ae("detail");const a=await N(e);ee.value=a,B.value=!1})(e.id)},null,8,["title","onClick"]),[[me,["system:mail-template:query"]]]),g(r(o,{preIcon:"ep:delete",title:p(t)("action.del"),onClick:a=>p(W)(e.id)},null,8,["title","onClick"]),[[me,["system:mail-template:delete"]]])])),_:1},8,["onRegister"])])),_:1}),r(J,{id:"mailTemplateModel",loading:p(B),modelValue:p(G),"onUpdate:modelValue":a[4]||(a[4]=e=>b(G)?G.value=e:null),title:p(Q)},{footer:c((()=>[["create","update"].includes(p(Y))?(m(),v(s,{key:0,type:"primary",title:p(t)("action.save"),loading:p(Z),onClick:a[2]||(a[2]=e=>le())},null,8,["title","loading"])):_("",!0),r(s,{loading:p(Z),title:p(t)("dialog.close"),onClick:a[3]||(a[3]=e=>G.value=!1)},null,8,["loading","title"])])),default:c((()=>[["create","update"].includes(p(Y))?(m(),v(F,{key:0,ref_key:"formRef",ref:$,schema:p(K).formSchema,rules:p(H)},{accountId:c((e=>[r(i,{modelValue:e.accountId,"onUpdate:modelValue":a=>e.accountId=a},{default:c((()=>[(m(!0),u(f,null,y(p(X),(e=>(m(),v(l,{key:e.id,label:e.mail,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},8,["schema","rules"])):_("",!0),"detail"===p(Y)?(m(),v(z,{key:1,schema:p(K).detailSchema,data:p(ee)},null,8,["schema","data"])):_("",!0)])),_:1},8,["loading","modelValue","title"]),r(J,{id:"sendTest",modelValue:p(se),"onUpdate:modelValue":a[8]||(a[8]=e=>b(se)?se.value=e:null),title:"测试"},{footer:c((()=>[r(s,{type:"primary",title:p(t)("action.test"),loading:p(Z),onClick:a[6]||(a[6]=e=>oe())},null,8,["title","loading"]),r(s,{title:p(t)("dialog.close"),onClick:a[7]||(a[7]=e=>se.value=!1)},null,8,["title"])])),default:c((()=>[r(de,{model:p(te),rules:p(ie),"label-width":"200px","label-position":"top"},{default:c((()=>[r(O,{label:"模板内容",prop:"content"},{default:c((()=>[r(L,{"model-value":p(te).content,readonly:"",height:"150px"},null,8,["model-value"])])),_:1}),r(O,{label:"收件邮箱",prop:"mail"},{default:c((()=>[r(ne,{modelValue:p(te).mail,"onUpdate:modelValue":a[5]||(a[5]=e=>p(te).mail=e),placeholder:"请输入收件邮箱"},null,8,["modelValue"])])),_:1}),(m(!0),u(f,null,y(p(te).params,(e=>(m(),v(O,{key:e,label:"参数 {"+e+"}",prop:"templateParams."+e},{default:c((()=>[r(ne,{modelValue:p(te).templateParams[e],"onUpdate:modelValue":a=>p(te).templateParams[e]=a,placeholder:"请输入 "+e+" 参数"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/system/mail/template/index.vue"]]);export{X as default};
