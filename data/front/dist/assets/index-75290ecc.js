import{q as e,f as a,D as t,d as l,K as s,e as o,g as i,o as r,G as n,w as c,k as d,a as u,z as m,J as p,j as f,X as v,L as y,M as h,N as k,aO as g,ch as _,l as C,aJ as w,a0 as x,H as S,_ as I}from"./index-4bfb878d.js";import{d as T,h as b}from"./tree-5260b4e2.js";import{r as j}from"./formRules-eb36c657.js";import{u as V}from"./useVxeCrudSchemas-092b8963.js";import{a as R,d as D,b as K,c as P,u as M}from"./index-7df6b46e.js";import{l as U}from"./index-9f33c93a.js";import{u as E}from"./useXTable-309dffed.js";const{t:A}=e(),H=a({name:[j],id:[j],type:[j],remark:[j],status:[j],menuIds:[j]}),N=a({primaryKey:"id",primaryType:"id",primaryTitle:"套餐编号",action:!0,columns:[{title:"套餐名称",field:"name",isSearch:!0},{title:A("common.status"),field:"status",dictType:t.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:"菜单权限",field:"menuIds",isTable:!1,form:{colProps:{span:24}}},{title:A("form.remark"),field:"remark",isTable:!1,isSearch:!0,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}}},{title:"创建时间",field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:O}=V(N),X={class:"card-header"},q=l({name:"TenantPackage"}),z=I(l({...q,setup(a){const{t:t}=e(),l=s(),I=o([]),j=o(!1),V=o(!1),A=o(),N=o(!1),q=o(),z=o(!1),F=o(""),J=o(!1),L=o("edit");H.menuIds=[{required:!0,validator:(e,a,t)=>{A.value.getCheckedKeys().length?t():t(new Error("该项为必填项"))},trigger:"blur"}];const[G,{reload:Q,deleteData:W}]=E({allSchemas:O,getListApi:R,deleteApi:D}),B=e=>{L.value=t("action."+e),F.value=e,J.value=!0};return i((async()=>{await(async()=>{const e=await U();I.value=b(e)})()})),(e,a)=>{const s=y,o=h,i=k,b=g,R=_,D=C,U=w,E=x,Y=S;return r(),n(Y,null,{default:c((()=>[d(i,{onRegister:u(G)},{toolbar_buttons:c((()=>[d(s,{type:"primary",preIcon:"ep:zoom-in",title:u(t)("action.add"),onClick:a[0]||(a[0]=e=>{return null==(a=u(A))||a.setCheckedKeys([]),j.value=!1,V.value=!1,void B("create");var a})},null,8,["title"])])),actionbtns_default:c((({row:e})=>[d(o,{preIcon:"ep:edit",title:u(t)("action.edit"),onClick:a=>(async e=>{var a,t;B("update");const l=await K(e);null==(a=u(q))||a.setValues(l),null==(t=l.menuIds)||t.forEach((e=>{var a;null==(a=u(A))||a.setChecked(e,!0,!1)}))})(e.id)},null,8,["title","onClick"]),d(o,{preIcon:"ep:delete",title:u(t)("action.del"),onClick:a=>u(W)(e.id)},null,8,["title","onClick"])])),_:1},8,["onRegister"]),d(E,{modelValue:u(J),"onUpdate:modelValue":a[5]||(a[5]=e=>m(J)?J.value=e:null),title:u(L)},{footer:c((()=>[["create","update"].includes(u(F))?(r(),n(s,{key:0,type:"primary",title:u(t)("action.save"),loading:u(z),onClick:a[3]||(a[3]=e=>(async()=>{var e;const a=null==(e=u(q))?void 0:e.getElFormRef();a&&a.validate((async e=>{var a;if(e){z.value=!0;try{const e=null==(a=u(q))?void 0:a.formModel;e.menuIds=[...A.value.getCheckedKeys(!1),...A.value.getHalfCheckedKeys()],"create"===F.value?(await P(e),l.success(t("common.createSuccess"))):(await M(e),l.success(t("common.updateSuccess"))),J.value=!1}finally{z.value=!1,await Q()}}}))})())},null,8,["title","loading"])):p("",!0),d(s,{loading:u(z),title:u(t)("dialog.close"),onClick:a[4]||(a[4]=e=>J.value=!1)},null,8,["loading","title"])])),default:c((()=>[["create","update"].includes(u(F))?(r(),n(U,{key:0,schema:u(O).formSchema,rules:u(H),ref_key:"formRef",ref:q},{menuIds:c((()=>[d(D,{class:"cardHeight"},{header:c((()=>[f("div",X,[v(" 全选/全不选: "),d(b,{modelValue:u(N),"onUpdate:modelValue":a[1]||(a[1]=e=>m(N)?N.value=e:null),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:a[2]||(a[2]=e=>{A.value.setCheckedNodes(N.value?I.value:[])})},null,8,["modelValue"])])])),default:c((()=>[d(R,{ref_key:"treeRef",ref:A,"node-key":"id","show-checkbox":"",props:u(T),data:u(I),"empty-text":"加载中，请稍候"},null,8,["props","data"])])),_:1})])),_:1},8,["schema","rules"])):p("",!0)])),_:1},8,["modelValue","title"])])),_:1})}}}),[["__scopeId","data-v-3101f824"],["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/system/tenantPackage/index.vue"]]);export{z as default};
