import{r as e,f as a,D as l,d as s,$ as t,e as o,ar as u,g as i,C as d,o as r,G as p,w as n,H as m,k as f,as as c,a as y,I as v,c as I,n as g,X as b,t as h,F as _,J as k,z as V,q as w,K as S,aq as x,M as D,N as G,aa as U,ab as T,at as j,au as q,av as R,ae as A,L as C,a0 as K,_ as N}from"./index-4bfb878d.js";import{l as P}from"./index-676910fd.js";import{l as E}from"./index-2af8984f.js";import{g as L}from"./index-5d266c5c.js";import{l as M}from"./index-2931315e.js";import{l as B}from"./index-a751e4d0.js";import{h as X,d as Y}from"./tree-5260b4e2.js";import{u as z}from"./useVxeCrudSchemas-092b8963.js";import{u as F}from"./useXTable-309dffed.js";const H=async a=>await e.get({url:"/admin-api/bpm/task-assign-rule/list",params:a}),J=a({type:[{required:!0,message:"规则类型不能为空",trigger:"change"}],roleIds:[{required:!0,message:"指定角色不能为空",trigger:"change"}],deptIds:[{required:!0,message:"指定部门不能为空",trigger:"change"}],postIds:[{required:!0,message:"指定岗位不能为空",trigger:"change"}],userIds:[{required:!0,message:"指定用户不能为空",trigger:"change"}],userGroupIds:[{required:!0,message:"指定用户组不能为空",trigger:"change"}],scripts:[{required:!0,message:"指定脚本不能为空",trigger:"change"}]}),Q=a({primaryKey:"id",primaryType:null,action:!0,actionWidth:"200px",columns:[{title:"任务名",field:"taskDefinitionName"},{title:"任务标识",field:"taskDefinitionKey"},{title:"规则类型",field:"type",dictType:l.BPM_TASK_ASSIGN_RULE_TYPE,dictClass:"number"},{title:"规则范围",field:"options",table:{slots:{default:"options_default"}}}]}),{allSchemas:W}=z(Q),$=s({name:"TaskAssignRule"}),O=N(s({...$,setup(s){const{t:N}=w(),z=S(),{query:Q}=t(),$=o(),O=o(),Z=o(),ee=o(),ae=o(),le=o(),se=o(),te=u(l.BPM_TASK_ASSIGN_SCRIPT),oe=Q.modelId,ue=Q.processDefinitionId;let ie=(e=>!!e)(oe);const de=a({modelId:oe,processDefinitionId:ue}),[re,{reload:pe}]=F({allSchemas:W,params:de,getListApi:H,isList:!0}),ne=(e,a)=>{if(10===e){for(const l of O.value)if(l.id===a)return l.name}else if(20===e||21===e){for(const l of Z.value)if(l.id===a)return l.name}else if(22===e){for(const l of ae.value)if(l.id===a)return l.name}else if(30===e||31===e||32===e){for(const l of le.value)if(l.id===a)return l.nickname}else if(40===e){for(const l of se.value)if(l.id===a)return l.name}else if(50===e){a+="";for(const e of te)if(e.value===a)return e.label}return"未知("+a+")"},me=o(!1),fe=o(!1),ce=o(),ye=o(),ve=async()=>{const a=y(ce);if(!a)return;if(!(await a.validate()))return;let l={...ye.value,taskDefinitionName:void 0};10===l.type?l.options=l.roleIds:20===l.type||21===l.type?l.options=l.deptIds:22===l.type?l.options=l.postIds:30===l.type||31===l.type||32===l.type?l.options=l.userIds:40===l.type?l.options=l.userGroupIds:50===l.type&&(l.options=l.scripts),l.roleIds=void 0,l.deptIds=void 0,l.postIds=void 0,l.userIds=void 0,l.userGroupIds=void 0,l.scripts=void 0,me.value=!0;try{const a=l;a.id?(await(async a=>await e.put({url:"/admin-api/bpm/task-assign-rule/update",data:a}))(a),z.success(N("common.updateSuccess"))):(await(async a=>await e.post({url:"/admin-api/bpm/task-assign-rule/create",data:a}))(a),z.success(N("common.createSuccess"))),fe.value=!1}finally{me.value=!1,await pe()}};return i((()=>{O.value=[],P().then((e=>{O.value.push(...e)})),Z.value=[],ee.value=[],B().then((e=>{Z.value.push(...e),ee.value.push(...X(e,"id"))})),ae.value=[],E().then((e=>{ae.value.push(...e)})),le.value=[],L().then((e=>{le.value.push(...e)})),se.value=[],M().then((e=>{se.value.push(...e)})),ie||setTimeout((()=>{$.value.Ref.hideColumn("actionbtns")}),100)})),(e,a)=>{const s=x,t=D,o=G,i=U,w=T,S=j,P=q,E=R,L=A,M=C,B=K,X=m,z=d("hasPermi");return r(),p(X,null,{default:n((()=>[f(o,{onRegister:y(re),ref_key:"xGrid",ref:$},c({options_default:n((({row:e})=>[(r(!0),I(_,null,g(e.options,(a=>(r(),I("span",{key:a},[f(s,null,{default:n((()=>[b(h(ne(e.type,a)),1)])),_:2},1024),b("   ")])))),128))])),_:2},[y(oe)?{name:"actionbtns_default",fn:n((({row:e})=>[v(f(t,{preIcon:"ep:edit",title:y(N)("action.edit"),onClick:a=>(e=>{ye.value={},ye.value={...e,modelId:oe,options:[],roleIds:[],deptIds:[],postIds:[],userIds:[],userGroupIds:[],scripts:[]},10===e.type?ye.value.roleIds.push(...e.options):20===e.type||21===e.type?ye.value.deptIds.push(...e.options):22===e.type?ye.value.postIds.push(...e.options):30===e.type||31===e.type||32===e.type?ye.value.userIds.push(...e.options):40===e.type?ye.value.userGroupIds.push(...e.options):50===e.type&&ye.value.scripts.push(...e.options),fe.value=!0,me.value=!1})(e)},null,8,["title","onClick"]),[[z,["bpm:task-assign-rule:update"]]])])),key:"0"}:void 0]),1032,["onRegister"]),f(B,{modelValue:y(fe),"onUpdate:modelValue":a[10]||(a[10]=e=>V(fe)?fe.value=e:null),title:"修改任务规则",width:"800",height:"35%"},{footer:n((()=>[f(M,{type:"primary",title:y(N)("action.save"),loading:y(me),onClick:ve},null,8,["title","loading"]),f(M,{loading:y(me),title:y(N)("dialog.close"),onClick:a[9]||(a[9]=e=>fe.value=!1)},null,8,["loading","title"])])),default:n((()=>[f(L,{ref_key:"formRef",ref:ce,model:y(ye),rules:y(J),"label-width":"80px"},{default:n((()=>[f(w,{label:"任务名称",prop:"taskDefinitionName"},{default:n((()=>[f(i,{modelValue:y(ye).taskDefinitionName,"onUpdate:modelValue":a[0]||(a[0]=e=>y(ye).taskDefinitionName=e),placeholder:"请输入流标标识",disabled:""},null,8,["modelValue"])])),_:1}),f(w,{label:"任务标识",prop:"taskDefinitionKey"},{default:n((()=>[f(i,{modelValue:y(ye).taskDefinitionKey,"onUpdate:modelValue":a[1]||(a[1]=e=>y(ye).taskDefinitionKey=e),placeholder:"请输入任务标识",disabled:""},null,8,["modelValue"])])),_:1}),f(w,{label:"规则类型",prop:"type"},{default:n((()=>[f(P,{modelValue:y(ye).type,"onUpdate:modelValue":a[2]||(a[2]=e=>y(ye).type=e),clearable:"",style:{width:"100%"}},{default:n((()=>[(r(!0),I(_,null,g(y(u)(y(l).BPM_TASK_ASSIGN_RULE_TYPE),(e=>(r(),p(S,{key:parseInt(e.value),label:e.label,value:parseInt(e.value)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),10===y(ye).type?(r(),p(w,{key:0,label:"指定角色",prop:"roleIds"},{default:n((()=>[f(P,{modelValue:y(ye).roleIds,"onUpdate:modelValue":a[3]||(a[3]=e=>y(ye).roleIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:n((()=>[(r(!0),I(_,null,g(y(O),(e=>(r(),p(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):k("",!0),20===y(ye).type||21===y(ye).type?(r(),p(w,{key:1,label:"指定部门",prop:"deptIds",span:"24"},{default:n((()=>[f(E,{ref:"treeRef",modelValue:y(ye).deptIds,"onUpdate:modelValue":a[4]||(a[4]=e=>y(ye).deptIds=e),"node-key":"id","show-checkbox":"",props:y(Y),data:y(ee),"empty-text":"加载中，请稍后",multiple:""},null,8,["modelValue","props","data"])])),_:1})):k("",!0),22===y(ye).type?(r(),p(w,{key:2,label:"指定岗位",prop:"postIds",span:"24"},{default:n((()=>[f(P,{modelValue:y(ye).postIds,"onUpdate:modelValue":a[5]||(a[5]=e=>y(ye).postIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:n((()=>[(r(!0),I(_,null,g(y(ae),(e=>(r(),p(S,{key:parseInt(e.id),label:e.name,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):k("",!0),30===y(ye).type||31===y(ye).type||32===y(ye).type?(r(),p(w,{key:3,label:"指定用户",prop:"userIds",span:"24"},{default:n((()=>[f(P,{modelValue:y(ye).userIds,"onUpdate:modelValue":a[6]||(a[6]=e=>y(ye).userIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:n((()=>[(r(!0),I(_,null,g(y(le),(e=>(r(),p(S,{key:parseInt(e.id),label:e.nickname,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):k("",!0),40===y(ye).type?(r(),p(w,{key:4,label:"指定用户组",prop:"userGroupIds"},{default:n((()=>[f(P,{modelValue:y(ye).userGroupIds,"onUpdate:modelValue":a[7]||(a[7]=e=>y(ye).userGroupIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:n((()=>[(r(!0),I(_,null,g(y(se),(e=>(r(),p(S,{key:parseInt(e.id),label:e.name,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):k("",!0),50===y(ye).type?(r(),p(w,{key:5,label:"指定脚本",prop:"scripts"},{default:n((()=>[f(P,{modelValue:y(ye).scripts,"onUpdate:modelValue":a[8]||(a[8]=e=>y(ye).scripts=e),multiple:"",clearable:"",style:{width:"100%"}},{default:n((()=>[(r(!0),I(_,null,g(y(te),(e=>(r(),p(S,{key:parseInt(e.value),label:e.label,value:parseInt(e.value)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):k("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1})}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/bpm/taskAssignRule/index.vue"]]);export{O as default};
