import{q as e,f as a,r as l,d as t,K as i,e as o,C as s,o as r,c as n,k as u,w as c,a as d,I as p,G as m,j as f,t as g,z as v,F as y,X as h,aM as _,aN as k,a8 as w,L as C,M as S,N as x,H as b,ck as j,a1 as V,a0 as z,Y as I,aQ as R,_ as L}from"./index-4bfb878d.js";import{u as T}from"./useVxeCrudSchemas-092b8963.js";import{u as D}from"./useXTable-309dffed.js";const{t:M}=e(),U=a({primaryKey:"id",primaryType:"seq",action:!0,columns:[{title:"文件名",field:"name"},{title:"文件路径",field:"path",isSearch:!0},{title:"URL",field:"url",table:{cellRender:{name:"XPreview"}}},{title:"文件大小",field:"size",formatter:"formatSize"},{title:"文件类型",field:"type",isSearch:!0},{title:M("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:X}=T(U),A=e=>l.get({url:"/admin-api/infra/file/page",params:e}),F=e=>l.delete({url:"/admin-api/infra/file/delete?id="+e}),P=f("div",{class:"el-upload__text"},[h("将文件拖到此处，或"),f("em",null,"点击上传")],-1),q=f("div",{class:"el-upload__tip"},"请上传 .jpg, .png, .gif 标准格式文件",-1),B=t({name:"FileList"}),E=L(t({...B,setup(a){const{t:l}=e(),t=i(),[h,{reload:L,deleteData:T}]=D({allSchemas:X,getListApi:A,deleteApi:F}),M=o(),U=o(!1),B=o(""),E=o(!1),K=o("上传"),N=o(0),Q=o(!1),G=o();const H=o(),Y=e=>{const a="image/jpeg"===e.type||"image/gif",l=e.size/1024/1024<5;return a||t.error("上传文件只能是 jpeg / gif / png 格式!"),l||t.error("上传文件大小不能超过 5MB!"),a&&l},J=async e=>{0===e.code?(t.success("上传成功"),E.value=!1,Q.value=!1,await L()):t.error(e.msg)},O=()=>{t.error("最多只能上传一个文件！")},W=()=>{t.error("导入数据失败，请您重新上传！")};return(e,a)=>{const i=C,o=S,L=x,D=b,A=j,F=V,Z=z,$=I,ee=R,ae=s("hasPermi");return r(),n(y,null,[u(D,null,{default:c((()=>[u(L,{onRegister:d(h)},{toolbar_buttons:c((()=>[u(i,{type:"primary",preIcon:"ep:upload",title:"上传文件",onClick:a[0]||(a[0]=e=>E.value=!0)})])),actionbtns_default:c((({row:e})=>[u(o,{preIcon:"ep:copy-document",title:d(l)("common.copy"),onClick:a=>(async e=>{const{copy:a,copied:i,isSupported:o}=w({source:e});o?(await a(),d(i)&&t.success(l("common.copySuccess"))):t.error(l("common.copyError"))})(e.url)},null,8,["title","onClick"]),u(o,{preIcon:"ep:view",title:d(l)("action.detail"),onClick:a=>(e=>{M.value=e,B.value=l("action.detail"),U.value=!0})(e)},null,8,["title","onClick"]),p(u(o,{preIcon:"ep:delete",title:d(l)("action.del"),onClick:a=>d(T)(e.id)},null,8,["title","onClick"]),[[ae,["infra:file:delete"]]])])),_:1},8,["onRegister"])])),_:1}),u(Z,{modelValue:d(U),"onUpdate:modelValue":a[2]||(a[2]=e=>v(U)?U.value=e:null),title:d(B)},{footer:c((()=>[u(i,{title:d(l)("dialog.close"),onClick:a[1]||(a[1]=e=>U.value=!1)},null,8,["title"])])),default:c((()=>[u(F,{schema:d(X).detailSchema,data:d(M)},{url:c((({row:e})=>[(e.type,r(),m(A,{style:{width:"100px",height:"100px"},src:e.url,key:e.url,lazy:""},null,8,["src"])),f("span",null,g(e.url),1)])),_:1},8,["schema","data"])])),_:1},8,["modelValue","title"]),u(Z,{modelValue:d(E),"onUpdate:modelValue":a[5]||(a[5]=e=>v(E)?E.value=e:null),title:d(K)},{footer:c((()=>[u(i,{type:"primary",preIcon:"ep:upload-filled",title:d(l)("action.save"),onClick:a[3]||(a[3]=e=>(H.value={Authorization:"Bearer "+_(),"tenant-id":k()},Q.value=!0,void G.value.submit()))},null,8,["title"]),u(i,{title:d(l)("dialog.close"),onClick:a[4]||(a[4]=e=>E.value=!1)},null,8,["title"])])),default:c((()=>[u(ee,{ref_key:"uploadRef",ref:G,action:d("https://mesv2-api.cloudmes.io/admin-api/infra/file/upload")+"?updateSupport="+d(N),headers:d(H),drag:!0,limit:1,multiple:!0,"show-file-list":!0,disabled:d(Q),"before-upload":Y,"on-exceed":O,"on-success":J,"on-error":W,"auto-upload":!1,accept:".jpg, .png, .gif"},{tip:c((()=>[q])),default:c((()=>[u($,{icon:"ep:upload-filled"}),P])),_:1},8,["action","headers","disabled"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/infra/fileList/index.vue"]]);export{E as default};
