import{r as e,q as a,f as l,D as o,d as t,K as i,e as n,C as d,o as s,c as r,k as c,w as u,a as m,I as p,G as f,J as g,F as k,n as V,a7 as y,X as b,z as h,L as _,M as v,N as w,H as S,aa as C,ab as U,at as I,au as T,aL as P,ac as R,ad as A,ae as K,a1 as x,a0 as F,_ as D}from"./index-4bfb878d.js";import{r as E}from"./formRules-eb36c657.js";import{u as L}from"./useVxeCrudSchemas-092b8963.js";import{u as N}from"./useXTable-309dffed.js";const j=a=>e.get({url:"/admin-api/infra/file-config/page",params:a}),G=a=>e.get({url:"/admin-api/infra/file-config/get?id="+a}),O=a=>e.delete({url:"/admin-api/infra/file-config/delete?id="+a}),{t:X}=a(),q=l({name:[E],storage:[E],config:{basePath:[E],host:[E],port:[E],username:[E],password:[E],mode:[E],endpoint:[E],bucket:[E],accessKey:[E],accessSecret:[E],domain:[E]}}),z=l({primaryKey:"id",primaryType:"id",primaryTitle:"配置编号",action:!0,actionWidth:"400px",columns:[{title:"配置名",field:"name",isSearch:!0},{title:"存储器",field:"storage",dictType:o.INFRA_FILE_STORAGE,dictClass:"number",isSearch:!0},{title:"主配置",field:"master",dictType:o.INFRA_BOOLEAN_STRING,dictClass:"boolean"},{title:X("form.remark"),field:"remark",form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}}},{title:X("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:M}=L(z),W=t({name:"FileConfig"}),B=D(t({...W,setup(l){const{t:t}=a(),D=i(),[E,{reload:L,deleteData:X}]=N({allSchemas:M,getListApi:j,deleteApi:O}),z=n(!1),W=n(""),B=n(!1),H=n("edit"),J=n(),Q=n(),Y=n({id:0,name:"",storage:0,master:!1,visible:!1,config:{basePath:"",host:"",port:0,username:"",password:"",mode:"",endpoint:"",bucket:"",accessKey:"",accessSecret:"",domain:""},remark:"",createTime:new Date}),Z=e=>{H.value=t("action."+e),W.value=e,B.value=!0},$=a=>{D.confirm("是否确认修改配置【 "+a.name+" 】为主配置?",t("common.reminder")).then((async()=>{var l;await(l=a.id,e.put({url:"/admin-api/infra/file-config/update-master?id="+l})),await L()}))},ee=async a=>{const l=await(o=a,e.get({url:"/admin-api/infra/file-config/test?id="+o}));var o;D.alert("测试通过，上传文件成功！访问地址："+l)},ae=async a=>{a&&a.validate((async a=>{if(a){z.value=!0;try{"create"===W.value?(await(l=Y.value,e.post({url:"/admin-api/infra/file-config/create",data:l})),D.success(t("common.createSuccess"))):(await(a=>e.put({url:"/admin-api/infra/file-config/update",data:a}))(Y.value),D.success(t("common.updateSuccess"))),B.value=!1}finally{z.value=!1,await L()}}var l}))};return(e,a)=>{const l=_,i=v,n=w,D=S,L=C,N=U,j=I,O=T,le=P,oe=R,te=A,ie=K,ne=x,de=F,se=d("hasPermi");return s(),r(k,null,[c(D,null,{default:u((()=>[c(n,{onRegister:m(E)},{toolbar_buttons:u((()=>[p(c(l,{type:"primary",preIcon:"ep:zoom-in",title:m(t)("action.add"),onClick:a[0]||(a[0]=e=>{return a=m(J),Z("create"),null==a||a.resetFields(),void(Y.value={id:0,name:"",storage:0,master:!1,visible:!1,config:{basePath:"",host:"",port:0,username:"",password:"",mode:"",endpoint:"",bucket:"",accessKey:"",accessSecret:"",domain:""},remark:"",createTime:new Date});var a})},null,8,["title"]),[[se,["infra:file-config:create"]]])])),actionbtns_default:u((({row:e})=>[p(c(i,{preIcon:"ep:edit",title:m(t)("action.edit"),onClick:a=>(async e=>{const a=await G(e);Y.value=a,Z("update")})(e.id)},null,8,["title","onClick"]),[[se,["infra:file-config:update"]]]),p(c(i,{preIcon:"ep:view",title:m(t)("action.detail"),onClick:a=>(async e=>{Z("detail");const a=await G(e);Q.value=a})(e.id)},null,8,["title","onClick"]),[[se,["infra:file-config:query"]]]),p(c(i,{preIcon:"ep:flag",title:"主配置",onClick:a=>$(e)},null,8,["onClick"]),[[se,["infra:file-config:update"]]]),c(i,{preIcon:"ep:share",title:m(t)("action.test"),onClick:a=>ee(e.id)},null,8,["title","onClick"]),p(c(i,{preIcon:"ep:delete",title:m(t)("action.del"),onClick:a=>m(X)(e.id)},null,8,["title","onClick"]),[[se,["infra:file-config:delete"]]])])),_:1},8,["onRegister"])])),_:1}),c(de,{modelValue:m(B),"onUpdate:modelValue":a[18]||(a[18]=e=>h(B)?B.value=e:null),title:m(H)},{footer:u((()=>[["create","update"].includes(m(W))?(s(),f(l,{key:0,type:"primary",title:m(t)("action.save"),loading:m(z),onClick:a[16]||(a[16]=e=>ae(m(J)))},null,8,["title","loading"])):g("",!0),c(l,{loading:m(z),title:m(t)("dialog.close"),onClick:a[17]||(a[17]=e=>B.value=!1)},null,8,["loading","title"])])),default:u((()=>[["create","update"].includes(m(W))?(s(),f(ie,{key:0,ref_key:"formRef",ref:J,model:m(Y),rules:m(q),"label-width":"120px"},{default:u((()=>[c(N,{label:"配置名",prop:"name"},{default:u((()=>[c(L,{modelValue:m(Y).name,"onUpdate:modelValue":a[1]||(a[1]=e=>m(Y).name=e),placeholder:"请输入配置名"},null,8,["modelValue"])])),_:1}),c(N,{label:"备注",prop:"remark"},{default:u((()=>[c(L,{modelValue:m(Y).remark,"onUpdate:modelValue":a[2]||(a[2]=e=>m(Y).remark=e),placeholder:"请输入备注"},null,8,["modelValue"])])),_:1}),c(N,{label:"存储器",prop:"storage"},{default:u((()=>[c(O,{modelValue:m(Y).storage,"onUpdate:modelValue":a[3]||(a[3]=e=>m(Y).storage=e),placeholder:"请选择存储器",disabled:0!==m(Y).id},{default:u((()=>[(s(!0),r(k,null,V(m(y)(m(o).INFRA_FILE_STORAGE),((e,a)=>(s(),f(j,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),m(Y).storage>=10&&m(Y).storage<=12?(s(),f(N,{key:0,label:"基础路径",prop:"config.basePath"},{default:u((()=>[c(L,{modelValue:m(Y).config.basePath,"onUpdate:modelValue":a[4]||(a[4]=e=>m(Y).config.basePath=e),placeholder:"请输入基础路径"},null,8,["modelValue"])])),_:1})):g("",!0),m(Y).storage>=11&&m(Y).storage<=12?(s(),f(N,{key:1,label:"主机地址",prop:"config.host"},{default:u((()=>[c(L,{modelValue:m(Y).config.host,"onUpdate:modelValue":a[5]||(a[5]=e=>m(Y).config.host=e),placeholder:"请输入主机地址"},null,8,["modelValue"])])),_:1})):g("",!0),m(Y).storage>=11&&m(Y).storage<=12?(s(),f(N,{key:2,label:"主机端口",prop:"config.port"},{default:u((()=>[c(le,{min:0,modelValue:m(Y).config.port,"onUpdate:modelValue":a[6]||(a[6]=e=>m(Y).config.port=e),placeholder:"请输入主机端口"},null,8,["modelValue"])])),_:1})):g("",!0),m(Y).storage>=11&&m(Y).storage<=12?(s(),f(N,{key:3,label:"用户名",prop:"config.username"},{default:u((()=>[c(L,{modelValue:m(Y).config.username,"onUpdate:modelValue":a[7]||(a[7]=e=>m(Y).config.username=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})):g("",!0),m(Y).storage>=11&&m(Y).storage<=12?(s(),f(N,{key:4,label:"密码",prop:"config.password"},{default:u((()=>[c(L,{modelValue:m(Y).config.password,"onUpdate:modelValue":a[8]||(a[8]=e=>m(Y).config.password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})):g("",!0),11===m(Y).storage?(s(),f(N,{key:5,label:"连接模式",prop:"config.mode"},{default:u((()=>[c(te,{modelValue:m(Y).config.mode,"onUpdate:modelValue":a[9]||(a[9]=e=>m(Y).config.mode=e)},{default:u((()=>[c(oe,{key:"Active",label:"Active"},{default:u((()=>[b("主动模式")])),_:1}),c(oe,{key:"Passive",label:"Passive"},{default:u((()=>[b("主动模式")])),_:1})])),_:1},8,["modelValue"])])),_:1})):g("",!0),20===m(Y).storage?(s(),f(N,{key:6,label:"节点地址",prop:"config.endpoint"},{default:u((()=>[c(L,{modelValue:m(Y).config.endpoint,"onUpdate:modelValue":a[10]||(a[10]=e=>m(Y).config.endpoint=e),placeholder:"请输入节点地址"},null,8,["modelValue"])])),_:1})):g("",!0),20===m(Y).storage?(s(),f(N,{key:7,label:"存储 bucket",prop:"config.bucket"},{default:u((()=>[c(L,{modelValue:m(Y).config.bucket,"onUpdate:modelValue":a[11]||(a[11]=e=>m(Y).config.bucket=e),placeholder:"请输入 bucket"},null,8,["modelValue"])])),_:1})):g("",!0),20===m(Y).storage?(s(),f(N,{key:8,label:"accessKey",prop:"config.accessKey"},{default:u((()=>[c(L,{modelValue:m(Y).config.accessKey,"onUpdate:modelValue":a[12]||(a[12]=e=>m(Y).config.accessKey=e),placeholder:"请输入 accessKey"},null,8,["modelValue"])])),_:1})):g("",!0),20===m(Y).storage?(s(),f(N,{key:9,label:"accessSecret",prop:"config.accessSecret"},{default:u((()=>[c(L,{modelValue:m(Y).config.accessSecret,"onUpdate:modelValue":a[13]||(a[13]=e=>m(Y).config.accessSecret=e),placeholder:"请输入 accessSecret"},null,8,["modelValue"])])),_:1})):g("",!0),20===m(Y).storage?(s(),f(N,{key:10,label:"自定义域名"},{default:u((()=>[c(L,{modelValue:m(Y).config.domain,"onUpdate:modelValue":a[14]||(a[14]=e=>m(Y).config.domain=e),placeholder:"请输入自定义域名"},null,8,["modelValue"])])),_:1})):m(Y).storage?(s(),f(N,{key:11,label:"自定义域名",prop:"config.domain"},{default:u((()=>[c(L,{modelValue:m(Y).config.domain,"onUpdate:modelValue":a[15]||(a[15]=e=>m(Y).config.domain=e),placeholder:"请输入自定义域名"},null,8,["modelValue"])])),_:1})):g("",!0)])),_:1},8,["model","rules"])):g("",!0),"detail"===m(W)?(s(),f(ne,{key:1,schema:m(M).detailSchema,data:m(Q)},null,8,["schema","data"])):g("",!0)])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/infra/fileConfig/index.vue"]]);export{B as default};
