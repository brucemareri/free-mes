import{f as e,r as a,d as l,e as t,g as i,a6 as r,o,c as s,k as n,w as d,X as u,j as p,F as c,n as m,G as y,t as h,a as v,I as f,ce as b,cf as w,aK as g,aR as _,aa as k,ab as C,Z as x,ae as V,a0 as F,aC as P,aQ as T,bG as S,aI as j,_ as D}from"./index-4bfb878d.js";import{c as I}from"./index-6c8a85ac.js";import N from"./productForm-b483527f.js";import{g as q}from"./index-b10e131e.js";import{M}from"./const-f443e30b.js";import"./index-f736ac6b.js";const U=e([{type:"primary",icon:"plus",state:"add",label:"新增",disabled:!1,permissions:[]},{type:"success",icon:"edit",state:"edit",label:"修改",disabled:!0,permissions:[]},{type:"danger",icon:"delete",state:"remove",label:"删除",disabled:!0,permissions:[]},{type:"info",icon:"upload2",state:"import",label:"导入",disabled:!1,permissions:[]},{type:"warning",icon:"ep:zoom-in",state:"export",label:"导出",disabled:!1,permissions:[]}]),A=[{label:"设备编码",slot:"machineryCode"},{prop:"machineryName",label:"设备名称",width:"120"},{prop:"machineryTypeName",label:"所属分类",width:"120"},{prop:"workshopName",label:"所属车间",width:"120"},{label:"设备状态",prop:"status"},{label:"位置",prop:"location",width:"100"},{prop:"createTime",label:"创建时间",width:"180"},{prop:"purchasingTime",label:"购买日期",width:"180"},{prop:"pclModel",label:"型号",width:"180"},{prop:"capacity",label:"产能",width:"180"},{prop:"updater",label:"修改人"},{prop:"updateTime",label:"修改时间",width:"180"},{label:"操作",slot:"operation",width:"120",fixed:"right"}],B={style:{"margin-bottom":"16px"}},z=p("div",{class:"el-upload__text"},[u("将文件拖到此处，或"),p("em",null,"点击上传")],-1),G={class:"el-upload__tip text-center"},O=D(l({__name:"materialData",props:{queryParams:{type:Object,default:()=>{}},tableData:{type:Array,default:()=>Array},paginationData:{type:Object,default:()=>{}},loadingTable:{type:Boolean,default:!1},treeMaterialForm:{type:Object,default:()=>{}}},emits:["searchParams","handlePagination","resetSearch"],setup(l,{emit:D}){const O=l,R=t(null),E=t(null),J=t(),K=t([]),Q=t(!1),X=t(""),Z=t(""),$=t([]);let H=t({machineryCode:"",autoGenFlag:!1,machineryName:"",machineryBrand:"",machineryTypeId:"",machinerySpec:"",workshopId:"",remark:"",id:"",workshopCode:"",status:"",location:"",workshopName:"",capacity:"",pclModel:"",purchasingTime:""});const L=e({open:!1,title:"物料/产品导入",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "},url:""}),W=t([]),Y=()=>{L.open=!1,L.isUploading=!1,D("searchParams")},ee=()=>{J.value.submit()},ae=async()=>{const e=await(async()=>await a.download({url:"/admin-api/mes/dv/machinery/templateData"}))();b.excel(e,"设备台账模板.xls")},le=(e,a,l)=>{L.isUploading=!0},te=e=>{J.value.clearFiles();const a=e[0];a.uid=w(),J.value.handleStart(a)},ie=()=>{L.open=!L.open,J.value.clearFiles()},re=()=>{D("searchParams")},oe=async()=>{await R.value.resetFields(),O.queryParams.itemTypeId="",D("resetSearch")},se=()=>{Q.value=!Q.value,X.value="新增设备",Z.value="addView"},ne=()=>{me()},de=()=>{L.open=!L.open},ue=async()=>{const e=await(async()=>await a.download({url:"/admin-api/mes/dv/machinery/export"}))();b.excel(e,"设备台账.xls")},pe=e=>{X.value="修改物料/产品",Z.value="editView",ce(e)},ce=e=>{(async e=>await a.get({url:`/admin-api/mes/dv/machinery/get/${e}`}))((null==e?void 0:e.id)||K.value).then((e=>{H.value=e,Q.value=!0}))},me=e=>{const l=(null==e?void 0:e.id)||K.value,t=Array.isArray(l)?l:[l];g.confirm("是否删除当前行数据?").then((()=>{(async e=>await a.delete({url:"/admin-api/mes/dv/machinery/batch",data:e}))(t).then((e=>{e&&(_.success("删除成功"),D("resetSearch"))}))}))},ye=e=>{K.value=e.map((e=>e.id)),U[1].disabled=!K.value.length||K.value.length>=2,U[2].disabled=!K.value.length},he=e=>{D("handlePagination",e)},ve=async()=>{var e;if("View"===Z.value)return Q.value=!Q.value;if(!(await E.value.handleSubmitForm()))return;const l={...H.value,updater:H.value.id?JSON.parse(localStorage.userForm).username:"",machineryTypeId:"number"==typeof H.value.machineryTypeId?H.value.machineryTypeId:null==(e=H.value.machineryTypeId)?void 0:e.slice(-1).toString()};H.value.id?(async e=>await a.put({url:"/admin-api/mes/dv/machinery/update",data:e}))(l).then((e=>{_.success("修改成功"),fe()})):(async e=>await a.post({url:"/admin-api/mes/dv/machinery/save",data:e}))(l).then((e=>{_.success("新增成功"),fe()}))},fe=()=>{E.value.handleCancel(),H.value={machineryCode:"",autoGenFlag:!1,machineryName:"",machineryBrand:"",machineryTypeId:"",machinerySpec:"",workshopId:"",remark:"",id:"",status:"",workshopCode:"",location:"",workshopName:"",capacity:"",pclModel:"",purchasingTime:""},Q.value=!1,oe()},be=()=>{(async e=>await a.get({url:"/admin-api/mes/dv/machinery/status/list",params:e}))().then((e=>{W.value=e.list}))},we=()=>{q().then((e=>{$.value=e})),be()};return i((()=>{we()})),(e,a)=>{const t=k,i=C,b=x,w=V,g=F,_=r("upload-filled"),D=P,q=T,O=S,K=j;return o(),s(c,null,[n(w,{model:l.queryParams,inline:!0,ref_key:"ruleFormRef",ref:R},{default:d((()=>[n(i,{label:"设备编码",prop:"machineryCode"},{default:d((()=>[n(t,{modelValue:l.queryParams.machineryCode,"onUpdate:modelValue":a[0]||(a[0]=e=>l.queryParams.machineryCode=e),placeholder:"请输入设备编码"},null,8,["modelValue"])])),_:1}),n(i,{label:"设备名称",prop:"machineryName"},{default:d((()=>[n(t,{modelValue:l.queryParams.machineryName,"onUpdate:modelValue":a[1]||(a[1]=e=>l.queryParams.machineryName=e),placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),n(i,{label:"设备状态",prop:"status"},{default:d((()=>[n(t,{modelValue:l.queryParams.status,"onUpdate:modelValue":a[2]||(a[2]=e=>l.queryParams.status=e),placeholder:"请输入设备状态"},null,8,["modelValue"])])),_:1}),n(i,null,{default:d((()=>[n(b,{type:"primary",onClick:re,plain:""},{default:d((()=>[u("搜索")])),_:1}),n(b,{onClick:oe,plain:""},{default:d((()=>[u("重置")])),_:1})])),_:1})])),_:1},8,["model"]),p("div",B,[(o(!0),s(c,null,m(v(U),((e,a)=>(o(),y(b,{plain:"",onClick:a=>(e=>{switch(e){case"add":return se();case"edit":return pe();case"remove":return ne();case"import":return de();case"export":return ue()}})(e.state),key:a,type:e.type,disabled:e.disabled},{default:d((()=>[u(h(e.label),1)])),_:2},1032,["onClick","type","disabled"])))),128))]),f((o(),y(I,{pagination:l.paginationData,"is-selection":!0,tableData:l.tableData,columns:v(A),onPaginationChange:he,onSelectionChange:ye},{machineryCode:d((({scope:e})=>[n(b,{link:"",type:"primary",onClick:a=>{return l=e.row,ce(l),X.value="查看物料/产品",void(Z.value="View");var l}},{default:d((()=>[u(h(e.row.machineryCode),1)])),_:2},1032,["onClick"])])),status:d((({scope:e})=>[u(h(v(M)[e.row.status]),1)])),operation:d((({scope:e})=>[n(b,{style:{"font-size":"17px"},link:"",type:"primary",onClick:a=>pe(e.row)},{default:d((()=>[u("修改")])),_:2},1032,["onClick"]),n(b,{style:{"font-size":"17px"},link:"",type:"danger",onClick:a=>{return l=e.row,void me(l);var l}},{default:d((()=>[u("删除")])),_:2},1032,["onClick"])])),_:1},8,["pagination","tableData","columns"])),[[K,l.loadingTable]]),n(g,{modelValue:Q.value,"onUpdate:modelValue":a[3]||(a[3]=e=>Q.value=e),title:X.value,width:"40%",onClose:fe},{footer:d((()=>[n(b,{type:"primary",onClick:ve},{default:d((()=>[u(h("View"===Z.value?"返回":"提交"),1)])),_:1}),n(b,{onClick:fe},{default:d((()=>[u("关闭")])),_:1})])),default:d((()=>[n(N,{"type-state-list":W.value,"measure-options":$.value,treeMaterialForm:l.treeMaterialForm,productFormData:v(H),"dialog-state":Z.value,ref_key:"productFormRef",ref:E},null,8,["type-state-list","measure-options","treeMaterialForm","productFormData","dialog-state"])])),_:1},8,["modelValue","title"]),n(g,{title:"设备类型导入",modelValue:v(L).open,"onUpdate:modelValue":a[4]||(a[4]=e=>v(L).open=e),onBeforeClose:ie},{footer:d((()=>[n(b,{type:"primary",onClick:ee},{default:d((()=>[u("确 定")])),_:1}),n(b,{onClick:ie},{default:d((()=>[u("取 消")])),_:1})])),default:d((()=>[n(q,{ref_key:"uploadRef",ref:J,class:"upload-demo",drag:"",action:v(L).url,limit:1,accept:".xlsx, .xls",headers:v(L).headers,disabled:v(L).isUploading,"auto-upload":!1,"on-progress":le,"on-exceed":te,"on-success":Y},{default:d((()=>[n(D,{class:"el-icon--upload"},{default:d((()=>[n(_)])),_:1}),z])),_:1},8,["action","headers","disabled"]),p("div",G,[n(O,{type:"primary",underline:!1,style:{"vertical-align":"baseline"},onClick:ae},{default:d((()=>[u("下载模板")])),_:1})])])),_:1},8,["modelValue"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/facilityManage/ledger/components/materialData.vue"]]);export{O as default};
