import{d as e,e as l,f as a,aS as u,g as t,a6 as d,o as s,c as o,k as n,w as i,a as m,j as p,F as v,n as r,G as f,X as b,t as c,J as h,aR as _,aK as g,H as V,Z as y,aa as k,ab as w,v as C,E as P,bN as D,at as N,au as x,aL as U,cb as Y,ae as M,aC as S,a0 as j,ce as z,_ as I}from"./index-4bfb878d.js";import{c as L}from"./index-529a6cde.js";import{c as T}from"./index-6c8a85ac.js";import{s as $,b as R,t as A}from"./data-c99d5db7.js";import{g as E,s as F,j as O,f as q,h as G,i as H}from"./schedulingPlan-bc6ff850.js";import{a as J,g as K}from"./shiftSet-d38e6bbc.js";const Q={style:{"margin-bottom":"20px"}},X=I(e({__name:"index_COPY",setup(e){const I=[{label:"操作",slot:"operate"}],X=l(),Z=l({shiftLength:0}),B=a({shiftNum:[{required:!0,message:"请输入排班编号",trigger:"blur"}]}),W=l([{label:"白班",value:"白班"},{label:"中班",value:"中班"},{label:"晚班",value:"晚班"}]),ee=l([{label:"两班倒",value:"两班倒"},{label:"三班倒",value:"三班倒"},{label:"四班倒",value:"四班倒"}]),le=a({shiftType:"",shiftNum:"",shiftName:"",startDate:"",endDate:"",teamPeople:""}),ae=l([]);let ue=a({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const te=l(!1),de=l(!1),se=l(""),oe=l(!1),ne=l([{peopleId:"",teamPeople:"",remark:""}]),ie=l([]),me=l(oe.value?[...schedulingPlanColumns]:[...schedulingPlanColumns,...I]);u((()=>oe.value),(e=>{me.value=e?[...schedulingPlanColumns]:[...schedulingPlanColumns,...I]}));const pe=new Map,ve=()=>{const e={...Z.value,peopleList:ne.value};F(e).then((e=>{_.success("新增成功"),re()}))},re=()=>{ne.value=[{}],Z.value={shiftLength:0},de.value=!1,oe.value=!1,De()},fe=()=>{},be=l(),ce=e=>{be.value=e.map((e=>null==e?void 0:e.id)),R[1].disabled=!be.value.length||be.value.length>=2,R[2].disabled=!be.value.length},he=e=>{ue=null==e?void 0:e.value,Ce()},_e=e=>{(e=>{for(let l=0;l<ie.value.length;l++)for(let e=0;e<pe.size;e++)pe.get(e)===ie.value[l].value&&(ie.value[l].disabled=!0)})(e.$index),ne.value.push({teamPeople:"",remark:""})},ge=e=>{switch(e){case"save":ye();break;case"edit":ke();break;case"remove":we();break;case"download":(async()=>{const e=await H();z.excel(e,"排班计划.xls")})()}},Ve=e=>new Promise(((l,a)=>{O(e).then((e=>{l(e)}))})),ye=()=>{se.value="添加排班计划信息",de.value=!0},ke=e=>{se.value="修改排班计划信息";const l=e?e.id:be.value[0];Ve(l).then((e=>{Z.value=e,de.value=!0}))},we=e=>{const l=(null==e?void 0:e.id)||be.value,a=Array.isArray(l)?l:[l];g.confirm("是否删除当前数据?").then((()=>{q(a).then((e=>{_.success("删除成功"),Ce()}))}))},Ce=()=>{te.value=!0;const e={...le,pageSize:ue.pageSize,pageNo:ue.currentPage};G(e).then((e=>{const{list:l,total:a}=e||{};ae.value=l,ue.total=a})).finally((()=>{te.value=!1}))},Pe=l([]),De=()=>{Ce(),K({}).then((e=>{const{list:l=[]}=e||{};Pe.value=l.map((e=>({value:e.teamCode,label:e.teamCode})))}))};return t((()=>{De()})),(e,l)=>{const a=V,u=y,t=k,_=w,g=C,z=P,I=D,F=N,O=x,q=U,G=Y,H=M,K=d("Plus"),be=S,ye=d("Minus"),Ce=j;return s(),o(v,null,[n(a,null,{default:i((()=>[n(L,{"conditions-list":m($),"search-model":le,onQueryData:fe},null,8,["conditions-list","search-model"])])),_:1}),n(a,null,{default:i((()=>[p("div",Q,[(s(!0),o(v,null,r(m(R),((e,l)=>(s(),f(u,{plain:"",type:e.type,key:l,icon:e.icon,disabled:e.disabled,onClick:l=>ge(e.state)},{default:i((()=>[b(c(e.label),1)])),_:2},1032,["type","icon","disabled","onClick"])))),128))]),n(T,{loading:te.value,isSelection:!0,columns:m(A),tableData:ae.value,pagination:m(ue),onSelectionChange:ce,onPaginationChange:he},{operate:i((({scope:e})=>[n(u,{type:"primary",onClick:l=>{return a=e.row,void Ve(a.id).then((e=>{console.log(e)}));var a}},{default:i((()=>[b("详情")])),_:2},1032,["onClick"]),n(u,{type:"success",onClick:l=>ke(e.row)},{default:i((()=>[b("修改")])),_:2},1032,["onClick"]),n(u,{type:"danger",onClick:l=>we(e.row)},{default:i((()=>[b("删除")])),_:2},1032,["onClick"])])),_:1},8,["loading","columns","tableData","pagination"])])),_:1}),n(Ce,{modelValue:de.value,"onUpdate:modelValue":l[11]||(l[11]=e=>de.value=e),title:se.value,width:"90%",onClose:re},{footer:i((()=>[oe.value?h("",!0):(s(),f(u,{key:0,type:"primary",onClick:ve},{default:i((()=>[b("确定")])),_:1})),n(u,{onClick:re},{default:i((()=>[b("取消")])),_:1})])),default:i((()=>[n(H,{ref_key:"ruleFormRef",ref:X,model:Z.value,rules:B,"label-width":"80px"},{default:i((()=>[n(z,null,{default:i((()=>[n(g,{span:6},{default:i((()=>[n(_,{label:"排班编号",prop:"shiftNum"},{default:i((()=>[n(t,{modelValue:Z.value.shiftNum,"onUpdate:modelValue":l[0]||(l[0]=e=>Z.value.shiftNum=e),disabled:oe.value},null,8,["modelValue","disabled"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"排班名称",prop:"shiftType"},{default:i((()=>[n(t,{modelValue:Z.value.shiftName,"onUpdate:modelValue":l[1]||(l[1]=e=>Z.value.shiftName=e),disabled:oe.value},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),n(I),n(z,null,{default:i((()=>[n(g,{span:6},{default:i((()=>[n(_,{label:"班组编号",prop:"teamNum"},{default:i((()=>[n(O,{disabled:oe.value,modelValue:Z.value.teamNum,"onUpdate:modelValue":l[2]||(l[2]=e=>Z.value.teamNum=e),placeholder:"请选择班组编号",onChange:l[3]||(l[3]=e=>{return l=Z.value.teamNum,E(l).then((e=>{Z.value.shiftType=e.teamType,Z.value.teamName=e.teamName})),J(l).then((e=>{ie.value=e.map((e=>({value:e.id,label:e.userName,disabled:!1})))})),void(ne.value=[{}]);var l})},{default:i((()=>[(s(!0),o(v,null,r(Pe.value,(e=>(s(),f(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"班组类型",prop:"shiftType"},{default:i((()=>[n(t,{modelValue:Z.value.shiftType,"onUpdate:modelValue":l[4]||(l[4]=e=>Z.value.shiftType=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"班组名称",prop:"teamName"},{default:i((()=>[n(t,{modelValue:Z.value.teamName,"onUpdate:modelValue":l[5]||(l[5]=e=>Z.value.teamName=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"轮班时长",prop:"shiftLength"},{default:i((()=>[n(q,{style:{width:"197px"},min:0,modelValue:Z.value.shiftLength,"onUpdate:modelValue":l[6]||(l[6]=e=>Z.value.shiftLength=e),disabled:oe.value},null,8,["modelValue","disabled"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"轮班方式",prop:"shiftPattern"},{default:i((()=>[n(O,{disabled:oe.value,modelValue:Z.value.shiftPattern,"onUpdate:modelValue":l[7]||(l[7]=e=>Z.value.shiftPattern=e),placeholder:"请选择轮班方式"},{default:i((()=>[(s(!0),o(v,null,r(W.value,(e=>(s(),f(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"倒班方式",prop:"shiftPatterns"},{default:i((()=>[n(O,{disabled:oe.value,modelValue:Z.value.shiftPatterns,"onUpdate:modelValue":l[8]||(l[8]=e=>Z.value.shiftPatterns=e),placeholder:"请选择倒班方式"},{default:i((()=>[(s(!0),o(v,null,r(ee.value,(e=>(s(),f(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"开始日期",prop:"startDate"},{default:i((()=>[n(G,{disabled:oe.value,modelValue:Z.value.startDate,"onUpdate:modelValue":l[9]||(l[9]=e=>Z.value.startDate=e),type:"datetime",placeholder:"请选择开始日期","value-format":"YYYY-MM-DD hh:mm:ss",format:"YYYY-MM-DD hh:mm:ss","default-time":new Date},null,8,["disabled","modelValue","default-time"])])),_:1})])),_:1}),n(g,{span:6},{default:i((()=>[n(_,{label:"结束日期",prop:"endDate"},{default:i((()=>[n(G,{disabled:oe.value,modelValue:Z.value.endDate,"onUpdate:modelValue":l[10]||(l[10]=e=>Z.value.endDate=e),type:"datetime",placeholder:"请选择结束日期","value-format":"YYYY-MM-DD hh:mm:ss",format:"YYYY-MM-DD hh:mm:ss","default-time":new Date},null,8,["disabled","modelValue","default-time"])])),_:1})])),_:1})])),_:1}),n(I)])),_:1},8,["model","rules"]),n(T,{loading:te.value,columns:me.value,tableData:ne.value,isShowPagination:!1,height:250},{peopleId:i((({scope:e})=>[n(t,{modelValue:e.row.peopleId,"onUpdate:modelValue":l=>e.row.peopleId=l,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),teamName:i((({scope:e})=>[n(t,{modelValue:e.row.teamName,"onUpdate:modelValue":l=>e.row.teamName=l,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),teamPeople:i((({scope:e})=>[n(O,{modelValue:e.row.teamPeople,"onUpdate:modelValue":l=>e.row.teamPeople=l,placeholder:"请选择人员名称",disabled:!Z.value.teamNum||oe.value,onChange:l=>((e,l)=>{const a=ie.value.find((l=>l.label===e));ne.value[l].peopleId=a.value,pe.has(l)&&(pe.delete(a.value),ie.value.find((e=>e.value===a.value)).disabled=!1),pe.set(l,a.value),ie.value.find((e=>e.value===a.value)).disabled=!1})(e.row.teamPeople,e.$index)},{default:i((()=>[(s(!0),o(v,null,r(ie.value,(e=>(s(),f(F,{key:e.value,label:e.label,disabled:e.disabled,value:e.label},null,8,["label","disabled","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])])),remark:i((({scope:e})=>[n(t,{modelValue:e.row.remark,"onUpdate:modelValue":l=>e.row.remark=l,autosize:{minRows:1,maxRows:1},type:"textarea",placeholder:"请输入备注",disabled:oe.value},null,8,["modelValue","onUpdate:modelValue","disabled"])])),operate:i((({scope:e})=>[n(u,{link:"",type:"success",onClick:l=>_e(e),disabled:!e.row.peopleId},{default:i((()=>[n(be,null,{default:i((()=>[n(K)])),_:1})])),_:2},1032,["onClick","disabled"]),0!==e.$index?(s(),f(u,{key:0,link:"",type:"danger",onClick:l=>(e=>{let l=ne.value[e.$index].peopleId;for(let[a,u]of pe.entries())u===l&&(pe.delete(a),ie.value.find((e=>e.value===l)).disabled=!1);ne.value.splice(e.$index,1)})(e)},{default:i((()=>[n(be,null,{default:i((()=>[n(ye)])),_:1})])),_:2},1032,["onClick"])):h("",!0)])),_:1},8,["loading","columns","tableData"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/scheduling/schedulingPlan/index_COPY.vue"]]);export{X as default};
