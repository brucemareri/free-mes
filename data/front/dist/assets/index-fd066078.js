import{d as e,e as l,f as a,a_ as u,g as o,o as d,c as s,F as t,n as r,G as n,w as i,X as p,t as m,J as c,k as v,as as f,a as g,j as _,aK as k,aR as y,Z as b,aq as V,cx as h,aL as C,ab as I,v as T,at as w,au as x,E as U,aa as S,ae as F,a0 as P,_ as q}from"./index-4bfb878d.js";import{c as j}from"./index-6c8a85ac.js";import{b as N,p as D,d as E,q as z,u as A,a as M,c as R,e as B}from"./index-d5d2dc92.js";import{a as G,b as J,c as K,U as L}from"./const-f443e30b.js";const X={key:0,style:{"margin-bottom":"20px"}},Y={class:"dialog-footer"},Z=q(e({__name:"index",props:{processId:{type:null,required:!0},isEdit:{type:null,required:!0}},setup(e){const q=e,Z=l(),H=a({id:[{required:!0,message:"工艺路线ID不能为空",trigger:"blur"}],processId:[{required:!0,message:"工序ID不能为空",trigger:"blur"}],nextProcessId:[{required:!0,message:"工序ID不能为空",trigger:"blur"}],keyFlag:[{required:!0,message:"请指定当前工序是否关键工序",trigger:"blur"}]}),O=l(!1);let Q=a([]),W=a({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const $=l(),ee=l(""),le=l({orderNum:1,processId:"",linkType:"",colorCode:"",keyFlag:"",defaultPreTime:0,defaultSufTime:0,remark:"",routeId:q.processId,id:""}),ae=l(!1),ue=l([]),oe=u((()=>N.slice(0,-1))),de=()=>{ee.value="添加工艺组成",ae.value=!0},se=e=>{ee.value="修改工艺组成";const l=(null==e?void 0:e.id)||$.value[0];re(l)},te=e=>{const l=e||$.value,a=Array.isArray(l)?l:[l];k.confirm("是否删除当前数据?").then((()=>{E(a).then((e=>{y.success("删除成功"),ce()}))}))},re=e=>{z(e).then((e=>{le.value=e,ae.value=!0}))},ne=e=>{$.value=e.map((e=>null==e?void 0:e.id)),N[1].disabled=!$.value.length||$.value.length>=2,N[2].disabled=!$.value.length},ie=async()=>{Z.value&&await Z.value.validate((e=>{e&&(le.value.id?A(le.value).then((e=>{y.success("修改成功"),pe(),ce()})):M(le.value).then((e=>{y.success("新增成功"),pe(),ce()})))}))},pe=()=>{le.value={orderNum:1,processId:"",linkType:"",colorCode:"",keyFlag:"",defaultPreTime:0,defaultSufTime:0,remark:"",routeId:q.processId,id:""},ae.value=!1},me=e=>{W=null==e?void 0:e.value,ce()},ce=()=>{const e={pageNo:W.currentPage,pageSize:W.pageSize,routeId:q.processId};O.value=!0,R(e).then((e=>{const{list:l,total:a}=e||{};W.total=a,Q=l})).finally((()=>{O.value=!1}))},ve=()=>{ce(),B().then((e=>{ue.value=e}))};return o((()=>{ve()})),(e,l)=>{const a=b,u=V,o=h,k=C,y=I,q=T,N=w,E=x,z=U,A=S,M=F,R=P;return d(),s(t,null,[e.isEdit?c("",!0):(d(),s("div",X,[(d(!0),s(t,null,r(oe.value,((e,l)=>(d(),n(a,{plain:"",type:e.type,key:l,icon:e.icon,disabled:e.disabled,onClick:l=>(e=>{switch(e){case"save":de();break;case"edit":se();break;case"remove":te()}})(e.state)},{default:i((()=>[p(m(e.label),1)])),_:2},1032,["type","icon","disabled","onClick"])))),128))])),v(j,{loading:O.value,isSelection:!0,columns:g(D),tableData:g(Q),pagination:g(W),onSelectionChange:ne,onPaginationChange:me},f({keyFlag:i((({scope:e})=>[v(u,{type:"Y"===e.row.keyFlag?"success":"warning"},{default:i((()=>[p(m(g(G)[e.row.keyFlag]),1)])),_:2},1032,["type"])])),colorCode:i((({scope:e})=>[v(o,{modelValue:e.row.colorCode,"onUpdate:modelValue":l=>e.row.colorCode=l,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),linkType:i((({scope:e})=>[p(m(g(J)[e.row.linkType]),1)])),_:2},[e.isEdit?void 0:{name:"operation",fn:i((({scope:e})=>[v(a,{link:"",type:"primary",onClick:l=>se(e.row)},{default:i((()=>[p("修改")])),_:2},1032,["onClick"]),v(a,{link:"",type:"danger",onClick:l=>te(e.row.id)},{default:i((()=>[p("删除")])),_:2},1032,["onClick"])])),key:"0"}]),1032,["loading","columns","tableData","pagination"]),v(R,{width:"70%",modelValue:ae.value,"onUpdate:modelValue":l[9]||(l[9]=e=>ae.value=e),title:ee.value,onBeforeClose:pe},{footer:i((()=>[_("span",Y,[v(a,{type:"primary",onClick:ie},{default:i((()=>[p("提交")])),_:1}),v(a,{onClick:pe},{default:i((()=>[p("返回")])),_:1})])])),default:i((()=>[v(M,{ref_key:"ruleFormRef",ref:Z,model:le.value,rules:H,"label-width":"120px"},{default:i((()=>[v(z,null,{default:i((()=>[v(q,{span:12},{default:i((()=>[v(y,{label:"序号",prop:"orderNum"},{default:i((()=>[v(k,{min:1,modelValue:le.value.orderNum,"onUpdate:modelValue":l[0]||(l[0]=e=>le.value.orderNum=e),placeholder:""},null,8,["modelValue"])])),_:1})])),_:1}),v(q,{span:12},{default:i((()=>[v(y,{label:"工序",prop:"processId"},{default:i((()=>[v(E,{modelValue:le.value.processId,"onUpdate:modelValue":l[1]||(l[1]=e=>le.value.processId=e),placeholder:"请选择工序"},{default:i((()=>[(d(!0),s(t,null,r(ue.value,((e,l)=>(d(),n(N,{key:l,label:e.processName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),v(z,null,{default:i((()=>[v(q,{span:12},{default:i((()=>[v(y,{label:"工序关系",prop:"linkType"},{default:i((()=>[v(E,{modelValue:le.value.linkType,"onUpdate:modelValue":l[2]||(l[2]=e=>le.value.linkType=e),placeholder:"请选择与下一道工序关系"},{default:i((()=>[(d(!0),s(t,null,r(g(K),(e=>(d(),n(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),v(q,{span:5},{default:i((()=>[v(y,{label:"甘特图显示颜色",prop:"colorCode"},{default:i((()=>[v(o,{modelValue:le.value.colorCode,"onUpdate:modelValue":l[3]||(l[3]=e=>le.value.colorCode=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(q,{span:7},{default:i((()=>[v(A,{modelValue:le.value.colorCode,"onUpdate:modelValue":l[4]||(l[4]=e=>le.value.colorCode=e),maxlength:"7",placeholder:"请输入颜色编码在左侧选择颜色"},null,8,["modelValue"])])),_:1})])),_:1}),v(z,null,{default:i((()=>[v(q,{span:8},{default:i((()=>[v(y,{label:"是否关键工序",prop:"keyFlag"},{default:i((()=>[v(E,{modelValue:le.value.keyFlag,"onUpdate:modelValue":l[5]||(l[5]=e=>le.value.keyFlag=e)},{default:i((()=>[(d(!0),s(t,null,r(g(L),(e=>(d(),n(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),v(q,{span:8},{default:i((()=>[v(y,{label:"准备时间",prop:"defaultPreTime"},{default:i((()=>[v(k,{min:0,step:1,modelValue:le.value.defaultPreTime,"onUpdate:modelValue":l[6]||(l[6]=e=>le.value.defaultPreTime=e),placeholder:"请输入准备时间"},null,8,["modelValue"])])),_:1})])),_:1}),v(q,{span:8},{default:i((()=>[v(y,{label:"等待时间",prop:"defaultSufTime"},{default:i((()=>[v(k,{min:0,step:1,modelValue:le.value.defaultSufTime,"onUpdate:modelValue":l[7]||(l[7]=e=>le.value.defaultSufTime=e),placeholder:"请输入准备时间"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),v(z,null,{default:i((()=>[v(q,null,{default:i((()=>[v(y,{label:"备注",prop:"remark"},{default:i((()=>[v(A,{modelValue:le.value.remark,"onUpdate:modelValue":l[8]||(l[8]=e=>le.value.remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/prodMgmt/craftCourse/components/processCompose/index.vue"]]);export{Z as default};
