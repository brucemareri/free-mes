import{f as e,r as a,d as l,e as t,a_ as o,g as s,o as r,c as n,k as u,w as i,a as d,F as p,n as c,G as m,j as g,t as f,X as v,J as b,as as y,z as k,aR as w,aK as C,H as h,cy as _,v as q,E as V,bN as x,aa as N,aq as S,Z as z,ab as P,aL as U,ae as R,at as D,au as j,a0 as M,_ as F}from"./index-4bfb878d.js";import{_ as O}from"./CountTo-65cb946f.js";import{c as T}from"./index-529a6cde.js";import{c as H}from"./index-6c8a85ac.js";import{d as Q,g as E,f as I,h as J,e as $,N as A}from"./const-f443e30b.js";import{a as B}from"./index-cbc4edd9.js";const G=e([{label:"报工状态",type:"select",prop:"status",placeholder:"请选择报工状态",options:[{value:"NoSTARTED",label:"未开工"},{value:"PAUSED",label:"已暂停"},{value:"FINISHED",label:"已报工"}]},{label:"工单编号",type:"input",prop:"workorderCode",placeholder:"请输入工单编号"},{label:"任务单号",type:"input",prop:"taskCode",placeholder:"请输入任务单号"},{label:"产品名称",type:"input",prop:"itemName",placeholder:"请输入产品名称"},{label:"报工人",type:"input",prop:"userName",placeholder:"请输入报工人"}]);e([{type:"primary",icon:"plus",state:"save",label:"新增",disabled:!1,permissions:[],authority:""},{type:"success",icon:"edit",state:"edit",label:"修改",disabled:!0,permissions:[],authority:""},{type:"danger",icon:"delete",state:"remove",label:"删除",disabled:!0,permissions:[],authority:"pro:feedbacktwo:delete"}]);const K=[{label:"任务单号",prop:"taskCode",width:"150",align:"center"},{label:"订单编号",prop:"workorderCode",width:"150",align:"center"},{label:"产品名称",prop:"itemName",align:"center"},{label:"单位",prop:"unitOfMeasure",align:"center"},{label:"报工数量",prop:"quantity",align:"center"},{label:"排产数量",prop:"orderQuantity",align:"center"},{slot:"reportingProgress",label:"报工进度",width:"150"},{label:"订单数量",prop:"workOrderQuentity",align:"center"},{label:"开工时间",prop:"feedbackTime",width:"170",align:"center"},{label:"暂停时间",prop:"pauseTime",width:"170",align:"center"},{label:"暂停原因",slot:"pauseReason",width:"170",align:"center"},{label:"报工时间",prop:"finishedTime",width:"170",align:"center"},{label:"工序编号",prop:"processCode",width:"170",align:"center"},{label:"工序名称",prop:"processName",width:"170",align:"center"},{label:"报工人",prop:"userName",align:"center"},{label:"状态",prop:"status",slot:"status",fixed:"right",width:"100",align:"center"},{label:"操作",slot:"operation",width:"310",fixed:"right",align:"center"}],L=[{label:"序号"},{label:"设备编号",slot:"equipmentCode"},{label:"操作",align:"center",slot:"operate"}],W=async()=>await a.get({url:"/admin-api/mes/pro/feedback/unStartOrders"}),X=async()=>await a.get({url:"/admin-api/mes/pro/feedback/completed"}),Z=async()=>await a.get({url:"/admin-api/mes/pro/feedback/paused"}),Y={style:{"margin-bottom":"12px",display:"block","font-size":"24px"}},ee={class:"grid-content ep-bg-purple"},ae={key:1},le={class:"dialog-footer"},te={class:"dialog-footer"},oe=F(l({__name:"index",setup(l){const F=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],oe=t(),se=t(null),re=t(null),ne=e({suspendMessage:[{required:!0,message:"请选择暂停原因",trigger:"blur"}]}),ue=e({status:"",workorderCode:"",taskCode:"",itemName:"",userName:""});let ie=e({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1}),de=e({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const pe=t(!1),ce=t(!1);let me=e([]),ge=t(""),fe=t([]),ve=t({taskCode:"",quantity:0,workHour:0,id:""}),be=t(""),ye=t([{equipmentCode:""}]),ke=t([]),we=t(),Ce=t({suspendMessage:""});const he=t([{percentage:0,title:"未开工订单数量"},{percentage:0,title:"已报工订单数量"},{percentage:0,title:"已暂停订单数量"}]),_e=e=>e<30?"#909399":e<70?"#e6a23c":"#67c23a",qe=async()=>{try{const e=await Promise.all([W(),X(),Z()]);he.value[0].percentage=e[0].totalQuentity,he.value[1].percentage=e[1].totalQuentity,he.value[2].percentage=e[2].totalQuentity}catch(e){console.error("获取订单数据失败",e)}},Ve=o((()=>{const e=ye.value.map((e=>e.equipmentCode));return ke.value.filter((a=>!e.includes(a.value)))})),xe=()=>{He()},Ne=e=>{switch(e){case J:return"success";case E:return"info";case I:case $:return"success"}},Se=(e,l)=>new Promise(((t,o)=>{(async e=>await a.post({url:"/admin-api/mes/pro/feedback/updateStatus",data:e}))(e).then((e=>{w.success(l),He(),qe(),t(e)}))}));let ze=t({});const Pe=(e,a,l)=>{let t={status:a,taskCode:e.taskCode,userName:JSON.parse(localStorage.userForm).username};switch(ze.value=t,a){case E:we.value=!0;break;case $:ve.value.taskCode=e.taskCode,ye.value=JSON.parse(e.equipmentCode),ge.value="报工生产报工",ce.value=!0;break;default:Se(t,l)}},Ue=()=>{oe.value&&oe.value.validate(((e,a)=>{if(e){const e={...ze.value,pauseReason:Ce.value.suspendMessage};Se(e,"暂停成功").then((e=>{Re()}))}}))},Re=()=>{oe.value&&(oe.value.resetFields(),we.value=!1)},De=()=>{re.value.focus()},je=e=>{(async e=>await a.get({url:`/admin-api/mes/pro/feedback/find/${e}`}))(e).then((e=>{ve.value={taskCode:e.taskCode,quantity:Number(e.quantity),workHour:Number(e.workHour),id:e.id},ye.value=JSON.parse(e.equipmentCode)||[],ce.value=!0}))},Me=e=>{ie=null==e?void 0:e.value,He()},Fe=()=>{ye.value.push({equipmentCode:""})},Oe=async()=>{const e={...ze.value,quantity:ve.value.quantity,equipmentCode:ye.value};Se(e,"报工成功").then((e=>{Te()}))},Te=()=>{oe.value&&(oe.value.resetFields(),ve.value={taskCode:"",quantity:0,workHour:0,id:""},ye.value=[{equipmentCode:""}],be.value="",ce.value=!1)},He=()=>{const e={...ue,assignUsername:JSON.parse(localStorage.userForm).username,pageNo:ie.currentPage,pageSize:ie.pageSize};pe.value=!0,(async e=>await a.get({url:"/admin-api/mes/pro/feedback/list",params:e}))(e).then((e=>{const{total:a,list:l=[]}=e||{};ie.total=a,me=l})).finally((()=>{pe.value=!1}))};let Qe=t([]);const Ee=()=>{(async()=>await a.get({url:"/admin-api/mes/dict/data/listData"}))().then((e=>{Qe.value=e}))},Ie=()=>{He(),B({}).then((e=>{ke.value=e.list.map((e=>({value:e.machineryCode,label:e.machineryCode,disabled:!1})))})),Ee(),qe()};return s((()=>{Ie()})),(e,a)=>{const l=h,t=O,o=_,s=q,B=V,W=x,X=N,Z=S,ke=z,qe=P,Se=U,ze=R,He=D,Ee=j,Ie=M;return r(),n(p,null,[u(l,null,{default:i((()=>[u(T,{"conditions-list":d(G),"search-model":ue,onQueryData:xe},null,8,["conditions-list","search-model"])])),_:1}),u(l,null,{default:i((()=>[u(B,null,{default:i((()=>[(r(!0),n(p,null,c(he.value,((e,a)=>(r(),m(s,{span:8,style:{"text-align":"center"},key:a},{default:i((()=>[g("div",Y,f(e.title),1),g("div",ee,[u(o,{type:"dashboard",percentage:e.percentage,color:F},{default:i((({percentage:e})=>[u(t,{class:"text-20px","start-val":0,"end-val":e,duration:3600},null,8,["end-val"])])),_:2},1032,["percentage"])])])),_:2},1024)))),128))])),_:1}),u(W),u(H,{loading:pe.value,columns:d(K),tableData:d(me),pagination:d(ie),onPaginationChange:Me},{pauseReason:i((({scope:e})=>[u(X,{modelValue:e.row.pauseReason,"onUpdate:modelValue":a=>e.row.pauseReason=a,type:"textarea",disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),status:i((({scope:e})=>[u(Z,{type:Ne(e.row.status)},{default:i((()=>[v(f(d(Q)[e.row.status]),1)])),_:2},1032,["type"])])),reportingProgress:i((({scope:e})=>[u(o,{color:_e,"text-inside":!0,"stroke-width":26,percentage:isNaN(parseInt(e.row.reportingProgress))?0:parseInt(e.row.reportingProgress)},null,8,["percentage"])])),operation:i((({scope:e})=>[g("div",null,[e.row.status.includes(d(E))?(r(),m(ke,{key:0,size:"large",round:"",type:"primary",onClick:a=>Pe(e.row,d(I),"恢复成功")},{default:i((()=>[v("恢复")])),_:2},1032,["onClick"])):b("",!0),e.row.status===d(J)||e.row.status===d(I)?(r(),m(ke,{key:1,onClick:a=>Pe(e.row,d(E),"暂停成功"),size:"large",round:"",type:"danger"},{default:i((()=>[v("暂停")])),_:2},1032,["onClick"])):b("",!0),e.row.status!==d($)&&e.row.status!==d(A)?(r(),m(ke,{key:2,size:"large",round:"",type:"success",onClick:a=>Pe(e.row,d($),"报工成功")},{default:i((()=>[v("报工")])),_:2},1032,["onClick"])):b("",!0),e.row.status==d(A)?(r(),m(ke,{key:3,size:"large",round:"",type:"success",onClick:a=>Pe(e.row,d(J),"开工成功")},{default:i((()=>[v("开工")])),_:2},1032,["onClick"])):b("",!0),u(ke,{onClick:a=>(e=>{ge.value="查看报工数据";const a=(null==e?void 0:e.id)||fe.value[0];be.value="view",je(a)})(e.row),type:"primary",size:"large",round:""},{default:i((()=>[v("查看")])),_:2},1032,["onClick"])])])),_:1},8,["loading","columns","tableData","pagination"])])),_:1}),u(Ie,{draggable:"",width:"50%",modelValue:ce.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ce.value=e),title:d(ge),onBeforeClose:Te},{footer:i((()=>[g("span",le,["view"!=d(be)?(r(),m(ke,{key:0,type:"primary",onClick:Oe},{default:i((()=>[v(" 提交 ")])),_:1})):b("",!0),u(ke,{onClick:Te},{default:i((()=>[v("返回")])),_:1})])])),default:i((()=>[u(ze,{model:d(ve),"status-icon":"",rules:ne,ref_key:"ruleFormRef",ref:oe,"label-width":"170px"},{default:i((()=>[u(B,null,{default:i((()=>[u(s,{span:11},{default:i((()=>[u(qe,{label:"任务单号",prop:"taskCode"},{default:i((()=>[u(X,{ref_key:"taskCodeRef",ref:se,"show-word-limit":"",disabled:"",modelValue:d(ve).taskCode,"onUpdate:modelValue":a[0]||(a[0]=e=>d(ve).taskCode=e),onChange:De},null,8,["modelValue"])])),_:1})])),_:1}),u(s,{span:11},{default:i((()=>[u(qe,{label:"数量"},{default:i((()=>[u(Se,{ref_key:"quantityRef",ref:re,modelValue:d(ve).quantity,"onUpdate:modelValue":a[1]||(a[1]=e=>d(ve).quantity=e),min:0,max:9999,disabled:"view"==d(be)},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"]),u(H,{columns:d(L),tableData:d(ye),pagination:d(de),isSinglePage:!0},y({equipmentCode:i((({scope:e})=>["view"!=d(be)?(r(),m(Ee,{key:0,modelValue:e.row.equipmentCode,"onUpdate:modelValue":a=>e.row.equipmentCode=a,placeholder:"请选择设备编号"},{default:i((()=>[(r(!0),n(p,null,c(Ve.value,(e=>(r(),m(He,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(r(),n("div",ae,f(e.row.equipmentCode),1))])),_:2},["view"!=d(be)?{name:"operate",fn:i((({scope:e})=>[u(ke,{onClick:Fe,link:"",type:"primary"},{default:i((()=>[v(" 添加")])),_:1}),u(ke,{onClick:a=>(e=>{if(1===ye.value.length)return w.error("已经是最后一个了");const{row:a}=e||{};a&&""!=a.equipmentCode?C.confirm("是否删除该参数?").then((()=>{ye.value.splice(e.$index,1)})):ye.value.splice(e.$index,1)})(e),link:"",type:"danger"},{default:i((()=>[v("删除")])),_:2},1032,["onClick"])])),key:"0"}:void 0]),1032,["columns","tableData","pagination"])])),_:1},8,["modelValue","title"]),u(Ie,{draggable:"",title:"暂停原因",modelValue:d(we),"onUpdate:modelValue":a[4]||(a[4]=e=>k(we)?we.value=e:we=e),width:"25%",onBeforeClose:Re},{footer:i((()=>[g("span",te,[u(ke,{type:"primary",onClick:Ue},{default:i((()=>[v(" 提交 ")])),_:1}),u(ke,{onClick:Re},{default:i((()=>[v("返回")])),_:1})])])),default:i((()=>[u(ze,{ref_key:"ruleFormRef",ref:oe,model:d(Ce),rules:ne,"status-icon":""},{default:i((()=>[u(qe,{label:"暂停原因",prop:"suspendMessage"},{default:i((()=>[u(Ee,{modelValue:d(Ce).suspendMessage,"onUpdate:modelValue":a[3]||(a[3]=e=>d(Ce).suspendMessage=e),placeholder:"请选择暂停原因"},{default:i((()=>[(r(!0),n(p,null,c(d(Qe),(e=>(r(),m(He,{key:e.label,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-ed8080f3"],["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/prodMgmt/reportWorkTwo/index.vue"]]);export{oe as default};
