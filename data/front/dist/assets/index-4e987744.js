import{d as e,e as a,f as l,a_ as t,g as o,o as i,c as u,F as s,n,G as d,w as r,X as p,t as m,J as c,k as v,as as f,a as _,j as g,aK as k,aR as y,Z as C,aq as b,cx as V,aa as h,ab as w,v as x,E as j,ae as M,a0 as S,_ as U}from"./index-4bfb878d.js";import{c as I}from"./index-6c8a85ac.js";import{b as N,f as O,g as D,h as E,i as F,j as q,k as z,e as P}from"./index-d5d2dc92.js";import{a as R,b as A}from"./const-f443e30b.js";import J from"./index-6ebcd94a.js";import"./treeMaterial-9b585804.js";import"./materialData-d3bde0f1.js";import"./data-6c43379c.js";import"./pmOrder-563fbf59.js";const K={key:0,style:{"margin-bottom":"20px"}},T={class:"dialog-footer"},B=U(e({__name:"index",props:{processId:{type:null,required:!0},isEdit:{type:null,required:!0}},setup(e){const U=e,B=a(),G=a(null),H=l({itemCode:[{required:!0,message:"产品物料编码不能为空",trigger:"blur"}]}),X=a(!1);let Y=l([]),Z=l({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const L=a(),Q=a(""),W=a({remark:"",specification:"",unitOfMeasure:"",itemName:"",itemCode:"",id:"",itemId:"",routeId:U.processId}),$=a(!1),ee=a([]),ae=t((()=>N.slice(0,-1))),le=()=>{Q.value="添加产品制程",$.value=!0},te=e=>{Q.value="修改产品制程";const a=(null==e?void 0:e.id)||L.value[0];ie(a)},oe=e=>{const a=e||L.value,l=Array.isArray(a)?a:[a];k.confirm("是否删除当前数据?").then((()=>{D(l).then((e=>{y.success("删除成功"),me()}))}))},ie=e=>{E(e).then((e=>{W.value=e,$.value=!0}))},ue=e=>{L.value=e.map((e=>null==e?void 0:e.id)),N[1].disabled=!L.value.length||L.value.length>=2,N[2].disabled=!L.value.length},se=()=>{G.value.visibleProduct=!0},ne=e=>{null!=e&&(W.value.itemCode=e.itemCode,W.value.itemName=e.itemName,W.value.itemId=e.id,W.value.unitOfMeasure=e.unitOfMeasure,W.value.specification=e.specification)},de=async()=>{B.value&&await B.value.validate((e=>{e&&(W.value.id?F(W.value).then((e=>{y.success("修改成功"),re(),me()})):q(W.value).then((e=>{y.success("新增成功"),re(),me()})))}))},re=()=>{W.value={remark:"",specification:"",unitOfMeasure:"",itemName:"",itemCode:"",id:""},$.value=!1},pe=e=>{Z=null==e?void 0:e.value,me()},me=()=>{const e={pageNo:Z.currentPage,pageSize:Z.pageSize,routeId:U.processId};X.value=!0,z(e).then((e=>{const{list:a,total:l}=e||{};Z.total=l,Y=a})).finally((()=>{X.value=!1}))},ce=()=>{me(),P().then((e=>{ee.value=e}))};return o((()=>{ce()})),(e,a)=>{const l=C,t=b,o=V,k=h,y=w,U=x,N=j,D=M,E=S;return i(),u(s,null,[e.isEdit?c("",!0):(i(),u("div",K,[(i(!0),u(s,null,n(ae.value,((e,a)=>(i(),d(l,{plain:"",type:e.type,key:a,icon:e.icon,disabled:e.disabled,onClick:a=>(e=>{switch(e){case"save":le();break;case"edit":te();break;case"remove":oe()}})(e.state)},{default:r((()=>[p(m(e.label),1)])),_:2},1032,["type","icon","disabled","onClick"])))),128))])),v(I,{loading:X.value,isSelection:!0,columns:_(O),tableData:_(Y),pagination:_(Z),onSelectionChange:ue,onPaginationChange:pe},f({keyFlag:r((({scope:e})=>[v(t,{type:"Y"===e.row.keyFlag?"success":"warning"},{default:r((()=>[p(m(_(R)[e.row.keyFlag]),1)])),_:2},1032,["type"])])),colorCode:r((({scope:e})=>[v(o,{modelValue:e.row.colorCode,"onUpdate:modelValue":a=>e.row.colorCode=a,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),linkType:r((({scope:e})=>[p(m(_(A)[e.row.linkType]),1)])),_:2},[e.isEdit?void 0:{name:"operation",fn:r((({scope:e})=>[v(l,{link:"",type:"primary",onClick:a=>te(e.row)},{default:r((()=>[p("修改")])),_:2},1032,["onClick"]),v(l,{link:"",type:"danger",onClick:a=>oe(e.row.id)},{default:r((()=>[p("删除")])),_:2},1032,["onClick"])])),key:"0"}]),1032,["loading","columns","tableData","pagination"]),v(E,{width:"70%",modelValue:$.value,"onUpdate:modelValue":a[5]||(a[5]=e=>$.value=e),title:Q.value,onBeforeClose:re},{footer:r((()=>[g("span",T,[v(l,{type:"primary",onClick:de},{default:r((()=>[p("提交")])),_:1}),v(l,{onClick:re},{default:r((()=>[p("返回")])),_:1})])])),default:r((()=>[v(D,{ref_key:"ruleFormRef",ref:B,model:W.value,rules:H,"label-width":"120px"},{default:r((()=>[v(N,null,{default:r((()=>[v(U,{span:8},{default:r((()=>[v(y,{label:"产品物料编码",prop:"itemCode"},{default:r((()=>[v(k,{modelValue:W.value.itemCode,"onUpdate:modelValue":a[0]||(a[0]=e=>W.value.itemCode=e),placeholder:"请输入产品编号"},{append:r((()=>[v(l,{icon:"DocumentAdd",onClick:se})])),_:1},8,["modelValue"])])),_:1}),v(J,{ref_key:"itemSelectRef",ref:G,onHandleCurrentSubmit:ne},null,512)])),_:1}),v(U,{span:8},{default:r((()=>[v(y,{label:"产品物料名称",prop:"itemName"},{default:r((()=>[v(k,{modelValue:W.value.itemName,"onUpdate:modelValue":a[1]||(a[1]=e=>W.value.itemName=e),placeholder:"请输入产品物料名称"},null,8,["modelValue"])])),_:1})])),_:1}),v(U,{span:8},{default:r((()=>[v(y,{label:"单位",prop:"unitOfMeasure"},{default:r((()=>[v(k,{modelValue:W.value.unitOfMeasure,"onUpdate:modelValue":a[2]||(a[2]=e=>W.value.unitOfMeasure=e),placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),v(N,null,{default:r((()=>[v(U,null,{default:r((()=>[v(y,{label:"规格型号",prop:"specification"},{default:r((()=>[v(k,{modelValue:W.value.specification,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value.specification=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1}),v(U,null,{default:r((()=>[v(y,{label:"备注",prop:"remark"},{default:r((()=>[v(k,{modelValue:W.value.remark,"onUpdate:modelValue":a[4]||(a[4]=e=>W.value.remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/prodMgmt/craftCourse/components/productRelevance/index.vue"]]);export{B as default};
