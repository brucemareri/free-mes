import{f as e,D as a,r as t,d as i,q as s,K as l,e as r,C as o,o as n,c,k as u,w as d,a as p,j as m,t as f,I as S,G as _,J as h,z as T,F as g,L as I,M as y,N as w,H as x,a1 as C,a0 as k,_ as v}from"./index-4bfb878d.js";import{u as R}from"./useVxeCrudSchemas-092b8963.js";import{I as E}from"./constants-97c4dd5f.js";import{u as b}from"./useXTable-309dffed.js";const N=e({primaryKey:"id",primaryType:"id",primaryTitle:"日志编号",action:!0,actionWidth:"300",columns:[{title:"链路追踪",field:"traceId",isTable:!1},{title:"用户编号",field:"userId",isSearch:!0},{title:"用户类型",field:"userType",dictType:a.USER_TYPE,isSearch:!0},{title:"应用名",field:"applicationName",isSearch:!0},{title:"请求方法名",field:"requestMethod"},{title:"请求地址",field:"requestUrl",isSearch:!0},{title:"异常发生时间",field:"exceptionTime",formatter:"formatDate",search:{show:!0,itemRender:{name:"XDataTimePicker"}}},{title:"异常名",field:"exceptionName"},{title:"处理状态",field:"processStatus",dictType:a.INFRA_API_ERROR_LOG_PROCESS_STATUS,dictClass:"number",isSearch:!0},{title:"处理人",field:"processUserId",isTable:!1},{title:"处理时间",field:"processTime",formatter:"formatDate",isTable:!1}]}),{allSchemas:L}=R(N),j=e=>t.get({url:"/admin-api/infra/api-error-log/page",params:e}),A=e=>t.download({url:"/admin-api/infra/api-error-log/export-excel",params:e}),D=i({name:"ApiErrorLog"}),P=v(i({...D,setup(e){const{t:a}=s(),i=l(),[v,{reload:R,exportList:N}]=b({allSchemas:L,getListApi:j,exportListApi:A}),D=r(),P=r(!1),U=r(""),O=(e,s,l)=>{i.confirm("确认标记为"+l+"?",a("common.reminder")).then((async()=>{var l,r;await(l=e.id,r=s,t.put({url:"/admin-api/infra/api-error-log/update-status?id="+l+"&processStatus="+r})),i.success(a("common.updateSuccess"))})).finally((async()=>{await R()})).catch((()=>{}))};return(e,t)=>{const i=I,s=y,l=w,r=x,R=C,b=k,j=o("hasPermi");return n(),c(g,null,[u(r,null,{default:d((()=>[u(l,{onRegister:p(v)},{toolbar_buttons:d((()=>[u(i,{type:"warning",preIcon:"ep:download",title:p(a)("action.export"),onClick:t[0]||(t[0]=e=>p(N)("错误数据.xls"))},null,8,["title"])])),duration_default:d((({row:e})=>[m("span",null,f(e.duration+"ms"),1)])),resultCode_default:d((({row:e})=>[m("span",null,f(0===e.resultCode?"成功":"失败("+e.resultMsg+")"),1)])),actionbtns_default:d((({row:e})=>[S(u(s,{preIcon:"ep:view",title:p(a)("action.detail"),onClick:t=>(e=>{D.value=e,U.value=a("action.detail"),P.value=!0})(e)},null,8,["title","onClick"]),[[j,["infra:api-access-log:query"]]]),e.processStatus===p(E).INIT?S((n(),_(s,{key:0,preIcon:"ep:cpu",title:"已处理",onClick:a=>O(e,p(E).DONE,"已处理")},null,8,["onClick"])),[[j,["infra:api-error-log:update-status"]]]):h("",!0),e.processStatus===p(E).INIT?S((n(),_(s,{key:1,preIcon:"ep:mute-notification",title:"已忽略",onClick:a=>O(e,p(E).IGNORE,"已忽略")},null,8,["onClick"])),[[j,["infra:api-error-log:update-status"]]]):h("",!0)])),_:1},8,["onRegister"])])),_:1}),u(b,{modelValue:p(P),"onUpdate:modelValue":t[2]||(t[2]=e=>T(P)?P.value=e:null),title:p(U)},{footer:d((()=>[u(i,{title:p(a)("dialog.close"),onClick:t[1]||(t[1]=e=>P.value=!1)},null,8,["title"])])),default:d((()=>[u(R,{schema:p(L).detailSchema,data:p(D)},null,8,["schema","data"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/infra/apiErrorLog/index.vue"]]);export{P as default};
