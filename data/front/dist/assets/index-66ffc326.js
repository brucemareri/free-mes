import{f as e,D as a,r as t,d as l,q as i,K as s,e as o,g as n,C as d,o as r,c as u,k as m,w as c,a as p,I as y,G as f,J as v,z as g,F as h,n as k,L as C,M as w,N as _,H as b,aJ as V,a1 as S,a0 as T,aa as I,ab as P,at as x,au as M,ae as U,_ as j}from"./index-4bfb878d.js";import{r as E}from"./formRules-eb36c657.js";import{u as R}from"./useVxeCrudSchemas-092b8963.js";import{g as q}from"./index-5d266c5c.js";import{u as D}from"./useXTable-309dffed.js";const A=e({name:[E],code:[E],content:[E],type:[E],status:[E]}),F=e({primaryKey:"id",primaryTitle:"编号",primaryType:null,action:!0,actionWidth:"260",columns:[{title:"模版编码",field:"code",isSearch:!0},{title:"模板名称",field:"name",isSearch:!0},{title:"发件人名称",field:"nickname"},{title:"类型",field:"type",dictType:a.SYSTEM_NOTIFY_TEMPLATE_TYPE,dictClass:"number"},{title:"模版内容",field:"content",table:{width:300},form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}}},{title:"状态",field:"status",dictType:a.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:"备注",field:"remark"},{title:"创建时间",field:"createTime",isForm:!1,formatter:"formatDate",search:{show:!0,itemRender:{name:"XDataTimePicker"}},table:{width:180}}]}),{allSchemas:N}=R(F),L=async e=>await t.get({url:"/admin-api/system/notify-template/page",params:e}),O=async e=>await t.get({url:"/admin-api/system/notify-template/get?id="+e}),Y=async e=>await t.delete({url:"/admin-api/system/notify-template/delete?id="+e}),z=l({name:"NotifyTemplate"}),J=j(l({...z,setup(e){const{t:a}=i(),l=s(),[j,{reload:E,deleteData:R}]=D({allSchemas:N,getListApi:L,deleteApi:Y}),F=o(!1),z=o("edit"),J=o(!1),K=o(""),W=o(!1),X=o(),G=o(),H=e=>{J.value=!0,z.value=a("action."+e),K.value=e,F.value=!0},Q=async()=>{var e;const i=null==(e=p(X))?void 0:e.getElFormRef();i&&i.validate((async e=>{var i;if(e){W.value=!0;try{const e=null==(i=p(X))?void 0:i.formModel;"create"===K.value?(await(async e=>await t.post({url:"/admin-api/system/notify-template/create",data:e}))(e),l.success(a("common.createSuccess"))):(await(async e=>await t.put({url:"/admin-api/system/notify-template/update",data:e}))(e),l.success(a("common.updateSuccess"))),F.value=!1}finally{W.value=!1,await E()}}}))},B=o({content:"",params:{},userId:0,templateCode:"",templateParams:{}}),Z=o({userId:[{required:!0,message:"用户编号不能为空",trigger:"blur"}],templateCode:[{required:!0,message:"模版编号不能为空",trigger:"blur"}],templateParams:{}}),$=o(!1),ee=o([]),ae=async()=>{const e={userId:B.value.userId,templateCode:B.value.templateCode,templateParams:B.value.templateParams},a=await(e=>t.post({url:"/admin-api/system/notify-template/send-notify",data:e}))(e);a&&l.success("提交发送成功！发送结果，见发送日志编号："+a),$.value=!1};return n((()=>{q().then((e=>{ee.value=e}))})),(e,t)=>{const l=C,i=w,s=_,o=b,n=V,E=S,q=T,D=I,L=P,Y=x,te=M,le=U,ie=d("hasPermi");return r(),u(h,null,[m(o,null,{default:c((()=>[m(s,{onRegister:p(j)},{toolbar_buttons:c((()=>[y(m(l,{type:"primary",preIcon:"ep:zoom-in",title:p(a)("action.add"),onClick:t[0]||(t[0]=e=>(H("create"),void(J.value=!1)))},null,8,["title"]),[[ie,["system:notify-template:create"]]])])),actionbtns_default:c((({row:e})=>[y(m(i,{preIcon:"ep:cpu",title:p(a)("action.test"),onClick:a=>(e=>{B.value.content=e.content,B.value.params=e.params,B.value.templateCode=e.code,B.value.templateParams=e.params.reduce((function(e,a){return e[a]=void 0,e}),{}),Z.value.templateParams=e.params.reduce((function(e,a){return e[a]={required:!0,message:"参数 "+a+" 不能为空",trigger:"change"},e}),{}),$.value=!0})(e)},null,8,["title","onClick"]),[[ie,["system:notify-template:send-notify"]]]),y(m(i,{preIcon:"ep:edit",title:p(a)("action.edit"),onClick:a=>(async e=>{var a;H("update");const t=await O(e);null==(a=p(X))||a.setValues(t),J.value=!1})(e.id)},null,8,["title","onClick"]),[[ie,["system:notify-template:update"]]]),y(m(i,{preIcon:"ep:view",title:p(a)("action.detail"),onClick:a=>(async e=>{H("detail");const a=await O(e);G.value=a,J.value=!1})(e.id)},null,8,["title","onClick"]),[[ie,["system:notify-template:query"]]]),y(m(i,{preIcon:"ep:delete",title:p(a)("action.del"),onClick:a=>p(R)(e.id)},null,8,["title","onClick"]),[[ie,["system:notify-template:delete"]]])])),_:1},8,["onRegister"])])),_:1}),m(q,{id:"templateModel",loading:p(J),modelValue:p(F),"onUpdate:modelValue":t[3]||(t[3]=e=>g(F)?F.value=e:null),title:p(z)},{footer:c((()=>[["create","update"].includes(p(K))?(r(),f(l,{key:0,type:"primary",title:p(a)("action.save"),loading:p(W),onClick:t[1]||(t[1]=e=>Q())},null,8,["title","loading"])):v("",!0),m(l,{loading:p(W),title:p(a)("dialog.close"),onClick:t[2]||(t[2]=e=>F.value=!1)},null,8,["loading","title"])])),default:c((()=>[["create","update"].includes(p(K))?(r(),f(n,{key:0,ref_key:"formRef",ref:X,schema:p(N).formSchema,rules:p(A)},null,8,["schema","rules"])):v("",!0),"detail"===p(K)?(r(),f(E,{key:1,schema:p(N).detailSchema,data:p(G)},null,8,["schema","data"])):v("",!0)])),_:1},8,["loading","modelValue","title"]),m(q,{id:"sendTest",modelValue:p($),"onUpdate:modelValue":t[8]||(t[8]=e=>g($)?$.value=e:null),title:"测试"},{footer:c((()=>[m(l,{type:"primary",title:p(a)("action.test"),loading:p(W),onClick:t[6]||(t[6]=e=>ae())},null,8,["title","loading"]),m(l,{title:p(a)("dialog.close"),onClick:t[7]||(t[7]=e=>$.value=!1)},null,8,["title"])])),default:c((()=>[m(le,{model:p(B),rules:p(Z),"label-width":"200px","label-position":"top"},{default:c((()=>[m(L,{label:"模板内容",prop:"content"},{default:c((()=>[m(D,{type:"textarea",modelValue:p(B).content,"onUpdate:modelValue":t[4]||(t[4]=e=>p(B).content=e),readonly:""},null,8,["modelValue"])])),_:1}),m(L,{label:"接收人",prop:"userId"},{default:c((()=>[m(te,{modelValue:p(B).userId,"onUpdate:modelValue":t[5]||(t[5]=e=>p(B).userId=e),placeholder:"请选择接收人"},{default:c((()=>[(r(!0),u(h,null,k(p(ee),(e=>(r(),f(Y,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(r(!0),u(h,null,k(p(B).params,(e=>(r(),f(L,{key:e,label:"参数 {"+e+"}",prop:"templateParams."+e},{default:c((()=>[m(D,{modelValue:p(B).templateParams[e],"onUpdate:modelValue":a=>p(B).templateParams[e]=a,placeholder:"请输入 "+e+" 参数"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/system/notify/template/index.vue"]]);export{J as default};
