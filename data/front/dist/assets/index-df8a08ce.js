import{r as e,q as a,f as t,D as l,d as s,K as n,e as i,C as o,o as r,c,k as d,w as u,a as m,I as p,X as f,t as y,G as g,J as k,z as w,F as v,aH as h,L as _,aq as b,M as S,N as x,H as C,aJ as I,a1 as T,a0 as D,_ as E}from"./index-4bfb878d.js";import{g as M}from"./index-7df6b46e.js";import{r as P}from"./formRules-eb36c657.js";import{u as j}from"./useVxeCrudSchemas-092b8963.js";import{u as R}from"./useXTable-309dffed.js";const A=a=>e.get({url:"/admin-api/system/tenant/page",params:a}),N=a=>e.get({url:"/admin-api/system/tenant/get?id="+a}),V=a=>e.delete({url:"/admin-api/system/tenant/delete?id="+a}),F=a=>e.download({url:"/admin-api/system/tenant/export-excel",params:a}),{t:L}=a(),z=[];(async()=>{(await M()).forEach((e=>{z.push({key:e.id,value:e.id,label:e.name})}))})();const U=t({name:[P],packageId:[P],contactName:[P],contactMobile:[P,{validator:(e,a,t)=>{const l=/^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/;""===a?t(new Error("请输入联系手机")):l.test(a)?t():t(new Error("请输入正确的手机号"))},trigger:"blur"}],accountCount:[P],expireTime:[P],username:[P,{min:4,max:30,trigger:"blur",message:"用户名称长度为 4-30 个字符"},{validator:(e,a,t)=>{const l=/^[a-zA-Z0-9]{4,30}$/;""===a?t(new Error("请输入用户名称")):(console.log(l.test(e),"reg.test(rule)"),l.test(a)?t():t(new Error("用户名称由 数字、字母 组成")))},trigger:"blur"}],password:[P,{min:4,max:16,trigger:"blur",message:"密码长度为 4-16 位"}],domain:[P],status:[P]}),X=t({primaryKey:"id",primaryTitle:"租户编号",primaryType:"id",action:!0,columns:[{title:"租户名称",field:"name",isSearch:!0},{title:"租户套餐",field:"packageId",table:{slots:{default:"packageId_default"}},form:{component:"Select",componentProps:{options:z}}},{title:"联系人",field:"contactName",isSearch:!0},{title:"联系手机",field:"contactMobile",isSearch:!0},{title:"用户名称",field:"username",isTable:!1,isDetail:!1},{title:"用户密码",field:"password",isTable:!1,isDetail:!1,form:{component:"InputPassword"}},{title:"账号额度",field:"accountCount",table:{slots:{default:"accountCount_default"}},form:{component:"InputNumber"}},{title:"过期时间",field:"expireTime",formatter:"formatDate",form:{component:"DatePicker",componentProps:{type:"datetime",valueFormat:"x"}}},{title:"绑定域名",field:"domain"},{title:"租户状态",field:"status",dictType:l.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:L("table.createTime"),field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:q}=j(X),H=s({name:"Tenant"}),J=E(s({...H,setup(t){const{t:l}=a(),s=n(),[E,{reload:M,deleteData:P,exportList:j}]=R({allSchemas:q,getListApi:A,deleteApi:V,exportListApi:F}),L=i(!1),X=i(""),H=i(!1),J=i("edit"),K=i(),O=i(),$=e=>{for(let a of z)if(a.value===e)return a.label;return"未知套餐"},G=e=>{J.value=l("action."+e),X.value=e,H.value=!0},Q=async()=>{var a;const t=null==(a=m(K))?void 0:a.getElFormRef();t&&t.validate((async a=>{var t;if(a){L.value=!0;try{const a=null==(t=m(K))?void 0:t.formModel;"create"===X.value?(await(a=>e.post({url:"/admin-api/system/tenant/create",data:a}))(a),s.success(l("common.createSuccess"))):(await(a=>e.put({url:"/admin-api/system/tenant/update",data:a}))(a),s.success(l("common.updateSuccess"))),H.value=!1}finally{L.value=!1,await M()}}}))};return(e,a)=>{const t=_,s=b,n=S,i=x,M=C,R=I,A=T,V=D,F=o("hasPermi");return r(),c(v,null,[d(M,null,{default:u((()=>[d(i,{onRegister:m(E)},{toolbar_buttons:u((()=>[p(d(t,{type:"primary",preIcon:"ep:zoom-in",title:m(l)("action.add"),onClick:a[0]||(a[0]=e=>(async()=>{var e,a;G("create"),await h(),"username"!==q.formSchema[4].field&&(null==(e=m(K))||e.addSchema({field:"username",label:"用户名称",component:"Input"},0),null==(a=m(K))||a.addSchema({field:"password",label:"用户密码",component:"InputPassword"},1))})())},null,8,["title"]),[[F,["system:tenant:create"]]]),p(d(t,{type:"warning",preIcon:"ep:download",title:m(l)("action.export"),onClick:a[1]||(a[1]=e=>m(j)("租户列表.xls"))},null,8,["title"]),[[F,["system:tenant:export"]]])])),accountCount_default:u((({row:e})=>[d(s,null,{default:u((()=>[f(y(e.accountCount),1)])),_:2},1024)])),packageId_default:u((({row:e})=>[0===e.packageId?(r(),g(s,{key:0,type:"danger"},{default:u((()=>[f("系统租户")])),_:1})):(r(),g(s,{key:1,type:"success"},{default:u((()=>[f(y($(e.packageId)),1)])),_:2},1024))])),actionbtns_default:u((({row:e})=>[p(d(n,{preIcon:"ep:edit",title:m(l)("action.edit"),onClick:a=>(async e=>{var a,t,l;G("update"),await h(),null==(a=m(K))||a.delSchema("username"),null==(t=m(K))||t.delSchema("password");const s=await N(e);null==(l=m(K))||l.setValues(s)})(e.id)},null,8,["title","onClick"]),[[F,["system:tenant:update"]]]),p(d(n,{preIcon:"ep:view",title:m(l)("action.detail"),onClick:a=>(async e=>{const a=await N(e);O.value=a,G("detail")})(e.id)},null,8,["title","onClick"]),[[F,["system:tenant:update"]]]),p(d(n,{preIcon:"ep:delete",title:m(l)("action.del"),onClick:a=>m(P)(e.id)},null,8,["title","onClick"]),[[F,["system:tenant:delete"]]])])),_:1},8,["onRegister"])])),_:1}),d(V,{modelValue:m(H),"onUpdate:modelValue":a[4]||(a[4]=e=>w(H)?H.value=e:null),title:m(J)},{footer:u((()=>[["create","update"].includes(m(X))?(r(),g(t,{key:0,type:"primary",title:m(l)("action.save"),loading:m(L),onClick:a[2]||(a[2]=e=>Q())},null,8,["title","loading"])):k("",!0),d(t,{loading:m(L),title:m(l)("dialog.close"),onClick:a[3]||(a[3]=e=>H.value=!1)},null,8,["loading","title"])])),default:u((()=>[["create","update"].includes(m(X))?(r(),g(R,{key:0,schema:m(q).formSchema,rules:m(U),ref_key:"formRef",ref:K},null,8,["schema","rules"])):k("",!0),"detail"===m(X)?(r(),g(A,{key:1,schema:m(q).detailSchema,data:m(O)},{packageId:u((({row:e})=>[0===e.packageId?(r(),g(s,{key:0,type:"danger"},{default:u((()=>[f("系统租户")])),_:1})):(r(),g(s,{key:1,type:"success"},{default:u((()=>[f(y($(e.packageId)),1)])),_:2},1024))])),_:1},8,["schema","data"])):k("",!0)])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/system/tenant/index.vue"]]);export{J as default};
