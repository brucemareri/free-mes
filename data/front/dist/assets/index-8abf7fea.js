import{q as e,f as a,D as l,d as t,K as s,e as r,g as i,C as d,o,c as n,k as u,w as c,a as m,I as p,j as f,t as v,G as y,J as g,F as k,n as w,z as h,aH as I,L as _,M as U,N as b,H as C,av as V,at as x,au as S,aJ as T,a0 as j,_ as R}from"./index-4bfb878d.js";import{d as M,h as A}from"./tree-5260b4e2.js";import{r as D}from"./formRules-eb36c657.js";import{u as F}from"./useVxeCrudSchemas-092b8963.js";import{g as E,d as N,l as q,a as z,c as G,u as H}from"./index-a751e4d0.js";import{g as J}from"./index-5d266c5c.js";import{u as K}from"./useXTable-309dffed.js";const{t:L}=e(),O=a({name:[D],sort:[D],email:[{required:!0,message:L("profile.rules.mail"),trigger:"blur"},{type:"email",message:L("profile.rules.truemail"),trigger:["blur","change"]}],phone:[{len:11,trigger:"blur",message:"请输入正确的手机号码"}]}),P=a({primaryKey:"id",primaryType:null,action:!0,columns:[{title:"上级部门",field:"parentId",isTable:!1},{title:"部门名称",field:"name",isSearch:!0,table:{treeNode:!0,align:"left"}},{title:"负责人",field:"leaderUserId",table:{slots:{default:"leaderUserId_default"}}},{title:"联系电话",field:"phone"},{title:"邮箱",field:"email",isTable:!1},{title:"显示排序",field:"sort"},{title:L("common.status"),field:"status",dictType:l.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:L("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1}]}),{allSchemas:Q}=F(P),W=t({name:"Dept"}),X=R(t({...W,setup(a){const{t:l}=e(),t=s(),R=r(),D=r(!1),F=r("edit"),L=r(""),P=r(!1),W=r(),X=r(),B=r([]),Y=async()=>{X.value=[];const e=await q();let a={id:0,name:"顶级部门",children:[]};a.children=A(e),X.value.push(a)},[Z,{reload:$,deleteData:ee}]=K({allSchemas:Q,treeConfig:{transform:!0,rowField:"id",parentField:"parentId",expandAll:!0},getListApi:E,deleteApi:N}),ae=e=>{F.value=l("action."+e),L.value=e,D.value=!0},le=e=>{if(!e||!e.leaderUserId)return"未设置";for(const a of B.value)if(e.leaderUserId===a.id)return a.nickname;return"未知【"+e.leaderUserId+"】"};return i((async()=>{await(async()=>{const e=await J();B.value=e})(),await Y()})),(e,a)=>{const s=_,r=U,i=b,A=C,E=V,N=x,q=S,J=T,K=j,te=d("hasPermi");return o(),n(k,null,[u(A,null,{default:c((()=>[u(i,{ref_key:"xGrid",ref:R,onRegister:m(Z),"show-overflow":""},{toolbar_buttons:c((()=>[p(u(s,{type:"primary",preIcon:"ep:zoom-in",title:m(l)("action.add"),onClick:a[0]||(a[0]=e=>(async()=>{ae("create")})())},null,8,["title"]),[[te,["system:dept:create"]]]),u(s,{title:"展开所有",onClick:a[1]||(a[1]=e=>{var a;return null==(a=m(R))?void 0:a.Ref.setAllTreeExpand(!0)})}),u(s,{title:"关闭所有",onClick:a[2]||(a[2]=e=>{var a;return null==(a=m(R))?void 0:a.Ref.clearTreeExpand()})})])),leaderUserId_default:c((({row:e})=>[f("span",null,v(le(e)),1)])),actionbtns_default:c((({row:e})=>[p(u(r,{preIcon:"ep:edit",title:m(l)("action.edit"),onClick:a=>(async e=>{var a;ae("update");const l=await z(e);await I(),null==(a=m(W))||a.setValues(l)})(e.id)},null,8,["title","onClick"]),[[te,["system:dept:update"]]]),p(u(r,{preIcon:"ep:delete",title:m(l)("action.del"),onClick:a=>m(ee)(e.id)},null,8,["title","onClick"]),[[te,["system:dept:delete"]]])])),_:1},8,["onRegister"])])),_:1}),u(K,{id:"deptModel",modelValue:m(D),"onUpdate:modelValue":a[5]||(a[5]=e=>h(D)?D.value=e:null),title:m(F)},{footer:c((()=>[["create","update"].includes(m(L))?(o(),y(s,{key:0,type:"primary",loading:m(P),onClick:a[3]||(a[3]=e=>(async()=>{var e;const a=null==(e=m(W))?void 0:e.getElFormRef();a&&a.validate((async e=>{var a;if(e){P.value=!0;try{const e=null==(a=m(W))?void 0:a.formModel;"create"===L.value?(await G(e),t.success(l("common.createSuccess"))):"update"===L.value&&(await H(e),t.success(l("common.updateSuccess"))),D.value=!1}finally{P.value=!1,await Y(),await $()}}}))})()),title:m(l)("action.save")},null,8,["loading","title"])):g("",!0),u(s,{loading:m(P),onClick:a[4]||(a[4]=e=>D.value=!1),title:m(l)("dialog.close")},null,8,["loading","title"])])),default:c((()=>[u(J,{ref_key:"formRef",ref:W,schema:m(Q).formSchema,rules:m(O)},{parentId:c((e=>[u(E,{"node-key":"id",modelValue:e.parentId,"onUpdate:modelValue":a=>e.parentId=a,props:m(M),data:m(X),"default-expanded-keys":[100],"check-strictly":""},null,8,["modelValue","onUpdate:modelValue","props","data"])])),leaderUserId:c((e=>[u(q,{modelValue:e.leaderUserId,"onUpdate:modelValue":a=>e.leaderUserId=a},{default:c((()=>[(o(!0),n(k,null,w(m(B),(e=>(o(),y(N,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},8,["schema","rules"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/system/dept/index.vue"]]);export{X as default};
