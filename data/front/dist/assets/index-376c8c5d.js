import{f as e,r as a,d as l,e as o,g as r,o as s,c as t,k as i,w as u,a as n,j as p,F as d,n as m,G as c,X as w,t as k,ce as h,aK as y,aR as b,H as v,Z as g,cn as f,co as _,at as N,au as x,ab as T,v as V,aL as C,aa as H,E as S,ae as z,a0 as j,_ as U}from"./index-4bfb878d.js";import{c as q}from"./index-529a6cde.js";import{c as D}from"./index-6c8a85ac.js";import{g as P}from"./workHoursType-c6ffc484.js";const A=e([{type:"select",label:"工时类型",prop:"workhoursType",placeholder:"选择工时类型",options:[]},{type:"input",label:"工时(小时)",prop:"workhours",placeholder:"请输入工时"},{type:"input",label:"工人姓名",prop:"workerName",placeholder:"请输入工人姓名"},{type:"input",label:"所属车间",prop:"workshopName",placeholder:"请输入所属车间"},{type:"dateTime",label:"开始时间",prop:"createTime",placeholder:"请选择开始时间"}]),E=e([{type:"primary",icon:"plus",state:"save",label:"新增",disabled:!1,permissions:[]},{type:"success",icon:"edit",state:"edit",label:"修改",disabled:!0,permissions:[]},{type:"danger",icon:"delete",state:"remove",label:"删除",disabled:!0,permissions:[]},{type:"warning",icon:"download",state:"download",label:"导出",permissions:[]}]),F=[{label:"工时类型",prop:"workhoursType"},{label:"工时(小时)",prop:"workhours"},{prop:"workerName",label:"工人姓名"},{prop:"workshopName",label:"所属车间"},{prop:"createTime",label:"创建时间"},{label:"操作",slot:"operation",width:"120",fixed:"right"}],M={style:{"margin-bottom":"20px"}},R=p("div",{class:"cell-item"},"总工时(小时)",-1),W={class:"dialog-footer"},$=U(l({__name:"index",setup(l){const U=o(),$=e({workhoursType:[{required:!0,message:"工时类型不能为空",trigger:"blur"}],workerName:[{required:!0,message:"员工姓名不能为空",trigger:"blur"}],workshopName:[{required:!0,message:"所属车间不能为空",trigger:"blur"}],workhours:[{required:!0,message:"工时不能为空",trigger:"blur"}]}),B=e({workhoursType:"",workhours:"",workerName:"",workshopName:"",createTime:"",endTime:""});let G=e({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const K=o(!1),L=o(!1);let Q=e([]),X=o(""),Z=o([]),I=o({workhoursType:"",workhours:0,workerName:"",workshopName:"",id:""}),J=o([]),O=o("");const Y=()=>{ne()},ee=async()=>{const e=await(async e=>await a.download({url:`/admin-api/mes/pro/temporary/workHours/export?ids=${e}`}))(Z.value);h.excel(e,"临时工时.xls")},ae=e=>{Z.value=e.map((e=>null==e?void 0:e.id)),E[1].disabled=!Z.value.length||Z.value.length>=2,E[2].disabled=!Z.value.length},le=()=>{X.value="添加临时工时",L.value=!0},oe=e=>{X.value="修改临时工时";const a=(null==e?void 0:e.id)||Z.value[0];se(a)},re=e=>{const l=(null==e?void 0:e.id)||Z.value,o=Array.isArray(l)?l:[l];y.confirm("是否删除当前数据?").then((()=>{(async e=>await a.delete({url:"/admin-api/mes/pro/temporary/workHours/batch",data:e}))(o).then((e=>{b.success("删除成功"),ne()}))}))},se=e=>{(async e=>await a.get({url:`/admin-api/mes/pro/temporary/workHours/get/${e}`}))(e).then((e=>{I.value=e,L.value=!0}))},te=e=>{G=null==e?void 0:e.value,ne()},ie=async()=>{U.value&&await U.value.validate((e=>{e&&(I.value.id?(async e=>await a.put({url:"/admin-api/mes/pro/temporary/workHours/update",data:e}))(I.value).then((e=>{b.success("修改成功"),ue(),ne()})):(async e=>await a.post({url:"/admin-api/mes/pro/temporary/workHours/save",data:e}))(I.value).then((e=>{b.success("新增成功"),ue(),ne()})))}))},ue=()=>{I.value={workhoursType:"",workhours:0,workerName:"",workshopName:"",id:""},L.value=!1},ne=()=>{const e={...B,pageNo:G.currentPage,pageSize:G.pageSize};K.value=!0,(async e=>await a.get({url:"/admin-api/mes/pro/temporary/workHours/list",params:e}))(e).then((e=>{const{list:a=[]}=e||{};console.log(e.total),O.value=a[0].totalWorkhours,Q=a[0].list,G.total=e.total})).finally((()=>{K.value=!1}))},pe=()=>{ne(),(()=>{const e={pageNo:G.currentPage,pageSize:20};P(e).then((e=>{const a=e.list.map((e=>({label:e.workhoursType,value:e.workhoursType})));J.value=a,A[0].options=a}))})()};return r((()=>{pe()})),(e,a)=>{const l=v,o=g,r=f,h=_,y=N,b=x,P=T,Z=V,se=C,ne=H,pe=S,de=z,me=j;return s(),t(d,null,[i(l,null,{default:u((()=>[i(q,{"conditions-list":n(A),"search-model":B,onQueryData:Y},null,8,["conditions-list","search-model"])])),_:1}),i(l,null,{default:u((()=>[p("div",M,[(s(!0),t(d,null,m(n(E),((e,a)=>(s(),c(o,{style:{"margin-bottom":"20px"},plain:"",type:e.type,key:a,icon:e.icon,disabled:e.disabled,onClick:a=>(e=>{switch(e){case"save":le();break;case"edit":oe();break;case"remove":re();break;case"download":ee()}})(e.state)},{default:u((()=>[w(k(e.label),1)])),_:2},1032,["type","icon","disabled","onClick"])))),128)),i(h,{class:"margin-top",column:3,border:""},{default:u((()=>[i(r,{width:120},{label:u((()=>[R])),default:u((()=>[w(" "+k(n(O)),1)])),_:1})])),_:1})]),i(D,{loading:K.value,isSelection:!0,columns:n(F),tableData:n(Q),pagination:n(G),onSelectionChange:ae,onPaginationChange:te},{operation:u((({scope:e})=>[i(o,{style:{"font-size":"17px"},type:"primary",link:"",onClick:a=>oe(e.row)},{default:u((()=>[w("修改")])),_:2},1032,["onClick"]),i(o,{style:{"font-size":"17px"},type:"primary",link:"",onClick:a=>re(e.row)},{default:u((()=>[w("删除")])),_:2},1032,["onClick"])])),_:1},8,["loading","columns","tableData","pagination"])])),_:1}),i(me,{width:"40%",modelValue:L.value,"onUpdate:modelValue":a[4]||(a[4]=e=>L.value=e),title:n(X),onBeforeClose:ue},{footer:u((()=>[p("span",W,[i(o,{type:"primary",onClick:ie},{default:u((()=>[w(" 提交 ")])),_:1}),i(o,{onClick:ue},{default:u((()=>[w("返回")])),_:1})])])),default:u((()=>[i(de,{ref_key:"ruleFormRef",ref:U,model:n(I),rules:$,"label-width":"100px"},{default:u((()=>[i(pe,null,{default:u((()=>[i(Z,{span:11},{default:u((()=>[i(P,{label:"工时类型",prop:"workhoursType"},{default:u((()=>[i(b,{modelValue:n(I).workhoursType,"onUpdate:modelValue":a[0]||(a[0]=e=>n(I).workhoursType=e),placeholder:"工时类型选择"},{default:u((()=>[(s(!0),t(d,null,m(n(J),(e=>(s(),c(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(Z,{span:12},{default:u((()=>[i(P,{label:"工时",prop:"workhours"},{default:u((()=>[i(se,{modelValue:n(I).workhours,"onUpdate:modelValue":a[1]||(a[1]=e=>n(I).workhours=e),min:0,max:9999},null,8,["modelValue"])])),_:1})])),_:1}),i(Z,{span:11},{default:u((()=>[i(P,{label:"员工姓名",prop:"workerName"},{default:u((()=>[i(ne,{modelValue:n(I).workerName,"onUpdate:modelValue":a[2]||(a[2]=e=>n(I).workerName=e),placeholder:"请输入员工姓名"},null,8,["modelValue"])])),_:1})])),_:1}),i(Z,{span:11},{default:u((()=>[i(P,{label:"所属车间",prop:"workshopName"},{default:u((()=>[i(ne,{modelValue:n(I).workshopName,"onUpdate:modelValue":a[3]||(a[3]=e=>n(I).workshopName=e),placeholder:"请输入所属车间"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/prodMgmt/lastWorkHours/index.vue"]]);export{$ as default};
