import{d as e,bx as a,u as l,e as o,a_ as n,a as t,f as i,aS as s,I as d,b4 as r,o as m,G as p,w as u,k as c,J as g,c as f,t as b,q as h,K as _,bJ as x,bH as y,bI as v,bK as w,bE as F,ab as N,v as k,aa as S,E as C,L as I,ae as V,_ as E}from"./index-4bfb878d.js";import{u as L}from"./useIcon-56588282.js";import{u as M,L as j,a as U,b as P}from"./LoginFormTitle-d6c51f0b.js";import{r as R}from"./formRules-eb36c657.js";const q={key:1,class:"getMobileCode",style:{cursor:"pointer"}},B=E(e({__name:"MobileForm",setup(e){const{t:E}=h(),B=_(),J=a(),{currentRoute:K,push:z}=l(),D=o(),G=o(!1),H=L({icon:"ep:house"}),O=L({icon:"ep:cellphone"}),T=L({icon:"ep:circle-check"}),{validForm:W}=P(D),{handleBackLogin:Y,getLoginState:$}=M(),A=n((()=>t($)===j.MOBILE)),Q={tenantName:[R],mobileNumber:[R],code:[R]},X=i({codeImg:"",tenantEnable:"true",token:"",loading:{signIn:!1},loginForm:{uuid:"",tenantName:"万界星空MES",mobileNumber:"",code:""}}),Z=i({smsCode:{mobile:"",scene:21},loginSms:{mobile:"",code:""}}),ee=o(0),ae=o(""),le=async()=>{await oe(),Z.smsCode.mobile=X.loginForm.mobileNumber,await x(Z.smsCode).then((async()=>{B.success(E("login.SmsSendMsg")),ee.value=60;let e=setInterval((()=>{ee.value=ee.value-1,ee.value<=0&&clearInterval(e)}),1e3)}))};s((()=>K.value),(e=>{var a;ae.value=null==(a=null==e?void 0:e.query)?void 0:a.redirect}),{immediate:!0});const oe=async()=>{if("true"===X.tenantEnable){const e=await y(X.loginForm.tenantName);v(e)}};return(e,a)=>{const l=N,o=k,n=S,i=C,s=I,h=V;return d((m(),p(h,{model:t(X).loginForm,rules:Q,"label-position":"top",class:"login-form","label-width":"120px",size:"large",ref_key:"formSmsLogin",ref:D},{default:u((()=>[c(i,{style:{"margin-left":"-10px","margin-right":"-10px"}},{default:u((()=>[c(o,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:u((()=>[c(l,null,{default:u((()=>[c(U,{style:{width:"100%"}})])),_:1})])),_:1}),c(o,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:u((()=>["true"===t(X).tenantEnable?(m(),p(l,{key:0,prop:"tenantName"},{default:u((()=>[c(n,{type:"text",modelValue:t(X).loginForm.tenantName,"onUpdate:modelValue":a[0]||(a[0]=e=>t(X).loginForm.tenantName=e),placeholder:t(E)("login.tenantNamePlaceholder"),"prefix-icon":t(H)},null,8,["modelValue","placeholder","prefix-icon"])])),_:1})):g("",!0)])),_:1}),c(o,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:u((()=>[c(l,{prop:"mobileNumber"},{default:u((()=>[c(n,{modelValue:t(X).loginForm.mobileNumber,"onUpdate:modelValue":a[1]||(a[1]=e=>t(X).loginForm.mobileNumber=e),placeholder:t(E)("login.mobileNumberPlaceholder"),"prefix-icon":t(O)},null,8,["modelValue","placeholder","prefix-icon"])])),_:1})])),_:1}),c(o,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:u((()=>[c(l,{prop:"code"},{default:u((()=>[c(i,{justify:"space-between",style:{width:"100%"},gutter:5},{default:u((()=>[c(o,{span:24},{default:u((()=>[c(n,{modelValue:t(X).loginForm.code,"onUpdate:modelValue":a[2]||(a[2]=e=>t(X).loginForm.code=e),placeholder:t(E)("login.codePlaceholder"),"prefix-icon":t(T)},{append:u((()=>[t(ee)<=0?(m(),f("span",{key:0,onClick:le,class:"getMobileCode",style:{cursor:"pointer"}},b(t(E)("login.getSmsCode")),1)):g("",!0),t(ee)>0?(m(),f("span",q,b(t(ee))+"秒后可重新获取 ",1)):g("",!0)])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1})])),_:1})])),_:1})])),_:1}),c(o,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:u((()=>[c(l,null,{default:u((()=>[c(s,{loading:t(G),type:"primary",class:"w-[100%]",title:t(E)("login.login"),onClick:a[3]||(a[3]=e=>(async()=>{await oe(),await W()&&(G.value=!0,Z.loginSms.mobile=X.loginForm.mobileNumber,Z.loginSms.code=X.loginForm.code,await w(Z.loginSms).then((async e=>{F(null==e?void 0:e.token),ae.value||(ae.value="/"),z({path:ae.value||J.addRouters[0].path})})).catch((()=>{})).finally((()=>{G.value=!1})))})())},null,8,["loading","title"])])),_:1})])),_:1}),c(o,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:u((()=>[c(l,null,{default:u((()=>[c(s,{loading:t(G),class:"w-[100%]",title:t(E)("login.backLogin"),onClick:a[4]||(a[4]=e=>t(Y)())},null,8,["loading","title"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])),[[r,t(A)]])}}}),[["__scopeId","data-v-b22ff821"],["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/login/components/MobileForm.vue"]]);export{B as default};
