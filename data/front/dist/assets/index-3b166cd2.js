import{q as e,f as a,ar as t,cr as o,a7 as l,bj as n,a_ as s,aS as i,e as r,a as c,aR as d,aK as u,ce as m,aH as p,d as f,o as h,G as g,w as v,k as b,cs as S,ct as w,X as P,Z as y,H as L,_ as x}from"./index-4bfb878d.js";import{e as T,t as z,f as _}from"./tree-5260b4e2.js";const{t:D}=e(),F=(e,a)=>{const l=[],n=[];T(e,(e=>{var s,i,r,c;if((null==e?void 0:e.isSearch)||(null==(s=e.search)?void 0:s.show)){let s=(null==(i=null==e?void 0:e.search)?void 0:i.component)||"Input";const d=[];let u={};if(e.dictType){const a={label:"全部",value:""};d.push(a),t(e.dictType).forEach((e=>{d.push(e)})),u={options:d},(null==(r=e.search)?void 0:r.component)||(s="Select")}const m={component:s,componentProps:u,...e.search,field:e.field,label:(null==(c=e.search)?void 0:c.label)||e.label};m.api&&n.push((async()=>{var e;const t=await m.api();if(t){const l=o(a.searchSchema,(e=>e.field===m.field));-1!==l&&(a.searchSchema[l].componentProps.options=j(t,null==(e=m.componentProps.optionsAlias)?void 0:e.labelField))}})),delete m.show,l.push(m)}}));for(const t of n)t();return l},A=e=>{const a=z(e,{conversion:e=>{var a;if(!1!==(null==e?void 0:e.isTable)&&!1!==(null==(a=null==e?void 0:e.table)?void 0:a.show))return{...e.table,...e}}});return _(a,(e=>(void 0===e.children&&delete e.children,!!e.field)))},C=(e,a)=>{const s=[],i=[];T(e,(e=>{var r,c,d,u,m;if(!1!==(null==e?void 0:e.isForm)&&!1!==(null==(r=null==e?void 0:e.form)?void 0:r.show)){let r=(null==(c=null==e?void 0:e.form)?void 0:c.component)||"Input",p="";(null==(d=e.form)?void 0:d.value)?p=null==(u=e.form)?void 0:u.value:"InputNumber"===r&&(p=0);let f={};if(e.dictType){const a=[];e.dictClass&&"number"===e.dictClass?l(e.dictType).forEach((e=>{a.push(e)})):e.dictClass&&"boolean"===e.dictClass?n(e.dictType).forEach((e=>{a.push(e)})):t(e.dictType).forEach((e=>{a.push(e)})),f={options:a},e.form&&e.form.component||(r="Select")}const h={component:r,componentProps:f,value:p,...e.form,field:e.field,label:(null==(m=e.form)?void 0:m.label)||e.label};h.api&&i.push((async()=>{var e;const t=await h.api();if(t){const l=o(a.formSchema,(e=>e.field===h.field));-1!==l&&(a.formSchema[l].componentProps.options=j(t,null==(e=h.componentProps.optionsAlias)?void 0:e.labelField))}})),delete h.show,s.push(h)}}));for(const t of i)t();return s},Y=e=>{const a=[];return T(e,(e=>{var t,o,l,n,s;if(!1!==(null==e?void 0:e.isDetail)&&!1!==(null==(t=e.detail)?void 0:t.show)){const t={...e.detail,field:e.field,label:(null==(o=e.detail)?void 0:o.label)||e.label};e.dictType&&(t.dictType=e.dictType),((null==(l=e.detail)?void 0:l.dateFormat)||"formatDate"==e.formatter)&&(t.dateFormat=(null==(n=null==e?void 0:e.detail)?void 0:n.dateFormat)?null==(s=null==e?void 0:e.detail)?void 0:s.dateFormat:"YYYY-MM-DD HH:mm:ss"),delete t.show,a.push(t)}})),a},j=(e,a)=>null==e?void 0:e.map((e=>(a?e.labelField=D(e.labelField):e.label=D(e.label),e))),{t:M}=e(),H=x(f({__name:"index",setup(e){const t=a([{field:"title",label:"标题",search:{show:!0},form:{colProps:{}},detail:{span:24}},{field:"display_time",label:"创建时间",form:{component:"DatePicker",componentProps:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss"}}},{field:"author",label:"作者"},{field:"action",width:"260px",label:"操作",form:{show:!1},detail:{show:!1}}]),{register:o,tableObject:l,methods:n}=(e=>{const t=a({pageSize:10,currentPage:1,total:10,tableList:[],params:{...(null==e?void 0:e.defaultParams)||{}},loading:!0,exportLoading:!1,currentRow:null}),o=s((()=>({...t.params,pageSize:t.pageSize,pageNo:t.currentPage})));i((()=>t.currentPage),(()=>{g.getList()})),i((()=>t.pageSize),(()=>{1===t.currentPage||(t.currentPage=1),g.getList()}));const l=r(),n=r(),f=async()=>{await p();const e=c(l);return e||console.error("The table is not registered. Please use the register method to register"),e},h=async a=>{let o=1;a instanceof Array?(o=a.length,await Promise.all(a.map((async a=>{await((null==e?void 0:e.delListApi)&&(null==e?void 0:e.delListApi(a)))})))):await((null==e?void 0:e.delListApi)&&(null==e?void 0:e.delListApi(a))),d.success(M("common.delSuccess")),t.currentPage=(t.total%t.pageSize===o||1===t.pageSize)&&t.currentPage>1?t.currentPage-1:t.currentPage,await g.getList()},g={getList:async()=>{t.loading=!0;const a=await(null==e?void 0:e.getListApi(c(o)).finally((()=>{t.loading=!1})));a&&(t.tableList=a.list,a.total&&(t.total=a.total))},setProps:async(e={})=>{const a=await f();null==a||a.setProps(e)},setColumn:async e=>{const a=await f();null==a||a.setColumn(e)},getSelections:async()=>{const e=await f();return(null==e?void 0:e.selections)||[]},setSearchParams:e=>{t.params=Object.assign(t.params,{pageSize:t.pageSize,pageNo:1,...e}),1!==t.currentPage?t.currentPage=1:g.getList()},delList:async(e,a,t=!0)=>{const o=await f();!a||(null==o?void 0:o.selections.length)?t?u.confirm(M("common.delMessage"),M("common.confirmTitle"),{confirmButtonText:M("common.ok"),cancelButtonText:M("common.cancel"),type:"warning"}).then((async()=>{await h(e)})):await h(e):d.warning(M("common.delNoData"))},exportList:async a=>{t.exportLoading=!0,u.confirm(M("common.exportMessage"),M("common.confirmTitle"),{confirmButtonText:M("common.ok"),cancelButtonText:M("common.cancel"),type:"warning"}).then((async()=>{var t;const l=await(null==(t=null==e?void 0:e.exportListApi)?void 0:t.call(e,c(o)));l&&m.excel(l,a)})).finally((()=>{t.exportLoading=!1}))}};return(null==e?void 0:e.props)&&g.setProps(e.props),{register:(e,a)=>{l.value=e,n.value=a},elTableRef:n,tableObject:t,methods:g}})(),{getList:f,setSearchParams:x}=n,{allSchemas:T}=(e=>{const t=a({searchSchema:[],tableColumns:[],formSchema:[],detailSchema:[]}),o=F(e,t);t.searchSchema=o||[];const l=A(e);t.tableColumns=l||[];const n=C(e,t);t.formSchema=n;const s=Y(e);return t.detailSchema=s,{allSchemas:t}})(t);return(e,a)=>{const t=y,n=L;return h(),g(n,null,{default:v((()=>[b(c(S),{schema:c(T).searchSchema,onSearch:c(x)},null,8,["schema","onSearch"]),b(c(w),{pageSize:c(l).pageSize,"onUpdate:pageSize":a[0]||(a[0]=e=>c(l).pageSize=e),currentPage:c(l).currentPage,"onUpdate:currentPage":a[1]||(a[1]=e=>c(l).currentPage=e),columns:c(T).tableColumns,data:c(l).tableList,onRegister:c(o),loading:c(l).loading,pagination:{total:c(l).total}},{action:v((()=>[b(t,null,{default:v((()=>[P("21212")])),_:1})])),_:1},8,["pageSize","currentPage","columns","data","onRegister","loading","pagination"])])),_:1})}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/masterData/demoView/index.vue"]]);export{H as default};
