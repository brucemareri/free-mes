import{d as e,e as a,f as l,aS as t,g as u,o,c as d,k as s,w as n,a as i,j as r,F as p,n as v,G as m,X as c,t as f,J as b,aR as h,aK as g,H as y,Z as _,aa as V,ab as C,v as k,aO as w,E as D,bN as x,at as N,au as U,aL as S,cb as Y,cM as P,ae as j,a0 as z,aq as M,l as q,ce as Q,_ as W}from"./index-4bfb878d.js";import{E as T}from"./el-space-b30f0ad6.js";import{c as E}from"./index-529a6cde.js";import{c as R}from"./index-6c8a85ac.js";import{s as A,b as F,t as I,p as L}from"./data-c99d5db7.js";import{e as O,d as G,a as H,b as J,c as K,g as X,u as Z,s as B,f as $,h as ee,i as ae,j as le}from"./schedulingPlan-bc6ff850.js";import{a as te,g as ue}from"./shiftSet-d38e6bbc.js";const oe={style:{"margin-bottom":"20px"}},de={key:0,style:{display:"flex","justify-content":"center"}},se={style:{"margin-bottom":"15px"}},ne={class:"card-header"},ie=r("span",{style:{"font-weight":"bold","font-size":"16px"}},"当前班组任务总数：",-1),re=r("span",{style:{"font-weight":"bold","font-size":"16px"}},"当前拥有任务",-1),pe=W(e({__name:"index",setup(e){const W=a(),pe=a({shiftDuration:0}),ve=l({planCode:[{required:!0,message:"请输入排班编号",trigger:"blur"}],planName:[{required:!0,message:"请输入排班编号",trigger:"blur"}],teamCode:[{required:!0,message:"请选择班组编号",trigger:"blur"}],shiftWay:[{required:!0,message:"请选择轮班方式",trigger:"blur"}],changeShiftWay:[{required:!0,message:"请选择倒班方式",trigger:"blur"}],startDate:[{required:!0,message:"请选择开始时间",trigger:"blur"}],endDate:[{required:!0,message:"请选择结束时间",trigger:"blur"}]}),me=a([]),ce=a([{label:"白班",value:"白班"},{label:"中班",value:"中班"},{label:"晚班",value:"晚班"}]),fe=a([{label:"两班倒",value:"两班倒"},{label:"三班倒",value:"三班倒"},{label:"四班倒",value:"四班倒"}]),be=l({teamType:"",planCode:"",planName:"",startDate:"",endDate:""}),he=a([]);let ge=l({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1}),ye=l({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const _e=a(!1),Ve=a(!1),Ce=a(""),ke=a(!1),we=a(!1),De=a([]),xe=a([]),Ne=a([]),Ue=a();t((()=>De.value),(e=>{Ne.value=e.map((e=>{const a=xe.value.find((a=>a.id===e));return{peopleId:a.id,teamPeople:a.userName}}))}));const Se=()=>{if(Ye.value.reduce(((e,a)=>e+(null==a?void 0:a.peopleQuantity)),0)>Ue.value)return h.error("不允许超过最大班组任务数量");O(Ye.value).then((e=>{h.success("更新成功"),we.value=!1}))},Ye=a([]),Pe=a(),je=a(!1),ze=async()=>{je.value=!0,await J({planCode:Pe.value}).then((e=>{const{countQuantity:a,pageResult:l={},value:t}=e||{};me.value=t,Ue.value=a,ye.total=null==l?void 0:l.total,Ye.value=null==l?void 0:l.list.map((e=>({...e,planPeopleName:e.planPeopleName,tablePeopleDataList:(null==e?void 0:e.peopleQuantity)||0})))})).finally((()=>{je.value=!1}))},Me=a([]),qe=async e=>{K(null==e?void 0:e.teamCode).then((e=>{Me.value=e}))},Qe=e=>{ye=null==e?void 0:e.value,ze()},We=()=>{if(!W.value)return;const e={...pe.value,selectedPersonnel:Ne.value};W.value.validate((a=>{a&&(pe.value.id?Z(e).then((e=>{h.success("修改成功"),Te()})):B(e).then((e=>{h.success("新增成功"),Te()})))}))},Te=()=>{De.value=[],pe.value={shiftDuration:0},Ve.value=!1,ke.value=!1,Ne.value=[],xe.value=[],Ke()},Ee=()=>{He()},Re=a(),Ae=e=>{Re.value=e.map((e=>null==e?void 0:e.id)),F[1].disabled=!Re.value.length||Re.value.length>=2,F[2].disabled=!Re.value.length},Fe=e=>{ge=null==e?void 0:e.value,He()},Ie=e=>{switch(e){case"save":Le();break;case"edit":Oe();break;case"remove":Ge();break;case"download":(async()=>{const e=await ae();Q.excel(e,"排班计划.xls")})()}},Le=()=>{Ce.value="添加排班计划信息",Ve.value=!0},Oe=e=>{Ce.value="修改排班计划信息";(e=>new Promise(((a,l)=>{le(e).then((e=>{a(e)}))})))(e?e.id:Re.value[0]).then((e=>{pe.value=e,xe.value=e.personsNotSelected,De.value=e.selectedPersonnel.map((e=>e.id)),console.log(De.value,"已选人员"),Ve.value=!0}))},Ge=e=>{const a=(null==e?void 0:e.id)||Re.value,l=Array.isArray(a)?a:[a];g.confirm("是否删除当前数据?").then((()=>{$(l).then((e=>{h.success("删除成功"),He()}))}))},He=()=>{_e.value=!0;const e={...be,pageSize:ge.pageSize,pageNo:ge.currentPage};ee(e).then((e=>{const{list:a,total:l}=e||{};he.value=a,ge.total=l})).finally((()=>{_e.value=!1}))},Je=a([]),Ke=()=>{He(),ue({}).then((e=>{const{list:a=[]}=e||{};Je.value=a.map((e=>({value:e.teamCode,label:e.teamCode})))}))};return u((()=>{Ke()})),(e,a)=>{const l=y,t=_,u=V,g=C,Q=k,O=w,J=D,K=x,Z=N,B=U,$=S,ee=Y,ae=P,le=j,ue=z,Ne=M,Re=q,Le=T;return o(),d(p,null,[s(l,null,{default:n((()=>[s(E,{"conditions-list":i(A),"search-model":be,onQueryData:Ee},null,8,["conditions-list","search-model"])])),_:1}),s(l,null,{default:n((()=>[r("div",oe,[(o(!0),d(p,null,v(i(F),((e,a)=>(o(),m(t,{plain:"",type:e.type,key:a,icon:e.icon,disabled:e.disabled,onClick:a=>Ie(e.state)},{default:n((()=>[c(f(e.label),1)])),_:2},1032,["type","icon","disabled","onClick"])))),128))]),s(R,{loading:_e.value,isSelection:!0,columns:i(I),tableData:he.value,pagination:i(ge),onSelectionChange:Ae,onPaginationChange:Fe},{teamPeople:n((({scope:e})=>[s(t,{link:"",type:"primary",onClick:a=>(async e=>{Pe.value=null==e?void 0:e.planCode,await ze(),await qe(e),we.value=!0})(e.row)},{default:n((()=>[c("详情")])),_:2},1032,["onClick"])])),operate:n((({scope:e})=>[s(t,{type:"primary",onClick:a=>{return l=e.row,pe.value=l,Ce.value="查看排班计划信息",ke.value=!0,void(Ve.value=!0);var l}},{default:n((()=>[c("详情")])),_:2},1032,["onClick"]),s(t,{type:"success",onClick:a=>Oe(e.row)},{default:n((()=>[c("修改")])),_:2},1032,["onClick"]),s(t,{type:"danger",onClick:a=>Ge(e.row)},{default:n((()=>[c("删除")])),_:2},1032,["onClick"])])),_:1},8,["loading","columns","tableData","pagination"])])),_:1}),s(ue,{modelValue:Ve.value,"onUpdate:modelValue":a[14]||(a[14]=e=>Ve.value=e),title:Ce.value,width:"90%",onClose:Te},{footer:n((()=>[ke.value?b("",!0):(o(),m(t,{key:0,type:"primary",onClick:We},{default:n((()=>[c("确定")])),_:1})),s(t,{onClick:Te},{default:n((()=>[c("取消")])),_:1})])),default:n((()=>[s(le,{ref_key:"ruleFormRef",ref:W,model:pe.value,rules:ve,"label-width":"80px"},{default:n((()=>[s(J,null,{default:n((()=>[s(Q,{span:6},{default:n((()=>[s(g,{label:"排班编号",prop:"planCode"},{default:n((()=>[s(u,{modelValue:pe.value.planCode,"onUpdate:modelValue":a[0]||(a[0]=e=>pe.value.planCode=e),disabled:ke.value||pe.value.id},null,8,["modelValue","disabled"])])),_:1})])),_:1}),ke.value||pe.value.id?b("",!0):(o(),m(Q,{key:0,span:6},{default:n((()=>[s(g,{label:"自动生成",prop:"autoCreate"},{default:n((()=>[s(O,{modelValue:pe.value.autoCreate,"onUpdate:modelValue":a[1]||(a[1]=e=>pe.value.autoCreate=e),onChange:a[2]||(a[2]=e=>{pe.value.autoCreate&&H().then((e=>{pe.value.planCode=e}))})},null,8,["modelValue"])])),_:1})])),_:1})),s(Q,{span:6},{default:n((()=>[s(g,{label:"排班名称",prop:"planName"},{default:n((()=>[s(u,{modelValue:pe.value.planName,"onUpdate:modelValue":a[3]||(a[3]=e=>pe.value.planName=e),disabled:ke.value},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),s(K),s(J,null,{default:n((()=>[s(Q,{span:6},{default:n((()=>[s(g,{label:"班组编号",prop:"teamCode"},{default:n((()=>[s(B,{disabled:ke.value,modelValue:pe.value.teamCode,"onUpdate:modelValue":a[4]||(a[4]=e=>pe.value.teamCode=e),placeholder:"请选择班组编号",onChange:a[5]||(a[5]=e=>{return a=pe.value.teamCode,X(a).then((e=>{pe.value.teamType=e.teamType,pe.value.teamName=e.teamName})),te(a).then((e=>{xe.value=e})),void(De.value=[]);var a})},{default:n((()=>[(o(!0),d(p,null,v(Je.value,(e=>(o(),m(Z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1}),s(Q,{span:6},{default:n((()=>[s(g,{label:"班组类型",prop:"teamType"},{default:n((()=>[s(u,{modelValue:pe.value.teamType,"onUpdate:modelValue":a[6]||(a[6]=e=>pe.value.teamType=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),s(Q,{span:6},{default:n((()=>[s(g,{label:"班组名称",prop:"teamName"},{default:n((()=>[s(u,{modelValue:pe.value.teamName,"onUpdate:modelValue":a[7]||(a[7]=e=>pe.value.teamName=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),s(Q,{span:6},{default:n((()=>[s(g,{label:"轮班时长",prop:"shiftDuration"},{default:n((()=>[s($,{style:{width:"197px"},min:0,modelValue:pe.value.shiftDuration,"onUpdate:modelValue":a[8]||(a[8]=e=>pe.value.shiftDuration=e),disabled:ke.value},null,8,["modelValue","disabled"])])),_:1})])),_:1}),s(Q,{span:6},{default:n((()=>[s(g,{label:"轮班方式",prop:"shiftWay"},{default:n((()=>[s(B,{disabled:ke.value,modelValue:pe.value.shiftWay,"onUpdate:modelValue":a[9]||(a[9]=e=>pe.value.shiftWay=e),placeholder:"请选择轮班方式"},{default:n((()=>[(o(!0),d(p,null,v(ce.value,(e=>(o(),m(Z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1}),s(Q,{span:6},{default:n((()=>[s(g,{label:"倒班方式",prop:"changeShiftWay"},{default:n((()=>[s(B,{disabled:ke.value,modelValue:pe.value.changeShiftWay,"onUpdate:modelValue":a[10]||(a[10]=e=>pe.value.changeShiftWay=e),placeholder:"请选择倒班方式"},{default:n((()=>[(o(!0),d(p,null,v(fe.value,(e=>(o(),m(Z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1}),s(Q,{span:6},{default:n((()=>[s(g,{label:"开始日期",prop:"startDate"},{default:n((()=>[s(ee,{disabled:ke.value,modelValue:pe.value.startDate,"onUpdate:modelValue":a[11]||(a[11]=e=>pe.value.startDate=e),type:"datetime",placeholder:"请选择开始日期","value-format":"YYYY-MM-DD hh:mm:ss",format:"YYYY-MM-DD hh:mm:ss","default-time":new Date},null,8,["disabled","modelValue","default-time"])])),_:1})])),_:1}),s(Q,{span:6},{default:n((()=>[s(g,{label:"结束日期",prop:"endDate"},{default:n((()=>[s(ee,{disabled:ke.value,modelValue:pe.value.endDate,"onUpdate:modelValue":a[12]||(a[12]=e=>pe.value.endDate=e),type:"datetime",placeholder:"请选择结束日期","value-format":"YYYY-MM-DD hh:mm:ss",format:"YYYY-MM-DD hh:mm:ss","default-time":new Date},null,8,["disabled","modelValue","default-time"])])),_:1})])),_:1})])),_:1}),s(K),ke.value?b("",!0):(o(),d("div",de,[s(ae,{props:{key:"id",label:"userName"},titles:["未选人员","已选人员"],modelValue:De.value,"onUpdate:modelValue":a[13]||(a[13]=e=>De.value=e),data:xe.value},null,8,["modelValue","data"])]))])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),s(ue,{modelValue:we.value,"onUpdate:modelValue":a[16]||(a[16]=e=>we.value=e),width:"75%",title:"排班人员",onClose:a[17]||(a[17]=e=>we.value=!1)},{footer:n((()=>[s(t,{type:"primary",onClick:Se},{default:n((()=>[c("提交")])),_:1}),s(t,{onClick:a[15]||(a[15]=e=>we.value=!1)},{default:n((()=>[c("取消")])),_:1})])),default:n((()=>[r("div",se,[s(Le,{wrap:"",fill:"",style:{width:"100%"}},{default:n((()=>[s(Re,{class:"box-card"},{header:n((()=>[r("div",ne,[ie,s(Ne,{type:"success",size:"large",style:{"font-weight":"bold"}},{default:n((()=>[c(f(Ue.value)+"个",1)])),_:1})])])),default:n((()=>[re,s(J,null,{default:n((()=>[(o(!0),d(p,null,v(Me.value,((e,a)=>(o(),m(Q,{span:6,key:a,style:{"margin-bottom":"10px"}},{default:n((()=>[c(f(e.taskName)+" ",1),s(Ne,{size:"large",style:{"font-weight":"bold"}},{default:n((()=>[c(f(e.quantity)+"个",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})]),s(R,{columns:i(L),tableData:Ye.value,loading:je.value,pagination:i(ye),onPaginationChange:Qe},{peopleQuantity:n((({scope:e})=>[s($,{min:0,modelValue:e.row.peopleQuantity,"onUpdate:modelValue":a=>e.row.peopleQuantity=a,max:Ue.value,placeholder:"请输入数量"},null,8,["modelValue","onUpdate:modelValue","max"])])),taskCode:n((({scope:e})=>[s(B,{modelValue:e.row.taskCode,"onUpdate:modelValue":a=>e.row.taskCode=a,placeholder:"请选择任务名称",clearable:""},{default:n((()=>[(o(!0),d(p,null,v(me.value,(e=>(o(),m(Z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),operate:n((({scope:e})=>[s(t,{type:"danger",link:"",onClick:a=>(e=>{if(0!=Number(e.peopleQuantity))return h.error("请先当前任务数量设置为：0");G(e.peopleId).then((e=>{h.success("移除成功"),ze()}))})(e.row)},{default:n((()=>[c("移除人员")])),_:2},1032,["onClick"])])),_:1},8,["columns","tableData","loading","pagination"])])),_:1},8,["modelValue"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/scheduling/schedulingPlan/index.vue"]]);export{pe as default};
