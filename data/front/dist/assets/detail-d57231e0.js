import{d as e,aw as a,ax as l,ay as s,U as t,az as i,aA as n,o,c as r,j as u,p as d,a as m,V as p,G as c,w as f,aB as v,aC as y,J as g,t as k,aD as b,aE as h,aF as _,r as w,$ as x,aG as T,e as U,f as I,b as V,g as C,aH as D,a6 as j,n as M,I as Y,k as z,X as E,F as H,h as S,ao as $,z as q,K as B,q as F,ab as A,aq as G,aa as K,ae as N,L as J,v as L,l as O,at as P,au as R,a0 as X,H as Q,aI as W,_ as Z}from"./index-4bfb878d.js";import{g as ee}from"./index-5d266c5c.js";import{g as ae}from"./index-ca7d0818.js";import{a as le}from"./index-d0a64031.js";import{g as se,a as te,r as ie,u as ne}from"./index-64278f80.js";import{f as oe}from"./formatTime-2097261b.js";import{b as re}from"./formCreate-a3356cdc.js";const ue=e({name:"ElTimeline",setup(e,{slots:i}){const n=a("timeline");return l("timeline",i),()=>s("ul",{class:[n.b()]},[t(i,"default")])}}),de=i({timestamp:{type:String,default:""},hideTimestamp:{type:Boolean,default:!1},center:{type:Boolean,default:!1},placement:{type:String,values:["top","bottom"],default:"bottom"},type:{type:String,values:["primary","success","warning","danger","info"],default:""},color:{type:String,default:""},size:{type:String,values:["normal","large"],default:"normal"},icon:{type:n},hollow:{type:Boolean,default:!1}}),me=e({name:"ElTimelineItem"});var pe=b(e({...me,props:de,setup(e){const l=a("timeline-item");return(e,a)=>(o(),r("li",{class:d([m(l).b(),{[m(l).e("center")]:e.center}])},[u("div",{class:d(m(l).e("tail"))},null,2),e.$slots.dot?g("v-if",!0):(o(),r("div",{key:0,class:d([m(l).e("node"),m(l).em("node",e.size||""),m(l).em("node",e.type||""),m(l).is("hollow",e.hollow)]),style:p({backgroundColor:e.color})},[e.icon?(o(),c(m(y),{key:0,class:d(m(l).e("icon"))},{default:f((()=>[(o(),c(v(e.icon)))])),_:1},8,["class"])):g("v-if",!0)],6)),e.$slots.dot?(o(),r("div",{key:1,class:d(m(l).e("dot"))},[t(e.$slots,"dot")],2)):g("v-if",!0),u("div",{class:d(m(l).e("wrapper"))},[e.hideTimestamp||"top"!==e.placement?g("v-if",!0):(o(),r("div",{key:0,class:d([m(l).e("timestamp"),m(l).is("top")])},k(e.timestamp),3)),u("div",{class:d(m(l).e("content"))},[t(e.$slots,"default")],2),e.hideTimestamp||"bottom"!==e.placement?g("v-if",!0):(o(),r("div",{key:1,class:d([m(l).e("timestamp"),m(l).is("bottom")])},k(e.timestamp),3))],2)],2))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/timeline/src/timeline-item.vue"]]);const ce=h(ue,{TimelineItem:pe}),fe=_(pe),ve={class:"el-icon-picture-outline"},ye={style:{"margin-left":"10%","margin-bottom":"20px","font-size":"14px"}},ge={class:"el-icon-document"},ke={key:1},be=u("span",{class:"el-icon-picture-outline"},"审批记录",-1),he={class:"block"},_e={style:{"font-weight":"700"}},we={key:0,style:{"font-weight":"normal","margin-right":"30px"}},xe={key:1,style:{"font-weight":"normal"}},Te={style:{color:"#8a909c","font-weight":"normal"}},Ue={key:2,style:{"margin-left":"30px","font-weight":"normal"}},Ie={key:3,style:{color:"#8a909c","font-weight":"normal"}},Ve={key:4,style:{"margin-left":"30px","font-weight":"normal"}},Ce={key:5,style:{color:"#8a909c","font-weight":"normal"}},De={key:6},je=u("span",{class:"el-icon-picture-outline"},"流程图",-1),Me=Z(e({__name:"detail",setup(e){const{query:a}=x(),l=B(),{t:s}=F(),{proxy:t}=T(),i=a.id,n=U(!1),d=U({}),p=U([]),v=U([]),y=I({reason:[{required:!0,message:"审批建议不能为空",trigger:"blur"}]}),b=async(e,a)=>{const s=p.value.indexOf(e),i=t.$refs["form"+s][0],n=m(i);if(!n)return;if(!(await n.validate()))return;const o={id:e.id,reason:v.value[s].reason};a?(await te(o),l.success("审批通过成功")):(await ie(o),l.success("审批不通过成功")),Ge()},h=U(),_=V().getUser.id,Z=U({rule:[],option:{},value:{}}),ue=U(!0),de=U([]),me=e=>1===e.result?"el-icon-time":2===e.result?"el-icon-check":3===e.result?"el-icon-close":4===e.result?"el-icon-remove-outline":"",pe=e=>1===e.result?"primary":2===e.result?"success":3===e.result?"danger":4===e.result?"info":"",Me=U(!1),Ye=U(!1),ze=U({id:void 0,assigneeUserId:void 0}),Ee=U({assigneeUserId:[{required:!0,message:"新审批人不能为空",trigger:"change"}]}),He=U(),Se=U([]),$e=async()=>{const e=m(He);if(!e)return;if(await e.validate()){Ye.value=!0;try{await ne(ze.value),Me.value=!1,Ge()}finally{Ye.value=!1}}},qe=()=>{var e;ze.value={id:void 0,assigneeUserId:void 0},null==(e=He.value)||e.resetFields()},Be=U(null),Fe=U({prefix:"flowable"}),Ae=U([]);C((()=>{Ge(),ee().then((e=>{Se.value.push(...e)}))}));const Ge=()=>{n.value=!0,ae(i).then((e=>{if(!e)return void l.error("查询不到流程信息！");d.value=e;const a=e.processDefinition;10===a.formType&&(re(Z,a.formConf,a.formFields,e.formVariables),D().then((()=>{var e,a,l,s,t,i;null==(a=null==(e=h.value)?void 0:e.fapi)||a.btn.show(!1),null==(s=null==(l=h.value)?void 0:l.fapi)||s.resetBtn.show(!1),null==(i=null==(t=h.value)?void 0:t.fapi)||i.disabled(!0)}))),le(a.id).then((e=>{Be.value=e})),(async e=>await w.get({url:"/admin-api/bpm/activity/list",params:e}))({processInstanceId:e.id}).then((e=>{Ae.value=e}))})).finally((()=>{n.value=!1})),ue.value=!0,p.value=[],v.value=[],se(i).then((e=>{de.value=[],e.forEach((e=>{4!==e.result&&de.value.push(e)})),de.value.sort(((e,a)=>e.endTime&&a.endTime?a.endTime-e.endTime:e.endTime?1:a.endTime?-1:a.createTime-e.createTime)),de.value.forEach((e=>{1===e.result&&e.assigneeUser&&e.assigneeUser.id===_&&(p.value.push({...e}),v.value.push({reason:""}))}))})).finally((()=>{ue.value=!1}))};return(e,a)=>{const t=A,i=G,_=K,w=N,x=J,T=L,U=O,I=j("form-create"),V=j("router-link"),C=fe,D=ce,B=j("my-process-viewer"),F=P,ee=R,ae=X,le=Q,se=W;return o(),c(le,null,{default:f((()=>[(o(!0),r(H,null,M(m(p),((e,a)=>Y((o(),c(U,{class:"box-card",key:a},{header:f((()=>[u("span",ve,"审批任务【"+k(e.name)+"】",1)])),default:f((()=>[z(T,{span:16,offset:6},{default:f((()=>[z(w,{ref_for:!0,ref:"form"+a,model:m(v)[a],rules:m(y),"label-width":"100px"},{default:f((()=>[m(d)&&m(d).name?(o(),c(t,{key:0,label:"流程名"},{default:f((()=>[E(k(m(d).name),1)])),_:1})):g("",!0),m(d)&&m(d).startUser?(o(),c(t,{key:1,label:"流程发起人"},{default:f((()=>[E(k(m(d).startUser.nickname)+" ",1),z(i,{type:"info",size:"small"},{default:f((()=>[E(k(m(d).startUser.deptName),1)])),_:1})])),_:1})):g("",!0),z(t,{label:"审批建议",prop:"reason"},{default:f((()=>[z(_,{type:"textarea",modelValue:m(v)[a].reason,"onUpdate:modelValue":e=>m(v)[a].reason=e,placeholder:"请输入审批建议"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]),u("div",ye,[z(x,{"pre-icon":"ep:select",type:"success",title:"通过",onClick:a=>b(e,!0)},null,8,["onClick"]),z(x,{"pre-icon":"ep:close",type:"danger",title:"不通过",onClick:a=>b(e,!1)},null,8,["onClick"]),z(x,{"pre-icon":"ep:edit",type:"primary",title:"转办",onClick:a=>{return l=e,qe(),ze.value.id=l.id,void(Me.value=!0);var l}},null,8,["onClick"]),z(x,{"pre-icon":"ep:position",type:"primary",title:"委派",onClick:a=>(async e=>{l.error("暂不支持【委派】功能，可以使用【转派】替代！"),console.log(e)})(e)},null,8,["onClick"]),z(x,{"pre-icon":"ep:back",type:"warning",title:"委派",onClick:a=>(async e=>{l.error("暂不支持【退回】功能！"),console.log(e)})(e)},null,8,["onClick"])])])),_:2},1024)])),_:2},1024)),[[se,m(n)]]))),128)),Y((o(),c(U,{class:"box-card"},{header:f((()=>[u("span",ge,"申请信息【"+k(m(d).name)+"】",1)])),default:f((()=>{var e,l,s,t;return[10===(null==(l=null==(e=m(d))?void 0:e.processDefinition)?void 0:l.formType)?(o(),c(T,{key:0,span:16,offset:6},{default:f((()=>[z(I,{ref_key:"fApi",ref:h,rule:m(Z).rule,option:m(Z).option,modelValue:m(Z).value,"onUpdate:modelValue":a[0]||(a[0]=e=>m(Z).value=e)},null,8,["rule","option","modelValue"])])),_:1})):g("",!0),20===(null==(t=null==(s=m(d))?void 0:s.processDefinition)?void 0:t.formType)?(o(),r("div",ke,[z(V,{to:m(d).processDefinition.formCustomViewPath+"?id="+m(d).businessKey},{default:f((()=>[z(x,{type:"primary",preIcon:"ep:view",title:"点击查看"})])),_:1},8,["to"])])):g("",!0)]})),_:1})),[[se,m(n)]]),Y((o(),c(U,{class:"box-card"},{header:f((()=>[be])),default:f((()=>[z(T,{span:16,offset:4},{default:f((()=>[u("div",he,[z(D,null,{default:f((()=>[(o(!0),r(H,null,M(m(de),((e,a)=>(o(),c(C,{key:a,icon:me(e),type:pe(e)},{default:f((()=>[u("p",_e,"任务："+k(e.name),1),z(U,{"body-style":{padding:"10px"}},{default:f((()=>[e.assigneeUser?(o(),r("label",we,[E(" 审批人："+k(e.assigneeUser.nickname)+" ",1),z(i,{type:"info",size:"small"},{default:f((()=>[E(k(e.assigneeUser.deptName),1)])),_:2},1024)])):g("",!0),e.createTime?(o(),r("label",xe,"创建时间：")):g("",!0),u("label",Te,k(m(S)(null==e?void 0:e.createTime).format("YYYY-MM-DD HH:mm:ss")),1),e.endTime?(o(),r("label",Ue," 审批时间： ")):g("",!0),e.endTime?(o(),r("label",Ie,k(m(S)(null==e?void 0:e.endTime).format("YYYY-MM-DD HH:mm:ss")),1)):g("",!0),e.durationInMillis?(o(),r("label",Ve," 耗时： ")):g("",!0),e.durationInMillis?(o(),r("label",Ce,k(m(oe)(null==e?void 0:e.durationInMillis)),1)):g("",!0),e.reason?(o(),r("p",De,[z(i,{type:pe(e)},{default:f((()=>[E(k(e.reason),1)])),_:2},1032,["type"])])):g("",!0)])),_:2},1024)])),_:2},1032,["icon","type"])))),128))])),_:1})])])),_:1})])),_:1})),[[se,m(ue)]]),Y((o(),c(U,{class:"box-card"},{header:f((()=>[je])),default:f((()=>[z(B,$({key:"designer",modelValue:m(Be),"onUpdate:modelValue":a[1]||(a[1]=e=>q(Be)?Be.value=e:null),value:m(Be)},m(Fe),{prefix:m(Fe).prefix,activityData:m(Ae),processInstanceData:m(d),taskData:m(de)}),null,16,["modelValue","value","prefix","activityData","processInstanceData","taskData"])])),_:1})),[[se,m(n)]]),z(ae,{modelValue:m(Me),"onUpdate:modelValue":a[4]||(a[4]=e=>q(Me)?Me.value=e:null),title:"转派审批人",width:"500"},{footer:f((()=>[z(x,{type:"primary",title:m(s)("action.save"),loading:m(Ye),onClick:$e},null,8,["title","loading"]),z(x,{loading:m(Ye),title:m(s)("dialog.close"),onClick:a[3]||(a[3]=e=>Ye.value=!1)},null,8,["loading","title"])])),default:f((()=>[z(w,{ref_key:"updateAssigneeFormRef",ref:He,model:m(ze),rules:m(Ee),"label-width":"110px"},{default:f((()=>[z(t,{label:"新审批人",prop:"assigneeUserId"},{default:f((()=>[z(ee,{modelValue:m(ze).assigneeUserId,"onUpdate:modelValue":a[2]||(a[2]=e=>m(ze).assigneeUserId=e),clearable:"",style:{width:"100%"}},{default:f((()=>[(o(!0),r(H,null,M(m(Se),(e=>(o(),c(F,{key:parseInt(e.id),label:e.nickname,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1})}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/bpm/processInstance/detail.vue"]]);export{Me as default};
