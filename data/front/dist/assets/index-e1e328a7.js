import{f as e,d as a,e as l,a_ as t,g as o,o as s,c as u,k as n,w as d,a as i,j as r,F as p,n as m,G as v,X as c,t as g,J as b,aR as y,aK as f,H as _,Z as h,aa as C,ab as k,v as w,aO as V,at as N,au as S,E as x,ae as T,a0 as z,ce as P,_ as U}from"./index-4bfb878d.js";import{c as j}from"./index-529a6cde.js";import{c as D}from"./index-6c8a85ac.js";import{d as L,b as q,c as A,s as E,e as F,u as R,f as G,h as H,g as J,i as K,j as M}from"./shiftSet-d38e6bbc.js";import{a as O}from"./classType-375ef761.js";const Q=e([{type:"select",label:"班组类型",prop:"teamType",placeholder:"选择班组类型",options:[]},{type:"input",label:"班组编号",prop:"teamCode",placeholder:"请输入班组编号"},{type:"input",label:"班组名称",prop:"teamName",placeholder:"请输入班组名称"}]),X=e([{type:"primary",icon:"plus",state:"save",label:"新增",disabled:!1,permissions:[]},{type:"success",icon:"edit",state:"edit",label:"修改",disabled:!0,permissions:[]},{type:"danger",icon:"delete",state:"remove",label:"批量删除",disabled:!0,permissions:[]},{type:"warning",icon:"download",state:"download",label:"导出",disabled:!1,permissions:[]}]),Z=[{label:"班组编号",prop:"teamCode"},{label:"班组类型",prop:"teamType"},{label:"班组名称",prop:"teamName"},{label:"班组组长",prop:"teamLeader"},{label:"班组人员",slot:"shiftPersonnel"},{label:"备注",prop:"remark"},{label:"操作",slot:"operate",width:"380",fixed:"right"}],B=[{label:"人员编号",prop:"id"},{label:"人员名称",prop:"userName"}],I={style:{"margin-bottom":"20px"}},W=U(a({__name:"index",setup(a){const U=l(),W=l({teamCode:{required:!0,message:"班组编号不能为空格",trigger:"blur"},teamType:{required:!0,message:"班组类型不能为空格",trigger:"blur"},teamName:{required:!0,message:"班组名称不能为空格",trigger:"blur"},teamLeader:{required:!0,message:"班组组长不能为空格",trigger:"blur"}}),Y=l({generate:!1,teamCode:"",teamLeader:"",teamName:"",teamType:"",remark:""}),$=e({teamType:"",teamCode:"",teamName:""}),ee=l([]),ae=l([]);let le=e({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1}),te=e({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const oe=l(!1),se=l(!1);l("");const ue=l(!1),ne=l(),de=l(""),ie=l(!1),re=l(),pe=t((()=>ue.value?[...B,{label:"操作",slot:"operate"}]:[...B])),me=e=>{te=null==e?void 0:e.value,ue.value?ve(ne.value):ce()},ve=async e=>{const a={pageNo:te.currentPage,pageSize:te.pageSize,teamCode:e.teamCode};await q(a).then((e=>{const{list:a,total:l}=e||{};ae.value=a,te.total=l}))},ce=()=>new Promise(((e,a)=>{A({pageNo:te.currentPage,pageSize:te.pageSize}).then((a=>{const{list:l=[],total:t}=a;ae.value=l,te.total=t,e(a)}))})),ge=()=>{if(!ye.value.length)return y({message:"未选择人员",type:"error"});E(ye.value).then((e=>{y({message:"新增成功",type:"success"}),be(),Ue()}))},be=()=>{ie.value=!1,ue.value=!1},ye=l([]),fe=e=>{ye.value=e.map((e=>({id:e.id,personCode:e.id,userName:e.userName,teamCode:re.value.teamCode,teamType:re.value.teamType,teamName:re.value.teamName})))},_e=l(!1),he=e=>{e&&F().then((e=>{Y.value.teamCode=e}))},Ce=()=>{U.value&&U.value.validate((e=>{var a;e&&((null==(a=Y.value)?void 0:a.id)?R(Y.value).then((e=>{e&&(y({message:"修改成功",type:"success"}),Pe(),Ue())})):G(Y.value).then((e=>{e&&(y({message:"新增成功",type:"success"}),Pe(),Ue())})))}))},ke=()=>{Ue()},we=l(),Ve=e=>{we.value=e.map((e=>null==e?void 0:e.id)),X[1].disabled=!we.value.length||we.value.length>=2,X[2].disabled=!we.value.length},Ne=e=>{le=null==e?void 0:e.value,Ue()},Se=e=>{switch(e){case"save":xe();break;case"edit":Te();break;case"remove":ze();break;case"download":(async()=>{const e=await K();P.excel(e,"班组管理.xls")})()}},xe=()=>{de.value="添加班组",se.value=!0},Te=e=>{de.value="修改班组";(e=>new Promise(((a,l)=>{M(e).then((e=>{a(e)}))})))(e?e.id:we.value[0]).then((e=>{Y.value=e,se.value=!0}))},ze=e=>{const a=(null==e?void 0:e.id)||we.value,l=Array.isArray(a)?a:[a];f.confirm("是否删除当前班组？当前班组可能包含班组人员?").then((()=>{H(l).then((e=>{y.success("删除成功"),Ue()}))}))},Pe=()=>{Y.value={},_e.value=!1,se.value=!1},Ue=()=>{oe.value=!0;const e={...$,pageSize:le.pageSize,pageNo:le.currentPage};J(e).then((e=>{const{list:a,total:l}=e||{};Q[0].options=a.map((e=>({value:e.teamType,label:e.teamType}))),ee.value=a,le.total=l})).finally((()=>{oe.value=!1}))},je=l([]);return o((()=>{Ue(),O({}).then((e=>{const{list:a}=e||{};je.value=a.map((e=>({value:e.typeName,label:e.typeName})))}))})),(e,a)=>{const l=_,t=h,o=C,f=k,P=w,q=V,A=N,E=S,F=x,R=T,G=z;return s(),u(p,null,[n(l,null,{default:d((()=>[n(j,{"conditions-list":i(Q),"search-model":$,onQueryData:ke},null,8,["conditions-list","search-model"])])),_:1}),n(l,null,{default:d((()=>[r("div",I,[(s(!0),u(p,null,m(i(X),((e,a)=>(s(),v(t,{plain:"",type:e.type,key:a,icon:e.icon,disabled:e.disabled,onClick:a=>Se(e.state)},{default:d((()=>[c(g(e.label),1)])),_:2},1032,["type","icon","disabled","onClick"])))),128))]),n(D,{loading:oe.value,isSelection:!0,columns:i(Z),tableData:ee.value,pagination:i(le),onSelectionChange:Ve,onPaginationChange:Ne},{shiftPersonnel:d((({scope:e})=>[n(t,{type:"primary",link:"",onClick:a=>(async e=>{de.value="查看班组人员",ne.value=e,ue.value=!0,await ve(e),ie.value=!0})(e.row)},{default:d((()=>[c("详情")])),_:2},1032,["onClick"])])),operate:d((({scope:e})=>[n(t,{type:"primary",onClick:a=>{return l=e.row,de.value="添加人员",re.value=l,void ce().then((e=>{ie.value=!0}));var l}},{default:d((()=>[c("添加人员")])),_:2},1032,["onClick"]),n(t,{type:"primary",onClick:a=>{return l=e.row,de.value="查看班组详情",Y.value=l,_e.value=!0,void(se.value=!0);var l}},{default:d((()=>[c("详情")])),_:2},1032,["onClick"]),n(t,{type:"success",onClick:a=>Te(e.row)},{default:d((()=>[c("修改")])),_:2},1032,["onClick"]),n(t,{type:"danger",onClick:a=>ze(e.row)},{default:d((()=>[c("删除")])),_:2},1032,["onClick"])])),_:1},8,["loading","columns","tableData","pagination"])])),_:1}),n(G,{modelValue:se.value,"onUpdate:modelValue":a[6]||(a[6]=e=>se.value=e),title:de.value,width:"60%",onClose:Pe},{footer:d((()=>[_e.value?b("",!0):(s(),v(t,{key:0,type:"primary",onClick:Ce},{default:d((()=>[c("确定")])),_:1})),n(t,{onClick:Pe},{default:d((()=>[c("取消")])),_:1})])),default:d((()=>[n(R,{"label-width":"100px",ref_key:"ruleFormRef",ref:U,model:Y.value,rules:W.value,"status-icon":""},{default:d((()=>[n(F,null,{default:d((()=>[n(P,{span:8},{default:d((()=>[n(f,{label:"班组编号",prop:"teamCode"},{default:d((()=>[n(o,{modelValue:Y.value.teamCode,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value.teamCode=e),disabled:_e.value||Y.value.id},null,8,["modelValue","disabled"])])),_:1})])),_:1}),_e.value||Y.value.id?b("",!0):(s(),v(P,{key:0,span:8},{default:d((()=>[n(f,{label:"自动生成",prop:"generate"},{default:d((()=>[n(q,{modelValue:Y.value.generate,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.value.generate=e),onChange:he},null,8,["modelValue"])])),_:1})])),_:1})),n(P,{span:8},{default:d((()=>[n(f,{label:"班组类型",prop:"teamType"},{default:d((()=>[n(E,{modelValue:Y.value.teamType,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.value.teamType=e),placeholder:"请选择班组类型",disabled:_e.value},{default:d((()=>[(s(!0),u(p,null,m(je.value,(e=>(s(),v(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),n(P,{span:8},{default:d((()=>[n(f,{label:"班组名称",prop:"teamName"},{default:d((()=>[n(o,{modelValue:Y.value.teamName,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.value.teamName=e),disabled:_e.value},null,8,["modelValue","disabled"])])),_:1})])),_:1}),n(P,{span:8},{default:d((()=>[n(f,{label:"班组组长",prop:"teamLeader"},{default:d((()=>[n(o,{modelValue:Y.value.teamLeader,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.value.teamLeader=e),disabled:_e.value},null,8,["modelValue","disabled"])])),_:1})])),_:1}),n(P,{span:8},{default:d((()=>[n(f,{label:"备注",prop:"remark"},{default:d((()=>[n(o,{disabled:_e.value,modelValue:Y.value.remark,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.value.remark=e),type:"textarea",autosize:""},null,8,["disabled","modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),n(G,{modelValue:ie.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ie.value=e),title:de.value,width:"60%",onClose:be},{footer:d((()=>[ue.value?b("",!0):(s(),v(t,{key:0,type:"primary",onClick:ge},{default:d((()=>[c("确定")])),_:1})),n(t,{onClick:be},{default:d((()=>[c("取消")])),_:1})])),default:d((()=>[n(D,{pagination:i(te),loading:oe.value,isSelection:!ue.value,columns:pe.value,tableData:ae.value,onPaginationChange:me,onSelectionChange:fe},{operate:d((({scope:e})=>[n(t,{type:"danger",onClick:a=>{return l=e.row,void L([l.id]).then((e=>{e&&(y({message:"移除成功",type:"success"}),ve(ne.value))}));var l},link:""},{default:d((()=>[c("移除人员")])),_:2},1032,["onClick"])])),_:1},8,["pagination","loading","isSelection","columns","tableData"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/scheduling/shiftSet/index.vue"]]);export{W as default};
