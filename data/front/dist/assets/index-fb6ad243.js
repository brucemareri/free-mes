import{f as e,r as a,d as l,e as t,g as s,C as r,o as i,c as n,k as u,w as d,a as o,j as m,F as p,n as c,I as g,G as y,X as b,t as f,J as v,ce as h,aK as _,aR as w,H as k,Z as F,aq as x,aa as V,ab as C,v as N,aL as U,E as R,ac as j,ad as S,at as Y,au as z,ae as q,a0 as D,_ as I}from"./index-4bfb878d.js";import{c as P}from"./index-529a6cde.js";import{c as A}from"./index-6c8a85ac.js";import{a as E,U as M}from"./const-f443e30b.js";const B=e([{type:"input",label:"单位编码",prop:"id",placeholder:"请输入单位编码"},{type:"input",label:"单位名称",prop:"measureName",placeholder:"请输入单位名称"}]),G=e([{type:"primary",icon:"plus",state:"save",label:"新增",disabled:!1,authority:"md:unitmeasure:save",permissions:[]},{type:"success",icon:"edit",state:"edit",label:"修改",disabled:!0,authority:"md:unitmeasure:update",permissions:[]},{type:"danger",icon:"delete",state:"remove",label:"批量删除",disabled:!0,permissions:[],authority:"md:unitmeasure:delete"},{type:"warning",icon:"download",state:"download",label:"导出",permissions:[],authority:"mes:md:unitmeasure:export"}]),H=[{label:"单位编码",prop:"id",align:"center"},{prop:"measureName",label:"单位名称",align:"center"},{slot:"primaryFlag",label:"是否是主单位",align:"center"},{prop:"changeRate",label:"与主单位换算比例",align:"center"},{label:"是否启用",slot:"enableFlag",align:"center"},{prop:"remark",label:"备注",align:"center"},{label:"操作",slot:"operation",width:"120",fixed:"right",align:"center"}],J={style:{"margin-bottom":"20px"}},K={class:"dialog-footer"},L=l({name:"MeasureUnit"}),Q=I(l({...L,setup(l){const I=t(),L=e({id:[{required:!0,message:"单位编码不能为空",trigger:"blur"}],measureName:[{required:!0,message:"单位名称不能为空",trigger:"blur"}],primaryFlag:[{required:!0,message:"是否是主单位不能为空",trigger:"blur"}],enableFlag:[{required:!0,message:"是否启用不能为空",trigger:"blur"}]}),Q=e({id:"",processName:""});let X=e({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const Z=t(!1),$=t(!1);let O=e([]),T=t(""),W=t([]),ee=t({measureName:"",changeRate:0,enableFlag:"Y",primaryFlag:"Y",remark:"",primaryId:"",id:""});const ae=t([]),le=()=>{pe()},te=async()=>{const e=await(async()=>await a.download({url:"/admin-api/mes/md/unit/measure/export"}))();h.excel(e,"计量单位.xls")},se=e=>{W.value=e.map((e=>null==e?void 0:e.id)),G[1].disabled=!W.value.length||W.value.length>=2,G[2].disabled=!W.value.length},re=()=>{ce(),T.value="添加单位",$.value=!0},ie=e=>{ce(),T.value="修改单位详情";const a=(null==e?void 0:e.id)||W.value[0];ue(a)},ne=e=>{const l=e||W.value,t=Array.isArray(l)?l:[l];_.confirm("是否删除当前数据?").then((()=>{(async e=>await a.delete({url:"/admin-api/mes/md/unit/measure/batch",data:e}))(t).then((e=>{w.success("删除成功"),pe()}))}))},ue=e=>{(async e=>await a.get({url:`/admin-api/mes/md/unit/measure/get/${e}`}))(e).then((e=>{ee.value=e,$.value=!0}))},de=e=>{X=null==e?void 0:e.value,pe()},oe=async()=>{I.value&&await I.value.validate((e=>{e&&(ee.value.id?(async e=>await a.put({url:"/admin-api/mes/md/unit/measure/update",data:e}))(ee.value).then((e=>{w.success("修改成功"),me(),pe()})):(async e=>await a.post({url:"/admin-api/mes/md/unit/measure/save",data:e}))(ee.value).then((e=>{w.success("新增成功"),me(),pe()})))}))},me=()=>{ee.value={measureName:"",changeRate:0,enableFlag:"Y",primaryFlag:"Y",remark:"",primaryId:"",id:""},$.value=!1},pe=()=>{const e={...Q,pageNo:X.currentPage,pageSize:X.pageSize};Z.value=!0,(async e=>await a.get({url:"/admin-api/mes/md/unit/measure/list",params:e}))(e).then((e=>{const{total:a,list:l=[]}=e||{};X.total=a,O=l})).finally((()=>{Z.value=!1}))},ce=()=>{(async()=>await a.get({url:"/admin-api/mes/md/unit/measure/list"}))().then((e=>{ae.value=null==e?void 0:e.list}))};return s((()=>{pe()})),(e,a)=>{const l=k,t=F,s=x,h=V,_=C,w=N,W=U,ue=R,pe=j,ce=S,ge=Y,ye=z,be=q,fe=D,ve=r("hasPermi");return i(),n(p,null,[u(l,null,{default:d((()=>[u(P,{"conditions-list":o(B),"search-model":Q,onQueryData:le},null,8,["conditions-list","search-model"])])),_:1}),u(l,null,{default:d((()=>[m("div",J,[(i(!0),n(p,null,c(o(G),((e,a)=>g((i(),y(t,{plain:"",type:e.type,key:a,icon:e.icon,disabled:e.disabled,onClick:a=>(e=>{switch(e){case"save":re();break;case"edit":ie();break;case"remove":ne();break;case"download":te()}})(e.state)},{default:d((()=>[b(f(e.label),1)])),_:2},1032,["type","icon","disabled","onClick"])),[[ve,[e.authority]]]))),128))]),u(A,{loading:Z.value,isSelection:!0,columns:o(H),tableData:o(O),pagination:o(X),onSelectionChange:se,onPaginationChange:de},{enableFlag:d((({scope:e})=>[u(s,{type:"Y"===e.row.enableFlag?"success":"warning"},{default:d((()=>[b(f(o(E)[e.row.enableFlag]),1)])),_:2},1032,["type"])])),primaryFlag:d((({scope:e})=>[u(s,{type:"Y"===e.row.primaryFlag?"success":"warning"},{default:d((()=>[b(f(o(E)[e.row.primaryFlag]),1)])),_:2},1032,["type"])])),operation:d((({scope:e})=>[u(t,{style:{"font-size":"17px"},link:"",type:"primary",onClick:a=>ie(e.row)},{default:d((()=>[b("修改")])),_:2},1032,["onClick"]),u(t,{style:{"font-size":"17px"},link:"",type:"danger",onClick:a=>ne(e.row.id)},{default:d((()=>[b("删除")])),_:2},1032,["onClick"])])),_:1},8,["loading","columns","tableData","pagination"])])),_:1}),u(fe,{width:"50%",modelValue:$.value,"onUpdate:modelValue":a[5]||(a[5]=e=>$.value=e),title:o(T),onBeforeClose:me},{footer:d((()=>[m("span",K,[u(t,{type:"primary",onClick:oe},{default:d((()=>[b(" 提交 ")])),_:1}),u(t,{onClick:me},{default:d((()=>[b("返回")])),_:1})])])),default:d((()=>[u(be,{ref_key:"ruleFormRef",ref:I,model:o(ee),rules:L,"label-width":"130px"},{default:d((()=>[u(ue,null,{default:d((()=>[u(w,{span:11},{default:d((()=>[u(_,{label:"单位名称",prop:"measureName"},{default:d((()=>[u(h,{modelValue:o(ee).measureName,"onUpdate:modelValue":a[0]||(a[0]=e=>o(ee).measureName=e)},null,8,["modelValue"])])),_:1})])),_:1}),u(w,{span:11},{default:d((()=>[u(_,{label:"换算比例",prop:"changeRate"},{default:d((()=>[u(W,{style:{width:"198px"},modelValue:o(ee).changeRate,"onUpdate:modelValue":a[1]||(a[1]=e=>o(ee).changeRate=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),u(ue,null,{default:d((()=>[u(w,{span:11},{default:d((()=>[u(_,{label:"启用主单位",prop:"primaryFlag"},{default:d((()=>[u(ce,{modelValue:o(ee).primaryFlag,"onUpdate:modelValue":a[2]||(a[2]=e=>o(ee).primaryFlag=e)},{default:d((()=>[(i(!0),n(p,null,c(o(M),((e,a)=>(i(),y(pe,{label:e.value,key:a},{default:d((()=>[b(f(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),"Y"==o(ee).primaryFlag?(i(),y(w,{key:0,span:11},{default:d((()=>[u(_,{label:"主单位"},{default:d((()=>[u(ye,{modelValue:o(ee).primaryId,"onUpdate:modelValue":a[3]||(a[3]=e=>o(ee).primaryId=e),placeholder:"请选择主单位"},{default:d((()=>[(i(!0),n(p,null,c(ae.value,(e=>(i(),y(ge,{key:e.id,label:e.measureName,value:e.id,disabled:"N"==e.enableFlag},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})):v("",!0)])),_:1}),u(ue,null,{default:d((()=>[u(w,{span:22},{default:d((()=>[u(_,{label:"备注",prop:"remark"},{default:d((()=>[u(h,{modelValue:o(ee).remark,"onUpdate:modelValue":a[4]||(a[4]=e=>o(ee).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/masterData/measureUnit/index.vue"]]);export{Q as default};
