import{q as e,f as a,D as l,d as t,K as s,e as o,g as i,C as n,o as d,c,k as u,w as r,a as m,I as p,G as f,J as v,z as y,X as k,t as h,F as S,n as _,a7 as C,L as w,M as g,N as b,H as x,aJ as V,a1 as T,a0 as I,aq as E,ab as j,at as D,au as U,aO as M,ch as P,l as R,v as O,E as A,ae as F,_ as K}from"./index-4bfb878d.js";import{d as L,h as q}from"./tree-5260b4e2.js";import{c as N}from"./constants-97c4dd5f.js";import{r as X}from"./formRules-eb36c657.js";import{u as Y}from"./useVxeCrudSchemas-092b8963.js";import{g as z,d as H,a as J,c as W,u as B}from"./index-676910fd.js";import{l as G}from"./index-9f33c93a.js";import{l as Q}from"./index-a751e4d0.js";import{l as Z,a as $,b as ee}from"./index-f8ac632b.js";import{u as ae}from"./useXTable-309dffed.js";const{t:le}=e(),te=a({name:[X],code:[X],sort:[X]}),se=a({action:!0,actionWidth:"400px",columns:[{title:"角色编号",field:"id",table:{width:200}},{title:"角色名称",field:"name",isSearch:!0},{title:"角色类型",field:"type",dictType:l.SYSTEM_ROLE_TYPE,dictClass:"number",isForm:!1},{title:"角色标识",field:"code",isSearch:!0},{title:"显示顺序",field:"sort"},{title:le("form.remark"),field:"remark",isTable:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}}},{title:le("common.status"),field:"status",dictType:l.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:le("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:oe}=Y(se),ie=t({name:"Role"}),ne=K(t({...ie,setup(t){const{t:K}=e(),X=s(),[Y,{reload:le,deleteData:se}]=ae({allSchemas:oe,getListApi:z,deleteApi:H}),ie=o(!1),ne=o(""),de=o(!1),ce=o("edit"),ue=o(),re=o(),me=e=>{ce.value=K("action."+e),ne.value=e,de.value=!0},pe=a({id:0,name:"",code:"",dataScope:0,checkList:[]}),fe=o([]),ve=o(),ye=o(!1),ke=o("数据权限"),he=o(""),Se=o(),_e=o(!0),Ce=o(!1),we=async(e,a)=>{var l;if(pe.id=a.id,pe.name=a.name,pe.code=a.code,he.value=e,ye.value=!0,"menu"===e){const e=await G();fe.value=q(e);const l=await Z(a.id);l&&(null==l||l.forEach((e=>{var a;null==(a=m(ve))||a.setChecked(e,!0,!1)})))}else if("data"===e){const e=await Q();fe.value=q(e);const t=await J(a.id);pe.dataScope=t.dataScope,t.dataScopeDeptIds&&(null==(l=t.dataScopeDeptIds)||l.forEach((e=>{var a;null==(a=m(ve))||a.setChecked(e,!0,!1)})))}};return i((()=>{Se.value=C(l.SYSTEM_DATA_SCOPE)})),(e,a)=>{const l=w,t=g,s=b,i=x,C=V,q=T,z=I,H=E,G=j,Q=D,Z=U,ae=M,ge=P,be=R,xe=O,Ve=A,Te=F,Ie=n("hasPermi");return d(),c(S,null,[u(i,null,{default:r((()=>[u(s,{onRegister:m(Y)},{toolbar_buttons:r((()=>[p(u(l,{type:"primary",preIcon:"ep:zoom-in",title:m(K)("action.add"),onClick:a[0]||(a[0]=e=>{me("create")})},null,8,["title"]),[[Ie,["system:role:create"]]])])),actionbtns_default:r((({row:e})=>[p(u(t,{preIcon:"ep:edit",title:m(K)("action.edit"),onClick:a=>(async e=>{var a;me("update");const l=await J(e);null==(a=m(ue))||a.setValues(l)})(e.id)},null,8,["title","onClick"]),[[Ie,["system:role:update"]]]),p(u(t,{preIcon:"ep:view",title:m(K)("action.detail"),onClick:a=>(async e=>{me("detail");const a=await J(e);re.value=a})(e.id)},null,8,["title","onClick"]),[[Ie,["system:role:query"]]]),p(u(t,{preIcon:"ep:basketball",title:"菜单权限",onClick:a=>we("menu",e)},null,8,["onClick"]),[[Ie,["system:permission:assign-role-menu"]]]),p(u(t,{preIcon:"ep:coin",title:"数据权限",onClick:a=>we("data",e)},null,8,["onClick"]),[[Ie,["system:permission:assign-role-data-scope"]]]),p(u(t,{preIcon:"ep:delete",title:m(K)("action.del"),onClick:a=>m(se)(e.id)},null,8,["title","onClick"]),[[Ie,["system:role:delete"]]])])),_:1},8,["onRegister"])])),_:1}),u(z,{modelValue:m(de),"onUpdate:modelValue":a[3]||(a[3]=e=>y(de)?de.value=e:null),title:m(ce)},{footer:r((()=>[["create","update"].includes(m(ne))?(d(),f(l,{key:0,type:"primary",title:m(K)("action.save"),loading:m(ie),onClick:a[1]||(a[1]=e=>(async()=>{var e;const a=null==(e=m(ue))?void 0:e.getElFormRef();a&&a.validate((async e=>{var a;if(e){ie.value=!0;try{const e=null==(a=m(ue))?void 0:a.formModel;"create"===ne.value?(await W(e),X.success(K("common.createSuccess"))):(await B(e),X.success(K("common.updateSuccess"))),de.value=!1}finally{ie.value=!1,await le()}}}))})())},null,8,["title","loading"])):v("",!0),u(l,{loading:m(ie),title:m(K)("dialog.close"),onClick:a[2]||(a[2]=e=>de.value=!1)},null,8,["loading","title"])])),default:r((()=>[["create","update"].includes(m(ne))?(d(),f(C,{key:0,schema:m(oe).formSchema,rules:m(te),ref_key:"formRef",ref:ue},null,8,["schema","rules"])):v("",!0),"detail"===m(ne)?(d(),f(q,{key:1,schema:m(oe).detailSchema,data:m(re)},null,8,["schema","data"])):v("",!0)])),_:1},8,["modelValue","title"]),u(z,{modelValue:m(ye),"onUpdate:modelValue":a[10]||(a[10]=e=>y(ye)?ye.value=e:null),title:m(ke)},{footer:r((()=>[u(l,{type:"primary",title:m(K)("action.save"),loading:m(ie),onClick:a[8]||(a[8]=e=>(async()=>{if("data"===he.value){const e=o({roleId:pe.id,dataScope:pe.dataScope,dataScopeDeptIds:pe.dataScope!==N.DEPT_CUSTOM?[]:ve.value.getCheckedKeys(!1)});await $(e.value)}else if("menu"===he.value){const e=o({roleId:pe.id,menuIds:[...ve.value.getCheckedKeys(!1),...ve.value.getHalfCheckedKeys()]});await ee(e.value)}X.success(K("common.updateSuccess")),ye.value=!1})())},null,8,["title","loading"]),u(l,{loading:m(ie),title:m(K)("dialog.close"),onClick:a[9]||(a[9]=e=>ye.value=!1)},null,8,["loading","title"])])),default:r((()=>[u(Te,{model:m(pe),"label-width":"140px",inline:!0},{default:r((()=>[u(G,{label:"角色名称"},{default:r((()=>[u(H,null,{default:r((()=>[k(h(m(pe).name),1)])),_:1})])),_:1}),u(G,{label:"角色标识"},{default:r((()=>[u(H,null,{default:r((()=>[k(h(m(pe).code),1)])),_:1})])),_:1}),"data"===m(he)?(d(),f(G,{key:0,label:"权限范围"},{default:r((()=>[u(Z,{modelValue:m(pe).dataScope,"onUpdate:modelValue":a[4]||(a[4]=e=>m(pe).dataScope=e)},{default:r((()=>[(d(!0),c(S,null,_(m(Se),(e=>(d(),f(Q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):v("",!0),u(Ve,null,{default:r((()=>[u(xe,{span:24},{default:r((()=>["menu"===m(he)||m(pe).dataScope===m(N).DEPT_CUSTOM?(d(),f(G,{key:0,label:"权限范围",style:{display:"flex"}},{default:r((()=>[u(be,{class:"card",shadow:"never"},{header:r((()=>[k(" 父子联动(选中父节点，自动选择子节点): "),u(ae,{modelValue:m(_e),"onUpdate:modelValue":a[5]||(a[5]=e=>y(_e)?_e.value=e:null),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"]),k(" 全选/全不选: "),u(ae,{modelValue:m(Ce),"onUpdate:modelValue":a[6]||(a[6]=e=>y(Ce)?Ce.value=e:null),"inline-prompt":"","active-text":"是","inactive-text":"否",onChange:a[7]||(a[7]=e=>{ve.value.setCheckedNodes(Ce.value?fe.value:[])})},null,8,["modelValue"])])),default:r((()=>[u(ge,{ref_key:"treeRef",ref:ve,"node-key":"id","show-checkbox":"","check-strictly":!m(_e),props:m(L),data:m(fe),"empty-text":"加载中，请稍后"},null,8,["check-strictly","props","data"])])),_:1})])),_:1})):v("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-17c20125"],["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/system/role/index.vue"]]);export{ne as default};
