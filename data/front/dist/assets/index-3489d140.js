import{f as e,r as a,d as t,e as l,g as o,o as s,c as n,k as i,w as r,a as u,X as d,t as p,j as c,G as m,J as f,z as g,F as k,aR as w,aK as b,H as v,Z as y,aa as C,a0 as _,b7 as h,b8 as x,bN as S,_ as V}from"./index-4bfb878d.js";import{c as j}from"./index-529a6cde.js";import{c as F}from"./index-6c8a85ac.js";import{E as q,d as z,h as D,f as U,g as N,e as P}from"./const-f443e30b.js";e([{type:"warning",icon:"download",state:"download",label:"导出",permissions:[]}]);const E=[{label:"设备序号",prop:"id"},{label:"任务编号",prop:"taskCode",width:"130"},{label:"报工编号",prop:"feedbackCode"},{label:"暂停原因",prop:"remork"},{label:"暂停时间",prop:"pauseTime",width:"150"},{label:"状态",prop:"status",slot:"status",fixed:"right"},{label:"操作",slot:"operation",width:"300",fixed:"right",align:"center"}],J=e([{type:"input",label:"设备序号",prop:"id",placeholder:"请输入设备序号"},{type:"input",label:"报工编号",prop:"feedbackCode",placeholder:"请输入报工编号"},{type:"select",label:"设备状态",prop:"status",placeholder:"选择状态",options:q}]),M=async e=>await a.post({url:"/admin-api/mes/pro/fed/equipment/updateStatus",data:e}),B={class:"dialog-footer"},G=V(t({__name:"index",setup(t){const V=l(!1);let q=e({total:0,pageSize:10,pageSizes:[5,10,15,20],currentPage:1});const G=l(!1);let H=e([]),K=l([]),O=l(!1),Q=l(""),R=e({tableForm:{},status:""});const T=l([]),W=l({id:"",status:"",feedbackCode:""}),X=e=>{(async e=>await a.get({url:`/admin-api/mes/pro/fed/equipment/get/${e}`}))(e.id).then((e=>{T.value=JSON.parse(e.equipmentCode),V.value=!0}))},Z=e=>{switch(e){case D:return"";case N:return"info";case U:case P:return"success"}},$=()=>{ae()},A=()=>{let e={id:R.tableForm.id,remork:Q.value,status:R.status};M(e).then((e=>{w.success("设备已暂停"),O.value=!1,I()}))},I=()=>{O.value=!1,Q.value="",R.tableForm={tableForm:{},status:""},ae()},L=e=>{K.value=e.map((e=>null==e?void 0:e.id))},Y=(e,a,t)=>{R.tableForm=e,R.status=a;let l={id:e.id,remork:"",status:a};const o=a===P?"是否确认报工？":null,s=()=>{M(l).then((e=>{w.success(t),ae()}))};o?b.confirm(o).then((()=>{s()})):a===N?O.value=!0:s()},ee=e=>{q=null==e?void 0:e.value,ae()},ae=()=>{const e={...W.value,pageNo:q.currentPage,pageSize:q.pageSize};G.value=!0,(async e=>await a.get({url:"/admin-api/mes/pro/fed/equipment/list",params:e}))(e).then((e=>{const{total:a,list:t=[]}=e||{};q.total=a,H=t})).finally((()=>{G.value=!1}))};return o((()=>{ae()})),(e,a)=>{const t=j,l=v,o=y,w=C,b=_,M=h,K=x,R=S;return s(),n(k,null,[i(l,null,{default:r((()=>[i(t,{"conditions-list":u(J),"search-model":W.value,onQueryData:$},null,8,["conditions-list","search-model"])])),_:1}),i(l,null,{default:r((()=>[i(F,{loading:G.value,isSelection:!0,columns:u(E),tableData:u(H),pagination:u(q),onSelectionChange:L,onPaginationChange:ee},{status:r((({scope:e})=>[i(o,{round:"",type:Z(e.row.status),onClick:a=>X(e.row)},{default:r((()=>[d(p(u(z)[e.row.status]),1)])),_:2},1032,["type","onClick"])])),operation:r((({scope:e})=>[c("div",null,[e.row.status===u(D)||e.row.status===u(U)?(s(),m(o,{key:0,onClick:a=>Y(e.row,u(N),"设备已暂停"),link:"",type:"danger"},{default:r((()=>[d("暂停")])),_:2},1032,["onClick"])):f("",!0),e.row.status.includes(u(N))?(s(),m(o,{key:1,link:"",type:"warning",onClick:a=>Y(e.row,u(U),"设备已恢复")},{default:r((()=>[d("恢复")])),_:2},1032,["onClick"])):f("",!0),e.row.status!==u(P)?(s(),m(o,{key:2,link:"",type:"success",onClick:a=>Y(e.row,u(P),"设备已报工")},{default:r((()=>[d("报工")])),_:2},1032,["onClick"])):f("",!0),i(o,{link:"",type:"primary",onClick:a=>X(e.row)},{default:r((()=>[d("查看设备")])),_:2},1032,["onClick"])])])),_:1},8,["loading","columns","tableData","pagination"]),i(b,{width:"70%",modelValue:u(O),"onUpdate:modelValue":a[1]||(a[1]=e=>g(O)?O.value=e:O=e),title:"暂停原因",onBeforeClose:I},{footer:r((()=>[c("span",B,[i(o,{type:"primary",onClick:A},{default:r((()=>[d(" 提交 ")])),_:1}),i(o,{onClick:I},{default:r((()=>[d("返回")])),_:1})])])),default:r((()=>[i(w,{type:"textarea",rows:2,placeholder:"请输入暂停原因",modelValue:u(Q),"onUpdate:modelValue":a[0]||(a[0]=e=>g(Q)?Q.value=e:Q=e)},null,8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),i(b,{modelValue:V.value,"onUpdate:modelValue":a[3]||(a[3]=e=>V.value=e),title:"查看生产设备数据明细"},{footer:r((()=>[i(R),i(o,{onClick:a[2]||(a[2]=e=>V.value=!1)},{default:r((()=>[d("返回")])),_:1})])),default:r((()=>[i(K,{border:"",data:T.value},{default:r((()=>[i(M,{align:"center",prop:"equipmentCode",label:"设备编号"})])),_:1},8,["data"])])),_:1},8,["modelValue"])],64)}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/prodMgmt/reportWork/index.vue"]]);export{G as default};
